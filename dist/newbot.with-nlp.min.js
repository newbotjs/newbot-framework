!function(t){var e={};function n(s){if(e[s])return e[s].exports;var i=e[s]={i:s,l:!1,exports:{}};return t[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(s,i,function(e){return t[e]}.bind(null,i));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=224)}([function(t,e){t.exports=function(t){return null!=t&&"object"==typeof t}},function(t,e,n){var s=n(48),i="object"==typeof self&&self&&self.Object===Object&&self,r=s||i||Function("return this")();t.exports=r},function(t,e){t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},function(t,e){var n=Array.isArray;t.exports=n},function(t,e,n){var s=n(9),i=n(99),r=n(100),o="[object Null]",a="[object Undefined]",u=s?s.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?a:o:u&&u in Object(t)?i(t):r(t)}},function(t,e,n){const s=n(240),i=n(225),r=n(242),o=n(226),a=n(83),{Container:u,defaultContainer:c}=n(6),l=n(82),h=n(227),p=n(228),f=n(229),g=n(81),d=n(230),m=n(80),{hasUnicode:y,unicodeToArray:v,asciiToArray:b,stringToArray:x,compareWildcars:A,loadEnv:w}=n(79),_=n(231),D=n(244),F=n(245),C=n(246);t.exports={Among:s,ArrToObj:i,BaseStemmer:r,containerBootstrap:o,Clonable:a,Container:u,defaultContainer:c,hasUnicode:y,unicodeToArray:v,asciiToArray:b,stringToArray:x,compareWildcars:A,loadEnv:w,Normalizer:l,ObjToArr:h,Stemmer:p,Stopwords:f,Tokenizer:g,Timer:d,logger:m,MemoryStorage:_,uuid:D,dock:F,Context:C,dockStart:async function(t,e){return await F.start(t,e),F}}},function(t,e,n){const{compareWildcars:s}=n(79),i=n(241),r=n(80);class o{constructor(t=!1){this.classes={},this.factory={},this.pipelines={},this.configurations={},this.compilers={},this.registerCompiler(i),t||this.use(r)}registerCompiler(t,e){const n=new t(this);this.compilers[e||n.name]=n}addClass(t,e){this.classes[e||t.name]=t}toJSON(t){const e=t.toJSON?t.toJSON():{...t};return e.className=t.constructor.name,e}fromJSON(t,e){const n=this.classes[t.className];let s;return n?(s=new n(e),s.fromJSON?s.fromJSON(t):Object.assign(s,t)):s={...t},delete s.className,s}register(t,e,n=!0){const s="function"==typeof e,i={name:t,isSingleton:n};i.instance=n?s?new e:e:s?e:e.constructor,this.factory[t]=i}getBestKey(t,e){for(let n=0;n<e.length;n+=1)if(s(t,e[n]))return e[n]}get(t,e){let n=this.factory[t];if(!n){if(this.parent)return this.parent.get(t,e);const s=this.getBestKey(t,Object.keys(this.factory));if(s&&(n=this.factory[s]),!n)return}if(n.isSingleton)return n.instance&&n.instance.applySettings&&n.instance.applySettings(n.instance.settings,e),n.instance;return new(0,n.instance)(e,this)}buildLiteral(t,e,n,s){return{type:"literal",subtype:t,src:e,value:n,context:s,container:this}}resolvePathWithType(t,e,n,s){const i=t.split(".");let r=i[0].trim();if(r||(r=t.startsWith(".")?"this":"context"),/^\d+$/.test(r))return this.buildLiteral("number",t,parseFloat(r),e);if(r.startsWith('"'))return this.buildLiteral("string",t,r.replace(/^"(.+(?="$))"$/,"$1"),e);if(r.startsWith("'"))return this.buildLiteral("string",t,r.replace(/^'(.+(?='$))'$/,"$1"),e);if("true"===r)return this.buildLiteral("boolean",t,!0,e);if("false"===r)return this.buildLiteral("boolean",t,!1,e);let o=e;"input"===r||"output"===r?o=n:r&&"context"!==r&&"this"!==r?o=this.get(r)||o[r]:r&&"context"===r?o=e:"this"===r&&(o=s);for(let e=1;e<i.length;e+=1){const n=i[e];if((!o||!o[n])&&e<i.length-1)throw Error(`Path not found in pipeline "${t}"`);const s=o;o=o[n],"function"==typeof o&&(o=o.bind(s))}return"function"==typeof o?{type:"function",src:t,value:o,context:e,container:this}:{type:"reference",src:t,value:o,context:e,container:this}}resolvePath(t,e,n,s){const i=this.resolvePathWithType(t,e,n,s);return i?i.value:i}setValue(t,e,n,s,i){const r=this.resolvePath(e,n,s,i),o=t.split("."),a=o.slice(0,-1).join(".");this.resolvePath(a,n,s,i)[o[o.length-1]]=r}incValue(t,e,n,s,i){const r=this.resolvePath(e,n,s,i),o=t.split(".");t.startsWith(".")&&o.push("this");const a=o.slice(0,-1).join(".");this.resolvePath(a,n,s,i)[o[o.length-1]]+=r}decValue(t,e,n,s,i){const r=this.resolvePath(e,n,s,i),o=t.split("."),a=o.slice(0,-1).join(".");this.resolvePath(a,n,s,i)[o[o.length-1]]-=r}eqValue(t,e,n,s,i){const r=n,o=this.resolvePath(t,r,s,i),a=this.resolvePath(e,r,s,i);r.floating=o===a}neqValue(t,e,n,s,i){const r=n,o=this.resolvePath(t,r,s,i),a=this.resolvePath(e,r,s,i);r.floating=o!==a}gtValue(t,e,n,s,i){const r=n,o=this.resolvePath(t,r,s,i),a=this.resolvePath(e,r,s,i);r.floating=o>a}geValue(t,e,n,s,i){const r=n,o=this.resolvePath(t,r,s,i),a=this.resolvePath(e,r,s,i);r.floating=o>=a}ltValue(t,e,n,s,i){const r=n,o=this.resolvePath(t,r,s,i),a=this.resolvePath(e,r,s,i);r.floating=o<a}leValue(t,e,n,s,i){const r=n,o=this.resolvePath(t,r,s,i),a=this.resolvePath(e,r,s,i);r.floating=o<=a}deleteValue(t,e,n,s){const i=t.split("."),r=i.slice(0,-1).join(".");delete this.resolvePath(r,e,n,s)[i[i.length-1]]}getValue(t="floating",e,n,s){const i=t.split("."),r=i.slice(0,-1).join(".");return this.resolvePath(r,e,n,s)[i[i.length-1]]}async runPipeline(t,e,n,s=0){if(s>10)throw new Error("Pipeline depth is too high: perhaps you are using recursive pipelines?");const i="string"==typeof t?this.getPipeline(t):t;if(!i)throw new Error(`Pipeline not found ${t}`);if(!i.compiler){const t=JSON.stringify(i);this.registerPipeline(t,i,!1);const r=this.getPipeline(t);return r.compiler.execute(r.compiled,e,n,s)}return i.compiler.execute(i.compiled,e,n,s)}use(t,e,n,s=!1){let i;if("function"==typeof t){if(t.name.endsWith("Compiler"))return this.registerCompiler(t),t.name;i=new t({container:this})}else i=t;i.register&&i.register(this);const r=i.settings?i.settings.tag:void 0,o=e||i.name||r||t.name||i.constructor.name;return s&&this.get(o)||this.register(o,i,n),o}getCompiler(t){const e=this.compilers[t];return e||(this.parent?this.parent.getCompiler(t):this.compilers.default)}buildPipeline(t,e=[]){const n=[];if(t&&t.length>0)for(let s=0;s<t.length;s+=1){const i=t[s];if("$super"===i.trim())for(let t=0;t<e.length;t+=1){e[t].trim().startsWith("->")||n.push(e[t])}else n.push(i)}const s=n.length&&n[0].startsWith("// compiler=")?n[0].slice(12):"default",i=this.getCompiler(s),r=i.compile(n);return{pipeline:n,compiler:i,compiled:r}}registerPipeline(t,e,n=!0){if(n||!this.pipelines[t]){const n=this.getPipeline(t);this.pipelines[t]=this.buildPipeline(e,n?n.pipeline:[])}}registerPipelineForChilds(t,e,n,s=!0){this.childPipelines||(this.childPipelines={}),this.childPipelines[t]||(this.childPipelines[t]=[]),this.childPipelines[t].push({tag:e,pipeline:n,overwrite:s})}getPipeline(t){if(this.pipelines[t])return this.pipelines[t];const e=Object.keys(this.pipelines);for(let n=0;n<e.length;n+=1)if(s(t,e[n]))return this.pipelines[e[n]]}registerConfiguration(t,e,n=!0){!n&&this.configurations[t]||(this.configurations[t]=e)}getConfiguration(t){if(this.configurations[t])return this.configurations[t];const e=Object.keys(this.configurations);for(let n=0;n<e.length;n+=1)if(s(t,e[n]))return this.configurations[e[n]]}loadPipelinesFromString(t=""){const e=t.split(/\n|\r|\r\n/);let n="",s=[],i="";for(let t=0;t<e.length;t+=1){const r=e[t];""!==r&&(r.startsWith("# ")?(n&&(i&&!["default","pipelines"].includes(i.toLowerCase())?this.registerPipelineForChilds(i,n,s):this.registerPipeline(n,s)),i=r.slice(1).trim(),n="",s=[]):r.startsWith("## ")?(n&&(i&&!["default","pipelines"].includes(i.toLowerCase())?this.registerPipelineForChilds(i,n,s):this.registerPipeline(n,s)),n=r.slice(2).trim(),s=[]):n&&s.push(r))}n&&(i&&!["default","pipelines"].includes(i.toLowerCase())?this.registerPipelineForChilds(i,n,s):this.registerPipeline(n,s))}async start(t="main"){const e=Object.keys(this.factory);for(let t=0;t<e.length;t+=1){const n=this.factory[e[t]];n.isSingleton&&n.instance&&n.instance.start&&await n.instance.start()}this.getPipeline(t)&&await this.runPipeline(t,{},this)}}const a=new o;t.exports={Container:o,defaultContainer:a}},function(t,e,n){const s=n(86),i=n(135),r=n(0),o=n(15),a=n(136),u=n(160),c=n(3),l=n(161),h=n(169),p=n(171),f=n(172),g=n(173),d=n(174),m=n(178),y=n(179),v=n(180),b=n(182),x=n(59),A=n(73);t.exports={merge:s,isString:i,isObjectLike:r,isPlainObject:x,isFunction:o,clone:a,cloneDeep:u,isArray:c,get:h,set:l,isUndefined:p,isNull:f,isBoolean:g,isNumber:A,random:d,last:m,flatten:v,isNaN:y,difference:b}},function(t,e,n){var s=n(98),i=n(103);t.exports=function(t,e){var n=i(t,e);return s(n)?n:void 0}},function(t,e,n){var s=n(1).Symbol;t.exports=s},function(t,e,n){var s=n(34),i=n(26);t.exports=function(t,e,n,r){var o=!n;n||(n={});for(var a=-1,u=e.length;++a<u;){var c=e[a],l=r?r(n[c],t[c],c,n,t):void 0;void 0===l&&(l=t[c]),o?i(n,c,l):s(n,c,l)}return n}},function(t,e,n){(function(e){const s=n(7),i=n(194),r=n(195),o=n(198),a=n(199),u=n(75),c=n(211),l=(n(218),n(219)),h=n(220),p=n(77),f=n(22),g=n(222);class d{constructor(t={},{loadSkills:e,model:n,modelLangs:i}={}){this._nlp={},this.config={},this._format={},this._constants={},this._conditions={},this._canActivated=[],this._propagateNlp=null,this._dbHook={},this._hooks={},this.model=n,this.modelLangs=i,this._originNlpObject={},this.script="",this._obj=[],this._skills=new Map,this._users=new Map,this.namespace="default",this._functions=c,this.lang=r.instance(),this.options=t,s.isString(t)&&(t={file:t}),Object.keys(t).length>0&&this.loadOptions(t,e)}static get version(){return g.version}static loader({systemjs:t}){t.config({meta:{"*.converse":{loader:e+"/../loader/converse-loader.js"}}}),d.SystemJS=t}async loadNativeNlp(){return this.nlp("__native__",await d.nlpManager(this.model,this.modelLangs)),this}async setModelNlp(t,e,n){this.model=t,this.modelLangs=e,await this.loadNativeNlp(!0),this.propagateNlp("__native__"),n||await this.setSkills(this.options.skills)}async loadOptions(t,e=!0){if(t.file&&this.file(t.file),t.code&&this.code(t.code),t.languages&&this.configure({languages:t.languages}),t.nlp)for(let e in t.nlp)this.nlp(e,t.nlp[e]);if(!this.parent&&this.model&&await this.setModelNlp(this.model,this.modelLangs,!0),t.conditions&&this.conditions(t.conditions),t.functions&&this.functions(t.functions),t.constants&&this.constants(t.constants),t.formats)for(let e in t.formats)this.format(e,t.formats[e]);t.canActivated&&this.canActivated(t.canActivated),t.shareFormats&&this.shareFormats(),t.shareNlp&&this.shareNlp(),t.propagateNlp&&this.propagateNlp(t.propagateNlp),t.propagateFormats&&this.propagateFormats(),e&&t.skills&&await this.setSkills(t.skills),this.load()}get users(){return this._users}configure(t){return this.config=s.merge(this.config,t),this}file(t){return this._file=t,this}code(t){return t.code?this.script=t.code:this.script=t,(t.compiled||s.isArray(this.script))&&(this._compiled=t.compiled||this.script),this}async open(t){return this._file&&d.SystemJS&&this.code(await d.SystemJS.import(this._file)),this.script?this._compiled?this._obj=s.merge([],this._compiled):(this._transpiler=new a(this.script,this.namespace),this._obj=this._transpiler.run(t)):this._obj=[],this._interpreter=new u(this._obj,this.users,this),this}continue(t,e,n){return this.exec({type:"continue",data:t},e,n)}exec(t,e,n,i={globalNoExec:!0}){let r;return new Promise(async(a,u)=>{let c;if(await this.open(u),!n){if(!f.is())throw"On NodeJS, you must give an identifier to the user. `.exec(input, userId, output)`";n=e,e="conversescript-user"}if(s.isObjectLike(t)||(t={text:t}),r=this._users.get(e),s.isFunction(n)&&(n={output:n}),r||(r=new o(e),this._users.set(e,r),i.start=!0),n.magicVariables)for(let t in n.magicVariables)r.setMagicVariable(t,n.magicVariables[t]);r.setMagicVariable("userId",e),r.resetHistory(),"continue"==t.type&&r.setMagicVariable("event",t.data);let l=Promise.resolve().then(()=>{if(n.preUser)return n.preUser(r,this)}).then(()=>{!this.parent&&n.debug&&n.debug("begin",{user:r,data:n.data})}).then(()=>this.propagateExec(t,e,n,i)).then(t=>{c=!!t,c=c||!c&&r.getAddress(this.namespace)});l="event"!==t.type&&"continue"!==t.type?l.then(()=>c?this.execNlp(t,e):t):l.then(()=>t),l.then(async t=>{let e={};c&&(e=await this._interpreter.exec(r,t,n,i),e&&(i.globalNoExec&=e.nothing)),a(e)}).catch(t=>{u(t)})}).then(e=>(this.parent||(i.globalNoExec&&this._hooks.nothing&&this._hooks.nothing(t.text,{user:r},n.data),this._hooks.finished&&this._hooks.finished(t.text,{user:r,data:n.data}),n.debug&&n.debug("finish",{nothing:i.globalNoExec,user:r,data:n.data}),r._nlpCache={}),e))}propagateExec(t,e,n,i){const r=this._users.get(e);let o=s.clone(n),a=!0,u=Promise.resolve();return this._skills.forEach(n=>{s.isArray(n)||(n=[n]);for(let c of n)u=u.then(()=>new Promise((n,u)=>{let l=Promise.resolve();if(this._canActivated.length>0&&!this._canActivated.includes(c.name)){c._canActivated=[...this._canActivated,...c._canActivated];for(let t of this._canActivated)this.name!=t&&c._skills.set(t,this._skills.get(t))}c._shareFormat&&(this._format=s.merge(c._format,this._format)),c._users=this._users,c._condition&&(l=c._condition(o.data,r),p(l)||(l=Promise.resolve(l))),l.then((s=!0)=>{if(s)return c.exec(t,e,o,i).then((t={})=>{a&=t.noExec,n()}).catch(u);n()})}))}),u.then(()=>a)}skills(){return this._skills}execNlp(t,e){t.intents={};const n=this.users.get(e);let i=Promise.resolve(),r=Object.keys(this._nlp).map(t=>this._nlp[t]);r=r.sort((t,e)=>(e.priority||0)-(t.priority||0));for(let o of r){const r=o.uuid;i=i.then(s=>{if("break"==s)return;const i=n._nlpCache[o.name];return i&&Object.is(i.object,this._originNlpObject[r])?i.result:o.exec(t.text,e,this)}).then(e=>{if(!e)return;n._nlpCache[o.name]={object:this._originNlpObject[r],result:e};const i=Object.keys(e).length;if(!s.isUndefined(o.priority)&&i>0)return t.intents=e,"break";t.intents=s.merge(t.intents,e)})}return i.then(()=>t)}event(t,...e){let n,i,r,o=Promise.resolve();switch(e.length){case 2:s.isArray(e[0])?i=e[0]:r=e[0],n=e[1];break;case 3:r=e[0],i=e[1],n=e[2];break;default:i=this.users}return i&&!s.isArray(i)&&(i=[i]),i.forEach(e=>{o=o.then(()=>(e.id&&(e=e.id),this.exec({type:"event",name:t,data:r},e,n)))}),o}saveSession(t,e){const n=this.users.get(e);if(!n)throw`Unable to save the user ${e} session because there is no exists`;return n.saveSession(t),this}format(t,e){return this._format[t]=e,this}functions(t){return this._functions=s.merge(this._functions,t),this}execFunction(t,e,n,i,{deep:r,data:o,execution:a,level:u,ins:c}){let l=t;if(r&&(l+="."+r),!this._functions[t])throw`${r.join(".")+"."+t}() not exists`;let h,{$call:p,$mock:f,$params:g}=this._functions[t];this._functions[t].namespace=this.namespace,p||(p=this._functions[t]),r&&r.length>0&&(p=s.get(p,r)),g&&(g=g.map(t=>{switch(t){case"users":return this.users;case"user":return i;case"data":return o;case"execution":return a;case"level":return u;case"ins":return c}return t}),e=e.concat(g));const d={users:this.users,user:i,data:o,execution:a,level:u,ins:c};return this.testing&&this._mock[l]?(h=this._mock[l].call(i,...e),f&&(r&&(f=s.get(f,r)),h=f.call(this._mock[l],h,...g))):(this._functions[t].converse=d,h=p.call(this._functions[t],...e)),n?h&&h.then?h.then(()=>{i.setMagicVariable("error",null),n()}).catch(t=>{i.setMagicVariable("error",t),n()}):void n(h):h}nlp(t,e,n){const s=Symbol();return this._originNlpObject[s]=e,this._nlp[t]||(this._nlp[t]=new l(t,this,{...n,uuid:s})),e&&this._nlp[t].add(e),this._nlp[t]}useNlp(t){return this.currentNlp=t,this}getCurrentNlp(){return this._nlp[this.currentNlp]}async loadLanguage(){if(!this.config.languages)return;const t=this.config.languages.path||"./languages";let{packages:e,default:n}=this.config.languages;s.isArray(e)?this.lang.init(e,t+"/"):(n||(n=Object.keys(e)[0]),this.lang.packages(e).default(n))}load(){return this.loadLanguage(),this}loadUsers(t){for(let e of t){let t=e.id||e._id,n=new o(t).fromJson(e);this.users.set(t,n)}}use(t){this._hooks=t}_findParentPath(){const t=stack(),n=e;for(let e of t){let t=e.getFileName(),s=i.dirname(t);if(s!==n&&!/testing$/.test(s))return s}}async openSkills(t){let e;f.is()||(e=await new Promise(async(t,e)=>{try{const e=await h.readFile(`${this.parentPath}/package.json`,{encoding:"utf-8"});t(JSON.parse(e))}catch(n){if(n)return"ENOENT"==n.code?t():e(n)}})),e&&e.converse&&e.converse.dependencies&&(this.setSkills(e.converse.dependencies),t&&t())}async skill(t,e=t){let n=e.skill||e;n.hasOwnProperty("default")&&(n=n.default);let i,r=n;if(s.isArray(n)){for(let e of n)await this.skill(t,e);return}if(s.isString(n)){let t=n.split(":");if(t.length>1?(r=n=t[1],t=t[0]):t=null,f.is()&&"node"==t)return this;if(!f.is()&&"browser"==t)return this;/\//.test(n)||(r=this.config.pathSkills||"skills",r+=`/${n}`)}else i=n;if(i.hasOwnProperty("default")&&(i=i.default),s.isFunction(i)){const t=e.params||[];i=s.isPlainObject(t)?i.call(i,t):i.apply(i,t),i.then&&(i=await i)}let o=i.skills;if(s.isPlainObject(i)&&(this._propagateNlp&&(i.propagateNlp=this._propagateNlp),this._propagateFormats&&(i.propagateFormats=!0),i=new d(i,{loadSkills:!1})),i.namespace=(this.namespace?this.namespace+"-":"")+t,i.parent=this,i.name=t,i._condition=e.condition,i._shareNlp&&(this._nlp=s.merge(this._nlp,i._nlp),i._nlp={}),this._propagateNlp){if(this.allPropagate)i._nlp=s.merge(this._nlp,i._nlp);else{let t={};for(let e of this._propagateNlp)t[e]=this._nlp[e];i._nlp=s.merge(t,i._nlp)}i._originNlpObject=s.merge(this._originNlpObject,i._originNlpObject)}if(this._propagateFormats&&(i._format=s.merge(this._format,i._format)),this._skills.has(t)){const e=this._skills.get(t);i=s.isArray(e)?[...e,i]:[e,i]}return this._skills.set(t,i),o&&await i.setSkills(o),this}async setSkills(t){for(let e in t)await this.skill(e,t[e]);return this}getSkill(t){return this._skills.get(t)}shareFormats(){this._shareFormat=!0}shareNlp(){this._shareNlp=!0}propagateNlp(t){return this._propagateNlp||(this._propagateNlp=[]),s.isArray(t)?(this._propagateNlp=[...this._propagateNlp,...t],this):(s.isString(t)&&this._propagateNlp.push(t),this)}get allPropagate(){return 0==this._propagateNlp.length}propagateFormats(){this._propagateFormats=!0}conditions(t){this._conditions=s.merge(this._conditions,t)}constants(t){this._constants=s.merge(this._constants,t)}canActivated(t){this._canActivated=t}getAllIntents(){let t=[],e=this.open().then(()=>{t=this._interpreter.decorators.get("Intent"),t=t.map(t=>(t._skill=this,t))});return this._skills.forEach(n=>{s.isArray(n)||(n=[n]);for(let s of n)e=e.then(()=>s.getAllIntents()).then(e=>t=t.concat(e))}),e.then(()=>t)}}t.exports=d}).call(this,"/")},function(t,e,n){var s=n(88),i=n(89),r=n(90),o=n(91),a=n(92);function u(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var s=t[e];this.set(s[0],s[1])}}u.prototype.clear=s,u.prototype.delete=i,u.prototype.get=r,u.prototype.has=o,u.prototype.set=a,t.exports=u},function(t,e,n){var s=n(14);t.exports=function(t,e){for(var n=t.length;n--;)if(s(t[n][0],e))return n;return-1}},function(t,e){t.exports=function(t,e){return t===e||t!=t&&e!=e}},function(t,e,n){var s=n(4),i=n(2),r="[object AsyncFunction]",o="[object Function]",a="[object GeneratorFunction]",u="[object Proxy]";t.exports=function(t){if(!i(t))return!1;var e=s(t);return e==o||e==a||e==r||e==u}},function(t,e,n){var s=n(8)(Object,"create");t.exports=s},function(t,e,n){var s=n(112);t.exports=function(t,e){var n=t.__data__;return s(e)?n["string"==typeof e?"string":"hash"]:n.map}},function(t,e,n){var s=n(15),i=n(58);t.exports=function(t){return null!=t&&i(t.length)&&!s(t)}},function(t,e){t.exports=function(t){return function(e){return t(e)}}},function(t,e,n){var s=n(62),i=n(126),r=n(18);t.exports=function(t){return r(t)?s(t,!0):i(t)}},function(t,e,n){var s=n(4),i=n(0),r="[object Symbol]";t.exports=function(t){return"symbol"==typeof t||i(t)&&s(t)==r}},function(t,e){t.exports=new class{is(){return"undefined"!=typeof navigator}}},function(t,e,n){const s=n(7);t.exports=class{constructor(t,e){this.decorator=t,this.otherDecorators={},this.name=this.decorator.name,this.instructions=t.instructions,this.params=t.params,this.fnName=e}findParam(t){return 0===s.difference(this.params,t).length}}},function(t,e,n){var s=n(8)(n(1),"Map");t.exports=s},function(t,e,n){var s=n(104),i=n(111),r=n(113),o=n(114),a=n(115);function u(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var s=t[e];this.set(s[0],s[1])}}u.prototype.clear=s,u.prototype.delete=i,u.prototype.get=r,u.prototype.has=o,u.prototype.set=a,t.exports=u},function(t,e,n){var s=n(51);t.exports=function(t,e,n){"__proto__"==e&&s?s(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,n){var s=n(119);t.exports=function(t){var e=new t.constructor(t.byteLength);return new s(e).set(new s(t)),e}},function(t,e,n){var s=n(56)(Object.getPrototypeOf,Object);t.exports=s},function(t,e){var n=Object.prototype;t.exports=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||n)}},function(t,e,n){var s=n(121),i=n(0),r=Object.prototype,o=r.hasOwnProperty,a=r.propertyIsEnumerable,u=s(function(){return arguments}())?s:function(t){return i(t)&&o.call(t,"callee")&&!a.call(t,"callee")};t.exports=u},function(t,e,n){(function(t){var s=n(1),i=n(122),r=e&&!e.nodeType&&e,o=r&&"object"==typeof t&&t&&!t.nodeType&&t,a=o&&o.exports===r?s.Buffer:void 0,u=(a?a.isBuffer:void 0)||i;t.exports=u}).call(this,n(27)(t))},function(t,e,n){(function(t){var s=n(48),i=e&&!e.nodeType&&e,r=i&&"object"==typeof t&&t&&!t.nodeType&&t,o=r&&r.exports===i&&s.process,a=function(){try{var t=r&&r.require&&r.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=a}).call(this,n(27)(t))},function(t,e,n){var s=n(26),i=n(14),r=Object.prototype.hasOwnProperty;t.exports=function(t,e,n){var o=t[e];r.call(t,e)&&i(o,n)&&(void 0!==n||e in t)||s(t,e,n)}},function(t,e){var n=9007199254740991,s=/^(?:0|[1-9]\d*)$/;t.exports=function(t,e){var i=typeof t;return!!(e=null==e?n:e)&&("number"==i||"symbol"!=i&&s.test(t))&&t>-1&&t%1==0&&t<e}},function(t,e,n){var s=n(62),i=n(139),r=n(18);t.exports=function(t){return r(t)?s(t):i(t)}},function(t,e,n){var s=n(143),i=n(67),r=Object.prototype.propertyIsEnumerable,o=Object.getOwnPropertySymbols,a=o?function(t){return null==t?[]:(t=Object(t),s(o(t),(function(e){return r.call(t,e)})))}:i;t.exports=a},function(t,e){t.exports=function(t,e){for(var n=-1,s=e.length,i=t.length;++n<s;)t[i+n]=e[n];return t}},function(t,e,n){var s=n(147),i=n(24),r=n(148),o=n(149),a=n(150),u=n(4),c=n(49),l=c(s),h=c(i),p=c(r),f=c(o),g=c(a),d=u;(s&&"[object DataView]"!=d(new s(new ArrayBuffer(1)))||i&&"[object Map]"!=d(new i)||r&&"[object Promise]"!=d(r.resolve())||o&&"[object Set]"!=d(new o)||a&&"[object WeakMap]"!=d(new a))&&(d=function(t){var e=u(t),n="[object Object]"==e?t.constructor:void 0,s=n?c(n):"";if(s)switch(s){case l:return"[object DataView]";case h:return"[object Map]";case p:return"[object Promise]";case f:return"[object Set]";case g:return"[object WeakMap]"}return e}),t.exports=d},function(t,e){const n={"variable.not.defined":["ReferenceError",t=>`${t.variable} is not defined`],"function.not.defined":["ReferenceError",t=>`${t.name}(...) function is not defined`],"arithmetic.error":["ArithmeticError",(t,e)=>"Expression is not correct. "+e.message],"type.error":["TypeError",(t,e)=>"Type is not correct. "+e.message]};t.exports=class{constructor(t,e,n){this.script=t,this.namespace=e,this.reject=n}throw(t,e,s){let i,r,o;if(!t)throw s;if(n[e]?(r=n[e][0],o=n[e][1]):(r="InternalError",o=()=>s.message),o=o(t,s),t._file){let{line:e,column:n}=t._file.start;i=this.makeError(r,o,{line:e,column:n})}else i=new Error(o);if(this.reject)return i;throw i}syntax(t){if(!t.location)throw t;const{line:e,column:n}=t.location.start,s=this.makeError("syntax","Syntax Error:"+t.message,{line:e,column:n});if(!this.reject)throw s;this.reject(s)}makeError(t,e,n){var s,i=n.line,r=n.column,o=(n.filename,this.script||n.src),a=i+(r?":"+r:"");const u=this.namespace?this.namespace.split("-").join(" / "):"unknow",c=`Skill : ${u}. Line ${i}`;if(o&&i>=1&&i<=o.split("\n").length){var l=o.split("\n"),h=Math.max(i-3,0),p=Math.min(l.length,i+3);s=c+"\n\n"+l.slice(h,p).map((function(t,e){var n=e+h+1,s=(n==i?"  > ":"    ")+n+"| ",o=s+t;return n===i&&r>0&&(o+="\n",o+=Array(s.length+r).join("-")+"^"),o})).join("\n")+"\n\n"+e}else s=c+":"+a+"\n\n"+e;const f=new Error(s);return f.skill=u,f.line=i,f.column=r,f}}},function(t,e,n){"use strict";n.r(e),n.d(e,"NewBot",(function(){return r}));var s=n(11),i=n.n(s);n.d(e,"Converse",(function(){return i.a})),window.Converse=i.a;const r=window.NewBot=i.a},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e){var n,s,i=t.exports={};function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===r||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:r}catch(t){n=r}try{s="function"==typeof clearTimeout?clearTimeout:o}catch(t){s=o}}();var u,c=[],l=!1,h=-1;function p(){l&&u&&(l=!1,u.length?c=u.concat(c):h=-1,c.length&&f())}function f(){if(!l){var t=a(p);l=!0;for(var e=c.length;e;){for(u=c,c=[];++h<e;)u&&u[h].run();h=-1,e=c.length}u=null,l=!1,function(t){if(s===clearTimeout)return clearTimeout(t);if((s===o||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(t);try{s(t)}catch(e){try{return s.call(null,t)}catch(e){return s.call(this,t)}}}(t)}}function g(t,e){this.fun=t,this.array=e}function d(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new g(t,e)),1!==c.length||l||a(f)},g.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=d,i.addListener=d,i.once=d,i.off=d,i.removeListener=d,i.removeAllListeners=d,i.emit=d,i.prependListener=d,i.prependOnceListener=d,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},,,function(t,e){function n(t,e,n){const s=t,i=e;i.start<=s.end&&i.end>=s.start&&(i.accuracy<s.accuracy?i.discarded=!0:i.accuracy>s.accuracy?s.discarded=!0:(n||i.entity===s.entity||"number"===i.entity)&&i.len<=s.len||(n||i.entity===s.entity||"number"===s.entity)&&i.len>s.len&&(s.discarded=!0))}t.exports=function(t,e=!0){const s=t.length;for(let i=0;i<s;i+=1){const r=t[i];if(!r.discarded)for(let o=i+1;o<s;o+=1){const s=t[o];r.discarded||n(r,s,e)}}return t.filter(t=>!t.discarded)}},function(t,e,n){var s=n(12),i=n(93),r=n(94),o=n(95),a=n(96),u=n(97);function c(t){var e=this.__data__=new s(t);this.size=e.size}c.prototype.clear=i,c.prototype.delete=r,c.prototype.get=o,c.prototype.has=a,c.prototype.set=u,t.exports=c},function(t,e,n){(function(e){var n="object"==typeof e&&e&&e.Object===Object&&e;t.exports=n}).call(this,n(42))},function(t,e){var n=Function.prototype.toString;t.exports=function(t){if(null!=t){try{return n.call(t)}catch(t){}try{return t+""}catch(t){}}return""}},function(t,e,n){var s=n(26),i=n(14);t.exports=function(t,e,n){(void 0===n||i(t[e],n))&&(void 0!==n||e in t)||s(t,e,n)}},function(t,e,n){var s=n(8),i=function(){try{var t=s(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();t.exports=i},function(t,e,n){(function(t){var s=n(1),i=e&&!e.nodeType&&e,r=i&&"object"==typeof t&&t&&!t.nodeType&&t,o=r&&r.exports===i?s.Buffer:void 0,a=o?o.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var n=t.length,s=a?a(n):new t.constructor(n);return t.copy(s),s}}).call(this,n(27)(t))},function(t,e,n){var s=n(28);t.exports=function(t,e){var n=e?s(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}},function(t,e){t.exports=function(t,e){var n=-1,s=t.length;for(e||(e=Array(s));++n<s;)e[n]=t[n];return e}},function(t,e,n){var s=n(120),i=n(29),r=n(30);t.exports=function(t){return"function"!=typeof t.constructor||r(t)?{}:s(i(t))}},function(t,e){t.exports=function(t,e){return function(n){return t(e(n))}}},function(t,e,n){var s=n(18),i=n(0);t.exports=function(t){return i(t)&&s(t)}},function(t,e){var n=9007199254740991;t.exports=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=n}},function(t,e,n){var s=n(4),i=n(29),r=n(0),o="[object Object]",a=Function.prototype,u=Object.prototype,c=a.toString,l=u.hasOwnProperty,h=c.call(Object);t.exports=function(t){if(!r(t)||s(t)!=o)return!1;var e=i(t);if(null===e)return!0;var n=l.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&c.call(n)==h}},function(t,e,n){var s=n(123),i=n(19),r=n(33),o=r&&r.isTypedArray,a=o?i(o):s;t.exports=a},function(t,e){t.exports=function(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}},function(t,e,n){var s=n(125),i=n(31),r=n(3),o=n(32),a=n(35),u=n(60),c=Object.prototype.hasOwnProperty;t.exports=function(t,e){var n=r(t),l=!n&&i(t),h=!n&&!l&&o(t),p=!n&&!l&&!h&&u(t),f=n||l||h||p,g=f?s(t.length,String):[],d=g.length;for(var m in t)!e&&!c.call(t,m)||f&&("length"==m||h&&("offset"==m||"parent"==m)||p&&("buffer"==m||"byteLength"==m||"byteOffset"==m)||a(m,d))||g.push(m);return g}},function(t,e,n){var s=n(64),i=n(129),r=n(131);t.exports=function(t,e){return r(i(t,e,s),t+"")}},function(t,e){t.exports=function(t){return t}},function(t,e,n){var s=n(14),i=n(18),r=n(35),o=n(2);t.exports=function(t,e,n){if(!o(n))return!1;var a=typeof e;return!!("number"==a?i(n)&&r(e,n.length):"string"==a&&e in n)&&s(n[e],t)}},function(t,e,n){var s=n(47),i=n(137),r=n(34),o=n(138),a=n(141),u=n(52),c=n(54),l=n(142),h=n(144),p=n(145),f=n(146),g=n(39),d=n(151),m=n(152),y=n(55),v=n(3),b=n(32),x=n(156),A=n(2),w=n(158),_=n(36),D=1,F=2,C=4,k="[object Arguments]",S="[object Function]",E="[object GeneratorFunction]",j="[object Object]",O={};O[k]=O["[object Array]"]=O["[object ArrayBuffer]"]=O["[object DataView]"]=O["[object Boolean]"]=O["[object Date]"]=O["[object Float32Array]"]=O["[object Float64Array]"]=O["[object Int8Array]"]=O["[object Int16Array]"]=O["[object Int32Array]"]=O["[object Map]"]=O["[object Number]"]=O[j]=O["[object RegExp]"]=O["[object Set]"]=O["[object String]"]=O["[object Symbol]"]=O["[object Uint8Array]"]=O["[object Uint8ClampedArray]"]=O["[object Uint16Array]"]=O["[object Uint32Array]"]=!0,O["[object Error]"]=O[S]=O["[object WeakMap]"]=!1,t.exports=function t(e,n,B,N,P,T){var $,L=n&D,M=n&F,z=n&C;if(B&&($=P?B(e,N,P,T):B(e)),void 0!==$)return $;if(!A(e))return e;var R=v(e);if(R){if($=d(e),!L)return c(e,$)}else{var V=g(e),I=V==S||V==E;if(b(e))return u(e,L);if(V==j||V==k||I&&!P){if($=M||I?{}:y(e),!L)return M?h(e,a($,e)):l(e,o($,e))}else{if(!O[V])return P?e:{};$=m(e,V,L)}}T||(T=new s);var J=T.get(e);if(J)return J;T.set(e,$),w(e)?e.forEach((function(s){$.add(t(s,n,B,s,e,T))})):x(e)&&e.forEach((function(s,i){$.set(i,t(s,n,B,i,e,T))}));var U=z?M?f:p:M?keysIn:_,W=R?void 0:U(e);return i(W||e,(function(s,i){W&&(s=e[i=s]),r($,i,t(s,n,B,i,e,T))})),$}},function(t,e){t.exports=function(){return[]}},function(t,e,n){var s=n(38),i=n(29),r=n(37),o=n(67),a=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)s(e,r(t)),t=i(t);return e}:o;t.exports=a},function(t,e,n){var s=n(38),i=n(3);t.exports=function(t,e,n){var r=e(t);return i(t)?r:s(r,n(t))}},function(t,e,n){var s=n(3),i=n(163),r=n(164),o=n(167);t.exports=function(t,e){return s(t)?t:i(t,e)?[t]:r(o(t))}},function(t,e){t.exports=function(t,e){for(var n=-1,s=null==t?0:t.length,i=Array(s);++n<s;)i[n]=e(t[n],n,t);return i}},function(t,e,n){var s=n(21),i=1/0;t.exports=function(t){if("string"==typeof t||s(t))return t;var e=t+"";return"0"==e&&1/t==-i?"-0":e}},function(t,e,n){var s=n(4),i=n(0),r="[object Number]";t.exports=function(t){return"number"==typeof t||i(t)&&s(t)==r}},function(t,e,n){var s=n(38),i=n(181);t.exports=function t(e,n,r,o,a){var u=-1,c=e.length;for(r||(r=i),a||(a=[]);++u<c;){var l=e[u];n>0&&r(l)?n>1?t(l,n-1,r,o,a):s(a,l):o||(a[a.length]=l)}return a}},function(t,e,n){const s=n(7),i=n(200),r=n(203),o=n(204),a=n(77),u=n(205),c=n(206),l=n(78),h=n(40);class p{static isSystemFunction(t){return-1!=["Input","Prompt","Pause"].findIndex(e=>e==t)}constructor(t,e,n,s,i){this._nothing=!1,this.user=t,this._input=e,this.input=""+e.text,this.intents=e.intents,"event"===e.type&&(this.event={type:e.type,name:e.name,data:e.data}),this.output=n.output,this.session=n.session,this.propagate=s,this.start=s.start,this.options=n,this.interpreter=i,this.converse=this.interpreter.converse,this.parent=this.converse.parent,this.decorators=i.decorators,this.hooks=i.converse._hooks,this.obj=i._obj,this.namespace=i.namespace,this._finishScript=this.options._finishScript,this._errorScript=this.options._errorScript,this.error=new h(i.converse.script,this.namespace,this._errorScript),this.user.setMagicVariable("text",this.input),this.instructionsRoot(()=>{this.event?this.triggerEvent():this.go().catch(this._errorScript)})}deepBlock(t,e,n=0){const i=e[n],{index:r}=this.interpreter.index[i];let o=t.instructions[r];o.conditionsElse&&i==o.conditionsElse.id&&(o=o.conditionsElse);const a=s.merge(o,{indexBlock:r});return e[n+1]?[a,...this.deepBlock(o,e,n+1)]:[a]}triggerEvent(){let t=this.decorators.get("Event",["on",this.event.name]);"start"==this.event.name&&(t=t.concat(this.decorators.get("Event","start"))),t.length>0?(this.event.data&&this.user.setMagicVariable("event",this.event.data),this.decorators.exec(t,this)):(this._noExec=!0,this.end())}triggerAction(){const t=this.action(this.input);if(t){this.user.setMagicVariable("action",t.value);const e=this.decorators.get("Action",t.name);if(e.length>0)return this.decorators.exec(e,this),!0}}action(t){const e=t.match(/^action\?([a-zA-Z0-9_-]+)(=?)(.*)$/);if(!e)return!1;const n={name:e[1]};return e[3]&&(n.value=e[3]),n}async go(t=0){const e=this,n=this.interpreter.index[this.user.getAddress(this.namespace)];let i=!1,r=!1;const o={start:this.decorators.get("Event","start"),startAndIntent:this.decorators.get("Event","startAndIntent"),nothing:this.decorators.get("Event","nothing")};if(this.user.addressStackIslocked(this.namespace))return this.stopScript();if(this.triggerAction())return this.stopScript();if(this.decorators.get("Intent").length&&(r=await this.decorators.execMethod("Intent","run",this),r&&(i=!0)),!r&&n){let{index:e,level:r,deep:o}=n,a=this.interpreter.fn[r];this.user.popAddress(this.namespace);const u=e=>{this.execFn(a,e+1,e=>{if(e.hasActivateDecorator)if(!0!==e.value)this.user.popAddress(this.parent.namespace);else if(this.parent){const t=this.parent._canActivated.indexOf(this.converse.name);if(-1!=t&&this.parent._canActivated.length>t+1){const e=this.parent._canActivated[t+1],n=this.parent._skills.get(e);for(let t in n._interpreter.index){const e=n._interpreter.index[t];if(e.hasActivateDecorator){this.user.addAddress(t,e.namespace);break}}}else{const t=this.user._infoAddress.actived[this.parent.namespace];this.unlockParent(t,{activated:!0})}}const n=this.user.getAddress(this.namespace);if(n){const t=this.converse._interpreter.index[n];this.setReturnVariable({name:e.level},e.value,t.level)}else if(this.parent){const t=this.user.getAddress(this.parent.namespace);if(t){const n=this.parent._interpreter.index[t],i=s.last(this.namespace.split("-"));this.parent.bufferFunction=t=>{t.setReturnVariable({name:i+"-"+e.level},e.value,n.level)}}}this.go(t+1)})},c=(t,e,n,s)=>{let i=t[n];n<0?s(t[0]):this.execBlock(i,e+1,r,()=>c(t,i.indexBlock,n-1,s))};if(o.length>0){let t=this.deepBlock(a,o);c(t,e,t.length-1,t=>{u(t.indexBlock)})}else u(e);i=!0}else!r&&this.start&&o.start.length?i=await this.decorators.exec(o.start,this):r&&this.start&&o.startAndIntent.length&&(i=await this.decorators.exec(o.startAndIntent,this),r&&!i&&(i=!0));i||async function(){0===t&&(e._noExec=!0,e._nothing=!0,o.nothing.length&&(e.user.nothingSkill||(e.user.nothingSkill=e)),!e.parent&&e.user.nothingSkill&&await e.user.nothingSkill.execNothing()),e.end()}()}execNothing(){const t=this.decorators.get("Event","nothing");return this._noExec=!1,this.decorators.exec(t,this)}stopScript(){this.parent||(this.user.nothingSkill=null),this._finishScript({noExec:this._noExec,nothing:this._nothing})}end(){this.options.finish&&this.options.finish.call(this),this.user.clearAddress(this.namespace),this.stopScript()}unlockParent(t){this.parent&&this.user.unlockAddressStack(this.parent.namespace,t)}instructionsRoot(t){this.converse.bufferFunction&&(this.converse.bufferFunction(this),this.converse.bufferFunction=null),this.instructions(this.obj,0,"root",t)}async instructions(t,e,n="root",i,r={}){let o=t[e];try{const{isBlock:a}=r,u=({stop:s,value:o}={})=>(s&&(e=t.length,r.value=o,r.stop=s),this.instructions(t,e+1,n,i,r));if(!o){if(a||(this.unlockParent(n),this.options.finishFn&&this.options.finishFn.call(this,n)),i){const t=this.interpreter.fn[n];let e=!1;t&&(e=-1!=t.decorators.findIndex(t=>"Event"==t.name&&t.params&&t.params[0]==l.CAN_ACTIVATE)),i({stop:r.stop,value:r.value,level:n,hasActivateDecorator:e})}return void(a||this.user.garbage(n,this.namespace))}if(!s.isUndefined(o.return)){const t=await this.getValue(o,o.return,n);return void(a?i({stop:!0,value:t}):u({stop:!0,value:t}))}if(o._pointer=e,o._instructions=t,this.debug("ins",{level:n,...o}),o.group){let t=o.group[s.random(0,o.group.length-1)];t.decorators=o.decorators,o=t}if(o.condition)await this.execCondition(o,n,u);else if(o.variable)await this.execVariable(o,n,u);else if(o.loop)await this.execLoop(o,n,u);else if(o.output&&"root"!=n)this.execOutput(o,n,u);else if(o.type&&!r.refresh)switch(o.type){case"function":u();break;case"executeFn":let t=await this.findFunctionAndExec(o,n);this.setReturnVariable(o,t,n),u()}}catch(t){throw this._errorScript(t),this.error.throw(o,t.id,t)}}debug(t,e){this.options.debug&&this.options.debug(t,{namespace:this.namespace,data:this.output.data,user:this.user,...e})}findFunctionAndExec(t,e,n){return t=s.cloneDeep(t),new Promise(async(i,r)=>{try{if(!s.isString(t.name)){const{variable:e,type:n,deep:s}=t.name;e&&(t.name=e),t.deep=s}const r=async(t,r,o)=>{if(t.interpreter.fn[r.name]){const n=r.params,a=t.interpreter.fn[r.name],u=a.params;o&&this.user.lockAddressStack(this.namespace,r.name),this.user.addAddress(r.id,this.namespace);let c=[];if(u)for(let i=0;i<u.length;i++)c.push(new Promise(async o=>{await t.execVariable({variable:u[i],value:s.isUndefined(n[i])?null:await this.getValue(r,n[i],e)},r.name,o)}));return Promise.all(c).then(()=>t.execFn(a,0,t=>{this.user.popAddress(this.namespace),i(t.value)})),!0}if(t.hasApiFn(r.name)){let s=await this.execApiFn(r,e,n,{deep:r.deep,data:this.options.data,context:t});return p.isSystemFunction(r.name)||i(s),!0}return!1};if(!await r(this,t)){const n=this.converse.skills().get(t.name);if(n){t.name=t.deep[0],t.deep.splice(0,1),await r(n._interpreter.execution,t,!0)||this.error.throw(t,"function.not.defined")}else if(t.deep){const n=t.deep.slice(0,-1),r={variable:t.name,deep:n};t.deep.length>1&&(r.type="object");const o=await this.getValue(t,r,e),a=o[s.last(t.deep)];a?i(a.apply(o,t.params)):this.error.throw(t,"function.not.defined")}else this.error.throw(t,"function.not.defined")}}catch(t){r(t)}})}getScope(t){return"root"==t?this.user.getVariables(this.namespace):this.user.getVariableInFonction(this.namespace,t)}getVariable(t,e,n){const i=!s.isUndefined(n);let r=t.variable;if(this.converse._constants[r]){if(i)throw new Error("TypeError: Assignment to constant variable");return this.converse._constants[r]}const o=this.user.getVariableInFonction(this.namespace,e,r);if(/^\$/.test(r)){const s=this.user.getVariable(this.namespace,r);return i&&!this.setDeepObject(t,s,n,e)&&this.user.setVariable(this.namespace,r,n),this.getDeepObject(t,s,e)}if(i&&!this.setDeepObject(t,o,n,e)&&this.user.setVariableInFonction(this.namespace,e,r,n),!s.isUndefined(o))return this.getDeepObject(t,o,e)}setVariable(t,e,n){this.getVariable(t,n,e)}setReturnVariable(t,e,n){let s=t.name;"object"==s.type&&(s=s.variable+"-"+s.deep.join("-")),this.setVariable({variable:"__return_"+s},e,n)}setMagicVar(t,e){this.user.magicVar[t]=e}getMagicVar(t,e,n){const s=this.user.magicVar[t.replace(":","")];return this.getDeepObject(e,s,n)}async _deepObject(t,e,n,i){const r=!s.isUndefined(i);let o=await this.execParams(t,t.deep,n);return s[r?"set":"get"](e,o,i)}getDeepObject(t,e,n){return"object"!=t.type?e:this._deepObject(t,e,n)}setDeepObject(t,e,n,s){return"assignObject"==t.type&&this._deepObject(t,e,s,n)}getValue(t,e,n,i){return new Promise(async(r,a)=>{try{this.getScope(n);let a=e;if(null===a)return r(a);if(e.regexp)a=new RegExp(e.regexp,e.flags.join(""));else if(s.isArray(e))a=await o.map(e,e=>this.getValue(t,e,n));else if(e.expression)a=await this.execExpression(t,e.expression,e.variables,n);else if(e.variable)if(/^:/.test(e.variable)){let t=a.variable;a=this.getMagicVar(t,a,n)}else a=await this.getVariable(e,n);else if(e.text&&!e.__deepIndex)a=await u(e.text,/\{([^\}]+)\}/g,async(s,i)=>this.getValue(t,e.variables[i].value,n));else if("executeFn"==e.type)a=await this.findFunctionAndExec({...e,id:t.id},n);else if(a.__deepIndex)for(let e of a.__deepIndex){let r=await this.getValue(t,s.get(a,e),n,i);s.set(a,e,r)}s.isString(a)&&"#"===a[0]&&(a=await this.translate(t,a.substr(1),n)),r(a)}catch(t){a(t)}})}async execBlock(t,e=0,n,i){let r;if(t.varLocal){let e=await this.getValue(t,t.array,n);if(s.isNumber(e))e=new Array(e+1).fill(0).map((t,e)=>e);else if(s.isPlainObject(e))delete e.__deepIndex,e=Object.values(e);else if(!s.isString(e)&&!s.isArray(e)){const t=new Error("Number, Object, String and Array are only accepted for this loop");throw t.id="type.error",t}t.array=e,r=this.getVariable({variable:"__"+t.varLocal.variable},n),this.setVariable(t.varLocal,t.array[r],n)}await this.instructions(t.instructions,e,n,async e=>{t.loop?t.varLocal?r<t.array.length-1?(this.setVariable({variable:"__"+t.varLocal.variable},r+1,n),await this.execBlock(t,0,n,i)):i(e):this.execCondition(t,n,i):i(e)},{isBlock:!0})}async execLoop(t,e,n){this.setVariable({variable:"__"+t.varLocal.variable},0,e),await this.execBlock(t,0,e,n)}execCondition(t,e,n){return new Promise((n,s)=>{this.getValue(t,t.condition,e).then(n).catch(s)}).then(i=>{switch(t.keyword){case"unknown":i=s.isUndefined(i)||s.isNull(i);break;case"defined":i=!s.isUndefined(i)&&!s.isNull(i)}i?this.execBlock(t,0,e,n):t.conditionsElse?this.execBlock(t.conditionsElse,0,e,n):n()})}execExpression(t,e,n,i){return new Promise(async(o,a)=>{e=(e=(e=(e=(e=await u(e,/\{([0-9]+)\}/g,async(e,r)=>{let o=await this.getValue(t,n[r],i);return/^[0-9]+(\.[0-9]+)?$/.test(o)||s.isBoolean(o)||null===o||(o=`"${o}"`),o})).replace(/'/g,'"')).replace(/not/g,"!")).replace(/and/g,"&&")).replace(/or/g,"||");try{const t=r(e);o(this.arithmetic(t))}catch(t){t.id="arithmetic.error",a(t)}})}arithmetic(t){let e,n;switch(t.left&&(e=this.arithmetic(t.left)),t.right&&(n=this.arithmetic(t.right)),t.type){case"BinaryExpression":switch(t.operator){case"+":return e+n;case"-":return e-n;case"*":return e*n;case"/":return e/n;case"==":return e==n;case">=":return e>=n;case"<=":return e<=n;case">":return e>n;case"<":return e<n}break;case"LogicalExpression":switch(t.operator){case"&&":return e&&n;case"||":return e||n}break;case"UnaryExpression":switch(t.operator){case"!":return!this.arithmetic(t.argument);case"-":return-this.arithmetic(t.argument)}break;default:return t.value}}execVariable(t,e,n){return new Promise((n,s)=>{this.getValue(t,t.value,e).then(n).catch(s)}).then(i=>{let r=this.getScope(e);s.isUndefined(r[t.variable.replace("$","")])||"root"!=e||this.start?(this.setVariable(t,i,e),n()):n()})}async translate(t,e,n,i=[]){const{converse:r}=this.interpreter,o=this.user.getLang()||r.lang.current;let a=r.lang.data[o]&&r.lang.get(e,null,o);if(!a&&r.lang.data[o]){const t=r.lang.getGroup(e);t.length>0&&(e=t[s.random(0,t.length-1)],a=!0)}return a&&(i=await this.execParams(t,i,n),e=r.lang.translate(e,o,...i)),e}execOutput(t,e,n){return new Promise(async(i,r)=>{const{converse:o}=this.interpreter;let u=t.output;if(!this.output)return;if(t.output.variables&&(u=await this.getValue(t,t.output,e)),u=u.replace(/\r$/,""),u=await this.translate(t,u,e,t.params),t.decorators)for(let n of t.decorators)if("Format"==n.name){let s=[...n.params];s=await this.execParams(t,s,e);let i=s[0];o._format[i]&&(s.splice(0,1),u=o._format[i].call(this.converse,u,s,this.options.data,this.user),a(u)&&(u=await u))}const c=t=>{const e=t||u,i=this.output(e,n,{user:this.user});s.isUndefined(i)||n()};this._triggerHook("sending",u,{user:this.user,data:this.options.data},(t,e)=>{if(t)throw t;c(e)})||c()})}execFn(t,e,n){s.isUndefined(this.interpreter.fn[t.name])&&this.error.throw(t,"function.not.defined"),this.instructions(t.instructions,e,t.name,n)}execParams(t,e,n,s){return e?o.map(e,e=>this.getValue(t,e,n,s)):Promise.resolve([])}async execApiFn(t,e,n,s){return p.isSystemFunction(t.name)?(this.user.addAddress(t.id,this.namespace),this._triggerHook("prompt",t.params,{user:this.user,data:this.options.data,level:e}),this.options.waintingInput&&this.options.waintingInput.call(this,t.params,e),void this.stopScript()):(s.execution=s.context||this,s.level=e,s.ins=t,(s.context||this).interpreter.converse.execFunction(t.name,await this.execParams(t,t.params,e,n),n,this.user,s))}hasApiFn(t){return this.converse._functions[t]||p.isSystemFunction(t)}_triggerHook(t,e,n,s,i=!0){let r=!1;return this.hooks[t]&&(r=!0,this.hooks[t](this.input,e,n,s)),i&&this.parent&&this.parent._hooks[t]&&(r=!0,this.parent._hooks[t](this.input,e,n,s)),r}}t.exports=class{constructor(t,e,n){this._obj=t,this.index={},this._users=e,this.var=[],this.fn={},this.converse=n,this.namespace=this.converse.namespace,this.decorators=new c(this),this.organize(this._obj)}organize(t,e="root",n=[]){const s=i=>{let r=t[i];if(r){if(r.id=this.setId(r,e),r.type&&"function"==r.type){this.fn[r.name]=r,this.decorators.add(r);const t=-1!=r.decorators.findIndex(t=>"Event"==t.name&&t.params&&t.params[0]==l.CAN_ACTIVATE);return this.organize(r.instructions,r.name),i++,this.index[r.id]={level:r.name,namespace:this.namespace,index:-1,deep:n,hasActivateDecorator:t},void s(i)}(r.condition||r.loop)&&this.organize(r.instructions,e,n.concat(r.id)),r.conditionsElse&&(r.conditionsElse.id=this.setId(r.conditionsElse,e),this.organize(r.conditionsElse.instructions,e,n.concat(r.conditionsElse.id)),this.index[r.conditionsElse.id]={level:e,index:i,namespace:this.namespace,deep:n},i++),this.index[r.id]={level:e,index:i,namespace:this.namespace,deep:n},i++,s(i)}};s(0)}setId(t,e){let n=e+"-"+i(JSON.stringify(t));this.namespace&&(n+="-"+this.namespace);let s=1;for(;this.index[n+"-"+s];)s++;return n+"-"+s}exec(t,e,n,i){return new Promise((r,o)=>{this.execution=new p(t,e,s.merge({_finishScript:r,_errorScript:o},n),i,this)})}}},function(t,e){var n={utf8:{stringToBytes:function(t){return n.bin.stringToBytes(unescape(encodeURIComponent(t)))},bytesToString:function(t){return decodeURIComponent(escape(n.bin.bytesToString(t)))}},bin:{stringToBytes:function(t){for(var e=[],n=0;n<t.length;n++)e.push(255&t.charCodeAt(n));return e},bytesToString:function(t){for(var e=[],n=0;n<t.length;n++)e.push(String.fromCharCode(t[n]));return e.join("")}}};t.exports=n},function(t,e){t.exports=function(t){return!!t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof t.then}},function(t,e,n){const s=n(23);t.exports=class extends s{static get CAN_ACTIVATE(){return"canActivate"}start(){return"start"==this.params[0]}nothing(){return"nothing"==this.params[0]}}},function(t,e,n){(function(e){const n="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\u1ab0-\\u1aff\\u1dc0-\\u1dff",s="[\\ud800-\\udfff]",i=`[${n}]`,r="\\ud83c[\\udffb-\\udfff]",o="[^\\ud800-\\udfff]",a="(?:\\ud83c[\\udde6-\\uddff]){2}",u="[\\ud800-\\udbff][\\udc00-\\udfff]",c=`${`(?:${i}|${r})`}?`,l="[\\ufe0e\\ufe0f]?"+c+`(?:\\u200d(?:${[o,a,u].join("|")})${"[\\ufe0e\\ufe0f]?"+c})*`,h=`(?:${[`${o}${i}?`,i,a,u,s].join("|")})`,p=RegExp(`[${"\\u200d\\ud800-\\udfff"+n+"\\ufe0e\\ufe0f"}]`),f=RegExp(`${r}(?=${r})|${h+l}`,"g"),g=t=>p.test(t),d=t=>t.match(f)||[],m=t=>t.split("");t.exports={hasUnicode:g,unicodeToArray:d,asciiToArray:m,stringToArray:t=>g(t)?d(t):m(t),compareWildcars:function(t,e){const n=`^${e.split("*").map(t=>t.replace(/([.*+^=!:${}()|[\]/\\])/g,"\\$1")).join(".*")}$`.replace(/\?/g,".");return new RegExp(n).test(t)},loadEnvFromJson:function(t,n={}){const s=Object.keys(n);t=t?`${t}_`:"";for(let i=0;i<s.length;i+=1){const r=`${t}${s[i]}`;e.env[r]=n[s[i]]}}}}).call(this,n(43))},function(t,e){const n=new class{constructor(){this.name="logger"}debug(...t){console.debug(...t)}info(...t){console.info(...t)}warn(...t){console.warn(...t)}error(...t){console.error(...t)}log(...t){console.log(...t)}trace(...t){console.trace(...t)}fatal(...t){console.error(...t)}};t.exports=n},function(t,e,n){const{defaultContainer:s}=n(6),i=n(82);t.exports=class{constructor(t=s,e=!1){this.container=t.container||t,this.name="tokenize",this.shouldNormalize=e}getNormalizer(){return this.normalizer||(this.normalizer=this.container.get(`normalizer-${this.name.slice(-2)}`)||new i),this.normalizer}normalize(t,e){if(void 0===e&&this.shouldNormalize||!0===e){return this.getNormalizer().normalize(t)}return t}innerTokenize(t){return t.split(/[\s,.!?;:([\]'")/]+/).filter(t=>t)}tokenize(t,e){return this.innerTokenize(this.normalize(t,e))}run(t){const e=t,n=e.locale||"en",s=this.container.get(`tokenizer-${n}`)||this;return e.tokens=s.tokenize(e.text,e).filter(t=>t),e}}},function(t,e,n){const{defaultContainer:s}=n(6);t.exports=class{constructor(t=s){this.container=t.container||t,this.name="normalize"}normalize(t){return t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}run(t){const e=t,n=e.locale||"en",s=this.container.get(`normalizer-${n}`)||this;return e.text=s.normalize(e.text,e),e}}},function(t,e,n){const{defaultContainer:s}=n(6);t.exports=class{constructor(t={},e=s){this.container=t.container||e,this.applySettings(this,t)}get logger(){return this.container.get("logger")}applySettings(t,e={}){const n=t||{};return Object.keys(e).forEach(t=>{void 0===n[t]&&(n[t]=e[t])}),n}toJSON(){const t=this.jsonExport||{},e={},n=Object.keys(this);for(let s=0;s<n.length;s+=1){const i=n[s];if("jsonExport"!==i&&"jsonImport"!==i&&"container"!==i&&!i.startsWith("pipeline")){const n=void 0===t[i]||t[i];if("function"==typeof n){const t=n.bind(this)(e,this,i,this[i]);t&&(e[i]=t)}else"boolean"==typeof n?n&&(e[i]=this[i],"settings"===i&&delete e[i].container):"string"==typeof n&&(e[n]=this[i])}}return e}fromJSON(t){const e=this.jsonImport||{},n=Object.keys(t);for(let s=0;s<n.length;s+=1){const i=n[s],r=void 0===e[i]||e[i];if("function"==typeof r){const e=r.bind(this)(this,t,i,t[i]);e&&(this[i]=e)}else"boolean"==typeof r?r&&(this[i]=t[i]):"string"==typeof r&&(this[r]=t[i])}}objToValues(t,e){const n=e||Object.keys(t),s=[];for(let e=0;e<n.length;e+=1)s.push(t[n[e]]);return s}valuesToObj(t,e){const n={};for(let s=0;s<t.length;s+=1)n[e[s]]=t[s];return n}getPipeline(t){return this.container.getPipeline(t)}async runPipeline(t,e){return this.container.runPipeline(e||this.pipeline,t,this)}use(t){this.container.use(t)}}},,,function(t,e,n){var s=n(87),i=n(128)((function(t,e,n){s(t,e,n)}));t.exports=i},function(t,e,n){var s=n(47),i=n(50),r=n(116),o=n(118),a=n(2),u=n(20),c=n(61);t.exports=function t(e,n,l,h,p){e!==n&&r(n,(function(r,u){if(p||(p=new s),a(r))o(e,n,u,l,t,h,p);else{var f=h?h(c(e,u),r,u+"",e,n,p):void 0;void 0===f&&(f=r),i(e,u,f)}}),u)}},function(t,e){t.exports=function(){this.__data__=[],this.size=0}},function(t,e,n){var s=n(13),i=Array.prototype.splice;t.exports=function(t){var e=this.__data__,n=s(e,t);return!(n<0)&&(n==e.length-1?e.pop():i.call(e,n,1),--this.size,!0)}},function(t,e,n){var s=n(13);t.exports=function(t){var e=this.__data__,n=s(e,t);return n<0?void 0:e[n][1]}},function(t,e,n){var s=n(13);t.exports=function(t){return s(this.__data__,t)>-1}},function(t,e,n){var s=n(13);t.exports=function(t,e){var n=this.__data__,i=s(n,t);return i<0?(++this.size,n.push([t,e])):n[i][1]=e,this}},function(t,e,n){var s=n(12);t.exports=function(){this.__data__=new s,this.size=0}},function(t,e){t.exports=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}},function(t,e){t.exports=function(t){return this.__data__.get(t)}},function(t,e){t.exports=function(t){return this.__data__.has(t)}},function(t,e,n){var s=n(12),i=n(24),r=n(25),o=200;t.exports=function(t,e){var n=this.__data__;if(n instanceof s){var a=n.__data__;if(!i||a.length<o-1)return a.push([t,e]),this.size=++n.size,this;n=this.__data__=new r(a)}return n.set(t,e),this.size=n.size,this}},function(t,e,n){var s=n(15),i=n(101),r=n(2),o=n(49),a=/^\[object .+?Constructor\]$/,u=Function.prototype,c=Object.prototype,l=u.toString,h=c.hasOwnProperty,p=RegExp("^"+l.call(h).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=function(t){return!(!r(t)||i(t))&&(s(t)?p:a).test(o(t))}},function(t,e,n){var s=n(9),i=Object.prototype,r=i.hasOwnProperty,o=i.toString,a=s?s.toStringTag:void 0;t.exports=function(t){var e=r.call(t,a),n=t[a];try{t[a]=void 0;var s=!0}catch(t){}var i=o.call(t);return s&&(e?t[a]=n:delete t[a]),i}},function(t,e){var n=Object.prototype.toString;t.exports=function(t){return n.call(t)}},function(t,e,n){var s,i=n(102),r=(s=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||""))?"Symbol(src)_1."+s:"";t.exports=function(t){return!!r&&r in t}},function(t,e,n){var s=n(1)["__core-js_shared__"];t.exports=s},function(t,e){t.exports=function(t,e){return null==t?void 0:t[e]}},function(t,e,n){var s=n(105),i=n(12),r=n(24);t.exports=function(){this.size=0,this.__data__={hash:new s,map:new(r||i),string:new s}}},function(t,e,n){var s=n(106),i=n(107),r=n(108),o=n(109),a=n(110);function u(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var s=t[e];this.set(s[0],s[1])}}u.prototype.clear=s,u.prototype.delete=i,u.prototype.get=r,u.prototype.has=o,u.prototype.set=a,t.exports=u},function(t,e,n){var s=n(16);t.exports=function(){this.__data__=s?s(null):{},this.size=0}},function(t,e){t.exports=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}},function(t,e,n){var s=n(16),i="__lodash_hash_undefined__",r=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;if(s){var n=e[t];return n===i?void 0:n}return r.call(e,t)?e[t]:void 0}},function(t,e,n){var s=n(16),i=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;return s?void 0!==e[t]:i.call(e,t)}},function(t,e,n){var s=n(16),i="__lodash_hash_undefined__";t.exports=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=s&&void 0===e?i:e,this}},function(t,e,n){var s=n(17);t.exports=function(t){var e=s(this,t).delete(t);return this.size-=e?1:0,e}},function(t,e){t.exports=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}},function(t,e,n){var s=n(17);t.exports=function(t){return s(this,t).get(t)}},function(t,e,n){var s=n(17);t.exports=function(t){return s(this,t).has(t)}},function(t,e,n){var s=n(17);t.exports=function(t,e){var n=s(this,t),i=n.size;return n.set(t,e),this.size+=n.size==i?0:1,this}},function(t,e,n){var s=n(117)();t.exports=s},function(t,e){t.exports=function(t){return function(e,n,s){for(var i=-1,r=Object(e),o=s(e),a=o.length;a--;){var u=o[t?a:++i];if(!1===n(r[u],u,r))break}return e}}},function(t,e,n){var s=n(50),i=n(52),r=n(53),o=n(54),a=n(55),u=n(31),c=n(3),l=n(57),h=n(32),p=n(15),f=n(2),g=n(59),d=n(60),m=n(61),y=n(124);t.exports=function(t,e,n,v,b,x,A){var w=m(t,n),_=m(e,n),D=A.get(_);if(D)s(t,n,D);else{var F=x?x(w,_,n+"",t,e,A):void 0,C=void 0===F;if(C){var k=c(_),S=!k&&h(_),E=!k&&!S&&d(_);F=_,k||S||E?c(w)?F=w:l(w)?F=o(w):S?(C=!1,F=i(_,!0)):E?(C=!1,F=r(_,!0)):F=[]:g(_)||u(_)?(F=w,u(w)?F=y(w):f(w)&&!p(w)||(F=a(_))):C=!1}C&&(A.set(_,F),b(F,_,v,x,A),A.delete(_)),s(t,n,F)}}},function(t,e,n){var s=n(1).Uint8Array;t.exports=s},function(t,e,n){var s=n(2),i=Object.create,r=function(){function t(){}return function(e){if(!s(e))return{};if(i)return i(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();t.exports=r},function(t,e,n){var s=n(4),i=n(0),r="[object Arguments]";t.exports=function(t){return i(t)&&s(t)==r}},function(t,e){t.exports=function(){return!1}},function(t,e,n){var s=n(4),i=n(58),r=n(0),o={};o["[object Float32Array]"]=o["[object Float64Array]"]=o["[object Int8Array]"]=o["[object Int16Array]"]=o["[object Int32Array]"]=o["[object Uint8Array]"]=o["[object Uint8ClampedArray]"]=o["[object Uint16Array]"]=o["[object Uint32Array]"]=!0,o["[object Arguments]"]=o["[object Array]"]=o["[object ArrayBuffer]"]=o["[object Boolean]"]=o["[object DataView]"]=o["[object Date]"]=o["[object Error]"]=o["[object Function]"]=o["[object Map]"]=o["[object Number]"]=o["[object Object]"]=o["[object RegExp]"]=o["[object Set]"]=o["[object String]"]=o["[object WeakMap]"]=!1,t.exports=function(t){return r(t)&&i(t.length)&&!!o[s(t)]}},function(t,e,n){var s=n(10),i=n(20);t.exports=function(t){return s(t,i(t))}},function(t,e){t.exports=function(t,e){for(var n=-1,s=Array(t);++n<t;)s[n]=e(n);return s}},function(t,e,n){var s=n(2),i=n(30),r=n(127),o=Object.prototype.hasOwnProperty;t.exports=function(t){if(!s(t))return r(t);var e=i(t),n=[];for(var a in t)("constructor"!=a||!e&&o.call(t,a))&&n.push(a);return n}},function(t,e){t.exports=function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}},function(t,e,n){var s=n(63),i=n(65);t.exports=function(t){return s((function(e,n){var s=-1,r=n.length,o=r>1?n[r-1]:void 0,a=r>2?n[2]:void 0;for(o=t.length>3&&"function"==typeof o?(r--,o):void 0,a&&i(n[0],n[1],a)&&(o=r<3?void 0:o,r=1),e=Object(e);++s<r;){var u=n[s];u&&t(e,u,s,o)}return e}))}},function(t,e,n){var s=n(130),i=Math.max;t.exports=function(t,e,n){return e=i(void 0===e?t.length-1:e,0),function(){for(var r=arguments,o=-1,a=i(r.length-e,0),u=Array(a);++o<a;)u[o]=r[e+o];o=-1;for(var c=Array(e+1);++o<e;)c[o]=r[o];return c[e]=n(u),s(t,this,c)}}},function(t,e){t.exports=function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}},function(t,e,n){var s=n(132),i=n(134)(s);t.exports=i},function(t,e,n){var s=n(133),i=n(51),r=n(64),o=i?function(t,e){return i(t,"toString",{configurable:!0,enumerable:!1,value:s(e),writable:!0})}:r;t.exports=o},function(t,e){t.exports=function(t){return function(){return t}}},function(t,e){var n=800,s=16,i=Date.now;t.exports=function(t){var e=0,r=0;return function(){var o=i(),a=s-(o-r);if(r=o,a>0){if(++e>=n)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}},function(t,e,n){var s=n(4),i=n(3),r=n(0),o="[object String]";t.exports=function(t){return"string"==typeof t||!i(t)&&r(t)&&s(t)==o}},function(t,e,n){var s=n(66),i=4;t.exports=function(t){return s(t,i)}},function(t,e){t.exports=function(t,e){for(var n=-1,s=null==t?0:t.length;++n<s&&!1!==e(t[n],n,t););return t}},function(t,e,n){var s=n(10),i=n(36);t.exports=function(t,e){return t&&s(e,i(e),t)}},function(t,e,n){var s=n(30),i=n(140),r=Object.prototype.hasOwnProperty;t.exports=function(t){if(!s(t))return i(t);var e=[];for(var n in Object(t))r.call(t,n)&&"constructor"!=n&&e.push(n);return e}},function(t,e,n){var s=n(56)(Object.keys,Object);t.exports=s},function(t,e,n){var s=n(10),i=n(20);t.exports=function(t,e){return t&&s(e,i(e),t)}},function(t,e,n){var s=n(10),i=n(37);t.exports=function(t,e){return s(t,i(t),e)}},function(t,e){t.exports=function(t,e){for(var n=-1,s=null==t?0:t.length,i=0,r=[];++n<s;){var o=t[n];e(o,n,t)&&(r[i++]=o)}return r}},function(t,e,n){var s=n(10),i=n(68);t.exports=function(t,e){return s(t,i(t),e)}},function(t,e,n){var s=n(69),i=n(37),r=n(36);t.exports=function(t){return s(t,r,i)}},function(t,e,n){var s=n(69),i=n(68),r=n(20);t.exports=function(t){return s(t,r,i)}},function(t,e,n){var s=n(8)(n(1),"DataView");t.exports=s},function(t,e,n){var s=n(8)(n(1),"Promise");t.exports=s},function(t,e,n){var s=n(8)(n(1),"Set");t.exports=s},function(t,e,n){var s=n(8)(n(1),"WeakMap");t.exports=s},function(t,e){var n=Object.prototype.hasOwnProperty;t.exports=function(t){var e=t.length,s=new t.constructor(e);return e&&"string"==typeof t[0]&&n.call(t,"index")&&(s.index=t.index,s.input=t.input),s}},function(t,e,n){var s=n(28),i=n(153),r=n(154),o=n(155),a=n(53),u="[object Boolean]",c="[object Date]",l="[object Map]",h="[object Number]",p="[object RegExp]",f="[object Set]",g="[object String]",d="[object Symbol]",m="[object ArrayBuffer]",y="[object DataView]",v="[object Float32Array]",b="[object Float64Array]",x="[object Int8Array]",A="[object Int16Array]",w="[object Int32Array]",_="[object Uint8Array]",D="[object Uint8ClampedArray]",F="[object Uint16Array]",C="[object Uint32Array]";t.exports=function(t,e,n){var k=t.constructor;switch(e){case m:return s(t);case u:case c:return new k(+t);case y:return i(t,n);case v:case b:case x:case A:case w:case _:case D:case F:case C:return a(t,n);case l:return new k;case h:case g:return new k(t);case p:return r(t);case f:return new k;case d:return o(t)}}},function(t,e,n){var s=n(28);t.exports=function(t,e){var n=e?s(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}},function(t,e){var n=/\w*$/;t.exports=function(t){var e=new t.constructor(t.source,n.exec(t));return e.lastIndex=t.lastIndex,e}},function(t,e,n){var s=n(9),i=s?s.prototype:void 0,r=i?i.valueOf:void 0;t.exports=function(t){return r?Object(r.call(t)):{}}},function(t,e,n){var s=n(157),i=n(19),r=n(33),o=r&&r.isMap,a=o?i(o):s;t.exports=a},function(t,e,n){var s=n(39),i=n(0),r="[object Map]";t.exports=function(t){return i(t)&&s(t)==r}},function(t,e,n){var s=n(159),i=n(19),r=n(33),o=r&&r.isSet,a=o?i(o):s;t.exports=a},function(t,e,n){var s=n(39),i=n(0),r="[object Set]";t.exports=function(t){return i(t)&&s(t)==r}},function(t,e,n){var s=n(66),i=1,r=4;t.exports=function(t){return s(t,i|r)}},function(t,e,n){var s=n(162);t.exports=function(t,e,n){return null==t?t:s(t,e,n)}},function(t,e,n){var s=n(34),i=n(70),r=n(35),o=n(2),a=n(72);t.exports=function(t,e,n,u){if(!o(t))return t;for(var c=-1,l=(e=i(e,t)).length,h=l-1,p=t;null!=p&&++c<l;){var f=a(e[c]),g=n;if(c!=h){var d=p[f];void 0===(g=u?u(d,f,p):void 0)&&(g=o(d)?d:r(e[c+1])?[]:{})}s(p,f,g),p=p[f]}return t}},function(t,e,n){var s=n(3),i=n(21),r=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,o=/^\w*$/;t.exports=function(t,e){if(s(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!i(t))||(o.test(t)||!r.test(t)||null!=e&&t in Object(e))}},function(t,e,n){var s=n(165),i=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,r=/\\(\\)?/g,o=s((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(i,(function(t,n,s,i){e.push(s?i.replace(r,"$1"):n||t)})),e}));t.exports=o},function(t,e,n){var s=n(166),i=500;t.exports=function(t){var e=s(t,(function(t){return n.size===i&&n.clear(),t})),n=e.cache;return e}},function(t,e,n){var s=n(25),i="Expected a function";function r(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(i);var n=function(){var s=arguments,i=e?e.apply(this,s):s[0],r=n.cache;if(r.has(i))return r.get(i);var o=t.apply(this,s);return n.cache=r.set(i,o)||r,o};return n.cache=new(r.Cache||s),n}r.Cache=s,t.exports=r},function(t,e,n){var s=n(168);t.exports=function(t){return null==t?"":s(t)}},function(t,e,n){var s=n(9),i=n(71),r=n(3),o=n(21),a=1/0,u=s?s.prototype:void 0,c=u?u.toString:void 0;t.exports=function t(e){if("string"==typeof e)return e;if(r(e))return i(e,t)+"";if(o(e))return c?c.call(e):"";var n=e+"";return"0"==n&&1/e==-a?"-0":n}},function(t,e,n){var s=n(170);t.exports=function(t,e,n){var i=null==t?void 0:s(t,e);return void 0===i?n:i}},function(t,e,n){var s=n(70),i=n(72);t.exports=function(t,e){for(var n=0,r=(e=s(e,t)).length;null!=t&&n<r;)t=t[i(e[n++])];return n&&n==r?t:void 0}},function(t,e){t.exports=function(t){return void 0===t}},function(t,e){t.exports=function(t){return null===t}},function(t,e,n){var s=n(4),i=n(0),r="[object Boolean]";t.exports=function(t){return!0===t||!1===t||i(t)&&s(t)==r}},function(t,e,n){var s=n(175),i=n(65),r=n(176),o=parseFloat,a=Math.min,u=Math.random;t.exports=function(t,e,n){if(n&&"boolean"!=typeof n&&i(t,e,n)&&(e=n=void 0),void 0===n&&("boolean"==typeof e?(n=e,e=void 0):"boolean"==typeof t&&(n=t,t=void 0)),void 0===t&&void 0===e?(t=0,e=1):(t=r(t),void 0===e?(e=t,t=0):e=r(e)),t>e){var c=t;t=e,e=c}if(n||t%1||e%1){var l=u();return a(t+l*(e-t+o("1e-"+((l+"").length-1))),e)}return s(t,e)}},function(t,e){var n=Math.floor,s=Math.random;t.exports=function(t,e){return t+n(s()*(e-t+1))}},function(t,e,n){var s=n(177),i=1/0,r=17976931348623157e292;t.exports=function(t){return t?(t=s(t))===i||t===-i?(t<0?-1:1)*r:t==t?t:0:0===t?t:0}},function(t,e,n){var s=n(2),i=n(21),r=NaN,o=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,u=/^0b[01]+$/i,c=/^0o[0-7]+$/i,l=parseInt;t.exports=function(t){if("number"==typeof t)return t;if(i(t))return r;if(s(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=s(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(o,"");var n=u.test(t);return n||c.test(t)?l(t.slice(2),n?2:8):a.test(t)?r:+t}},function(t,e){t.exports=function(t){var e=null==t?0:t.length;return e?t[e-1]:void 0}},function(t,e,n){var s=n(73);t.exports=function(t){return s(t)&&t!=+t}},function(t,e,n){var s=n(74);t.exports=function(t){return(null==t?0:t.length)?s(t,1):[]}},function(t,e,n){var s=n(9),i=n(31),r=n(3),o=s?s.isConcatSpreadable:void 0;t.exports=function(t){return r(t)||i(t)||!!(o&&t&&t[o])}},function(t,e,n){var s=n(183),i=n(74),r=n(63),o=n(57),a=r((function(t,e){return o(t)?s(t,i(e,1,o,!0)):[]}));t.exports=a},function(t,e,n){var s=n(184),i=n(187),r=n(192),o=n(71),a=n(19),u=n(193),c=200;t.exports=function(t,e,n,l){var h=-1,p=i,f=!0,g=t.length,d=[],m=e.length;if(!g)return d;n&&(e=o(e,a(n))),l?(p=r,f=!1):e.length>=c&&(p=u,f=!1,e=new s(e));t:for(;++h<g;){var y=t[h],v=null==n?y:n(y);if(y=l||0!==y?y:0,f&&v==v){for(var b=m;b--;)if(e[b]===v)continue t;d.push(y)}else p(e,v,l)||d.push(y)}return d}},function(t,e,n){var s=n(25),i=n(185),r=n(186);function o(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new s;++e<n;)this.add(t[e])}o.prototype.add=o.prototype.push=i,o.prototype.has=r,t.exports=o},function(t,e){var n="__lodash_hash_undefined__";t.exports=function(t){return this.__data__.set(t,n),this}},function(t,e){t.exports=function(t){return this.__data__.has(t)}},function(t,e,n){var s=n(188);t.exports=function(t,e){return!!(null==t?0:t.length)&&s(t,e,0)>-1}},function(t,e,n){var s=n(189),i=n(190),r=n(191);t.exports=function(t,e,n){return e==e?r(t,e,n):s(t,i,n)}},function(t,e){t.exports=function(t,e,n,s){for(var i=t.length,r=n+(s?1:-1);s?r--:++r<i;)if(e(t[r],r,t))return r;return-1}},function(t,e){t.exports=function(t){return t!=t}},function(t,e){t.exports=function(t,e,n){for(var s=n-1,i=t.length;++s<i;)if(t[s]===e)return s;return-1}},function(t,e){t.exports=function(t,e,n){for(var s=-1,i=null==t?0:t.length;++s<i;)if(n(e,t[s]))return!0;return!1}},function(t,e){t.exports=function(t,e){return t.has(e)}},function(t,e,n){(function(t){function n(t,e){for(var n=0,s=t.length-1;s>=0;s--){var i=t[s];"."===i?t.splice(s,1):".."===i?(t.splice(s,1),n++):n&&(t.splice(s,1),n--)}if(e)for(;n--;n)t.unshift("..");return t}var s=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,i=function(t){return s.exec(t).slice(1)};function r(t,e){if(t.filter)return t.filter(e);for(var n=[],s=0;s<t.length;s++)e(t[s],s,t)&&n.push(t[s]);return n}e.resolve=function(){for(var e="",s=!1,i=arguments.length-1;i>=-1&&!s;i--){var o=i>=0?arguments[i]:t.cwd();if("string"!=typeof o)throw new TypeError("Arguments to path.resolve must be strings");o&&(e=o+"/"+e,s="/"===o.charAt(0))}return(s?"/":"")+(e=n(r(e.split("/"),(function(t){return!!t})),!s).join("/"))||"."},e.normalize=function(t){var s=e.isAbsolute(t),i="/"===o(t,-1);return(t=n(r(t.split("/"),(function(t){return!!t})),!s).join("/"))||s||(t="."),t&&i&&(t+="/"),(s?"/":"")+t},e.isAbsolute=function(t){return"/"===t.charAt(0)},e.join=function(){var t=Array.prototype.slice.call(arguments,0);return e.normalize(r(t,(function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t})).join("/"))},e.relative=function(t,n){function s(t){for(var e=0;e<t.length&&""===t[e];e++);for(var n=t.length-1;n>=0&&""===t[n];n--);return e>n?[]:t.slice(e,n-e+1)}t=e.resolve(t).substr(1),n=e.resolve(n).substr(1);for(var i=s(t.split("/")),r=s(n.split("/")),o=Math.min(i.length,r.length),a=o,u=0;u<o;u++)if(i[u]!==r[u]){a=u;break}var c=[];for(u=a;u<i.length;u++)c.push("..");return(c=c.concat(r.slice(a))).join("/")},e.sep="/",e.delimiter=":",e.dirname=function(t){var e=i(t),n=e[0],s=e[1];return n||s?(s&&(s=s.substr(0,s.length-1)),n+s):"."},e.basename=function(t,e){var n=i(t)[2];return e&&n.substr(-1*e.length)===e&&(n=n.substr(0,n.length-e.length)),n},e.extname=function(t){return i(t)[3]};var o="b"==="ab".substr(-1)?function(t,e,n){return t.substr(e,n)}:function(t,e,n){return e<0&&(e=t.length+e),t.substr(e,n)}}).call(this,n(43))},function(t,e,n){const s=n(196);var i,r=((i=new s).instance=function(){return i=new s},String.prototype.t=function(...t){return i.translate(this,...t)},"undefined"!=typeof Handlebars&&i.load.Handlebars(Handlebars),"undefined"!=typeof angular&&i.load.Angular(angular),"undefined"!=typeof Vue&&Vue.use(i.load.Vue),i);t.exports=r},function(t,e,n){let s,i=!1;"undefined"==typeof window&&(s=n(197),i=!0),t.exports=class t{constructor(){this.current="en",this.data={},this.options={},this._path=null,this._cache={},this._list=[]}set(t,e){return this.init(t,this._path,e),this}add(t,e,n,s){this.init(t,e,s,{namespace:n})}packages(t,e={}){let n=[];const s=e.namespace||"self";this._cache[s]||(this._cache[s]={});for(let e in t)this._cache[s][e]=t[e],n.push(e);return this.init(n,!1,!1,e)}default(t){this.current=t}all(t,e,n={}){const i=s=>{let i=[],r=/\.json$/;for(let t of s)r.test(t)&&i.push(t.replace(r,""));this.init(i,t,e,n)};e?s.readdir(t,(t,e)=>{if(t)throw t;i(e)}):i(s.readdirSync(t))}init(t,e,n,i={}){let r,o;const a=i.namespace||"self";"function"==typeof e&&(n=e,e=!1),this._path=e,t instanceof Array||(t=[t]),this._list=t;let u=(t=>t+="_"+t.toUpperCase())(this.getUserLanguage().replace(/\-.+/,""));-1==this._list.indexOf(u)?this.current=this._list[0]:this.current=u,e&&(r=e+this.current+".json");let c=(t,s,i)=>{let r;s||(s=this.current),e?(t=t.toString("utf8"),r=JSON.parse(t)):r=t,this._cache[a]||(this._cache[a]={});let[o,u]=r;this.data[s]={},this.options[s]={},this.data[s][a]=this._initMultiple(o),this.options[s][a]=u,this._cache[a][s]=t,n&&!i&&n.call(self)};if(this._cache[a]&&this._cache[a][this.current]){for(let t in this._cache[a])c(this._cache[a][t],t);return this}if(s){if(n){let t=0;for(let i of this._list)s.readFile(e+i+".json",(e,s)=>{if(e)throw e;c(s,i,!0),t++,n&&t==this._list.length&&n.call(this)})}else for(let t of this._list)c(s.readFileSync(e+t+".json"),t,!0);return this}try{o=new XMLHttpRequest}catch(t){o=!1}return o.onreadystatechange=()=>{4==o.readyState&&200==o.status&&c(o.responseText)},o.open("GET",r,!0),o.send(),this}getUserLanguage(){const t=this._list[0];return i?t:navigator.language||navigator.userLanguage||t}_initMultiple(t){let e,n,s={},i={};function r(t,e,n,s){let i={},r=s?s[t]:e[t],o=n.split(" ");for(let s in r){let r=n.replace(t,s);e[n].text?i[r]={text:e[n].text,replacePattern:e[n].replacePattern.map(e=>t==e?s:e)}:i[r]={text:e[n],replacePattern:o.map(e=>t==e?s:e)}}return i}function o(t,e){for(let n in e)t[n]=e[n];return t}const a=JSON.parse(JSON.stringify(t));for(let u in a){let a=/^\$[^ ]+$/.test(u),c=/\[(.+)\]/,l=/\$[^ ]+/g;if(c.test(u)){e=c.exec(u)[1].split(",");for(let n of e)t[u.replace(c,n)]=t[u]}if(l.test(u)&&!a)if(s={},i={},n=u.match(l),s=r(n[0],t,u),n.length>1)for(let e in s)i=r(n[1],s,e,t),o(t,i);else o(t,s);if(a){if(t[u]instanceof Array){let e={},n=u.replace(/^\$/,"");for(let s=0;s<t[u].length;s++)e[n+"_"+s]=t[u][s];t[u]=e}for(let e in t[u])t[e]=t[u][e]}}return t}get(t,e,n){return n=n||this.current,e=e||"self",this.data[n]&&this.data[n][e]?this.replaceWorlds(this.data[n][e][t],t,e):""}capitalizeFirstLetter(t){return t.charAt(0).toUpperCase()+t.slice(1)}replaceWorlds(t,e,n){let s={};return t?(t.text&&(s=t,t=t.text),t.replace(/\{([0-9]+)\}/g,(t,i)=>{let r=s.replacePattern||e.split(" ");return this.get(r[i-1],n)})):t}getGroup(t,e="self"){let n=this.data[this.current][e]["$"+t],s=[];for(let t in n)s.push(t);return s}render(t,{patternStart:e="{{",patternEnd:n="}}",pipe:s="|",fnStart:i="",fnEnd:r="",paramsSeparator:o=":"}={},a){const u=t=>t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");e=u(e),n=u(n),s=u(s),i=u(i),r=u(r);let c=u(o);const l=new RegExp(`${e}([^${n}]+)${s}[ ]*t(${c}?${i}([^${n}]+)${r})?${n}`,"g");return t=t.replace(l,(t,e,n,s,i,r)=>(e=(e=e.replace(/["']/g,"")).trim(),s=s?(s=s.split(o)).map(t=>((t=t.trim())>=0||t<=0?t=+t:"true"==t?t="true"===t:"false"==t&&(t="false"===t),t)):[],a&&(s=[a,...s]),this.translate(e,...s)))}getPlurial(t,e,n,s){if(n=n||"self",s=s||this.current,t=Math.abs(t),!/^[0-9]+$/.test(t))return!1;let i=this.options[s][n].plurial[e];return i||(i=["s"]),t>2&&i[t-1]?i[t-1]:t>1?i[0]:i[1]||""}format(t,e,n,...s){let i,r,o=-1,a=t.match(/%[sdp]/g);if(!a)return t;for(let t of a)if(o++,"%d"==t)i=s[o];else if("%p"==t)break;return o=-1,t.replace(/%[sdp]([0-9]+)?/g,(t,a)=>(o++,r=void 0!==s[o]?s[o]:t,/^%p/.test(t)&&(null==i&&(i=r),"number"!=typeof i&&(i=0),r=this.getPlurial(i,t.replace("%",""),e,n)),r))}get load(){let e=this;return{Handlebars:t=>(t.registerHelper("t",(function(t,e){var n=e.hash.nb,s=e.hash.if;return void 0===n?t.t():void 0===s?t.t(+n):t.t(s,+n)})),t),Pug:(t={})=>(t.translate=t=>e.render(t),t),Angular(n){n.module("Languages",[]).provider("Languages",(function(){this.init=e.init.bind(t),this.$get=function(){return e}})).filter("t",(function(){return function(t,...e){return t.t(...e)}}))},get Vue(){return{install(t,n){t.Languages=e,t.filter("t",(t,...n)=>e.translate(t,...n))}}}}}translate(t,...e){var n,s,i;if(null==t)return"";let r=e[0];function o(){e.shift(),r=e[0]}if(-1!=this._list.indexOf(e[0])&&(i=r,o()),"boolean"==typeof r){let e=t.match(/\((.*?)\)/);e?(n=e[1].split("|"),s=r?t.replace(e[0],n[0].trim()):t.replace(e[0],n[1].trim())):(n=t.split("|"),s=r?n[0]:n[1]),o()}else s=t;let a=s.split("+"),u="";for(let t of a){let n,s;(n=/(.+)\.(.+)/.exec(t))&&(s=n[1],t=n[2]);let r=this.get(t.trim(),s,i);r&&(u+=this.format(r,s,i,...e)),u+=" "}return this.capitalizeFirstLetter(u.trim())}}},function(t,e){},function(t,e,n){const s=n(7);t.exports=class{constructor(t){this.address={},this._infoAddress={lock:{},actived:{}},this.varFn={},this.magicVar={},this.variables={},this.id=t,this.lang=null,this._history=[],this._nlpCache={}}_createNamespace(t){this.address[t]||(this.address[t]=[]),this.variables[t]||(this.variables[t]={}),this.varFn[t]||(this.varFn[t]={})}addAddress(t,e){this._createNamespace(e),this.address[e].push(t)}getAddress(t){return this._createNamespace(t),s.last(this.address[t])}hasAddress(t){return this._createNamespace(t),this.address[t].length>0}clearAddress(t){this._createNamespace(t),this.address[t]=[]}popAddress(t){this._createNamespace(t),this.address[t].pop()}garbage(t,e){this._createNamespace(e),delete this.varFn[e][t]}hasLockAddressStack(t){return!!this._infoAddress.lock[t]}lockAddressStack(t,e,{activated:n}={}){this._infoAddress.lock[t]=e,n&&(this._infoAddress.actived[t]=e)}unlockAddressStack(t,e,{activated:n}={}){this._infoAddress.lock[t]===e&&(delete this._infoAddress.lock[t],n&&delete this._infoAddress.actived[t])}addressStackIslocked(t){return this._infoAddress.lock[t]}getVariables(t){return this._createNamespace(t),this.variables[t]}getVariable(t,e){return e=e.replace(/^\$/,""),this._createNamespace(t),this.variables[t][e]}setVariable(t,e,n){e=e.replace(/^\$/,""),this._createNamespace(t),this.variables[t][e]=n}getVariableInFonction(t,e,n){return this._createNamespace(t),this.varFn[t][e]||(this.varFn[t][e]={}),n?this.varFn[t][e][n]:this.varFn[t][e]}setVariableInFonction(t,e,n,s){return this._createNamespace(t),this.varFn[t][e]||(this.varFn[t][e]={}),this.varFn[t][e][n]=s}getMagicVariable(t){return this.magicVar[t]}setMagicVariable(t,e){this.magicVar[t]=e}saveSession(t){this.session=t}retrieveSession(){return this.session}setLang(t){this.lang=t}getLang(){return this.lang}addHistory(t){this._history.push(t)}resetHistory(t){this._history=[]}toJson(){return{_current:{_address:this.address,_var:this.varFn,_magicVar:this.magicVar,_infoAddress:this._infoAddress},_session:this.session,data:this.variables,lang:this.lang,id:this.id}}fromJson(t){return this.address=t._current._address||{},this._infoAddress=t._current._infoAddress||{lock:{}},this.varFn=t._current._var||{},this.magicVar=t._current._magicVar||{},this.session=t._session||{},this.variables=t.data||{},this.lang=t.lang,this.id=t.id,this}}},function(t,e,n){(function(e){const s=n(7),i=n(22),r=n(40);let o;o=i.is()?window.newbotParser:e.newbotParser,"undefined"!=typeof window&&(window._=s);t.exports=class{constructor(t,e){this.variables={},this._script=t,this.namespace=e,this.parser=o}run(t){if(i.is()&&!this.parser)throw'You can not use the parser. Integrate rather the "newbot.with-parser.min.js" file';try{return this.parser.parse(this._script)}catch(t){new r(this._script,this.namespace).syntax(t)}}line(t){return t=t.trim(),this.parser.parse(t)}isVariable(){}}}).call(this,n(42))},function(t,e,n){var s,i,r,o,a;s=n(201),i=n(76).utf8,r=n(202),o=n(76).bin,(a=function(t,e){t.constructor==String?t=e&&"binary"===e.encoding?o.stringToBytes(t):i.stringToBytes(t):r(t)?t=Array.prototype.slice.call(t,0):Array.isArray(t)||(t=t.toString());for(var n=s.bytesToWords(t),u=8*t.length,c=1732584193,l=-271733879,h=-1732584194,p=271733878,f=0;f<n.length;f++)n[f]=16711935&(n[f]<<8|n[f]>>>24)|4278255360&(n[f]<<24|n[f]>>>8);n[u>>>5]|=128<<u%32,n[14+(u+64>>>9<<4)]=u;var g=a._ff,d=a._gg,m=a._hh,y=a._ii;for(f=0;f<n.length;f+=16){var v=c,b=l,x=h,A=p;c=g(c,l,h,p,n[f+0],7,-680876936),p=g(p,c,l,h,n[f+1],12,-389564586),h=g(h,p,c,l,n[f+2],17,606105819),l=g(l,h,p,c,n[f+3],22,-1044525330),c=g(c,l,h,p,n[f+4],7,-176418897),p=g(p,c,l,h,n[f+5],12,1200080426),h=g(h,p,c,l,n[f+6],17,-1473231341),l=g(l,h,p,c,n[f+7],22,-45705983),c=g(c,l,h,p,n[f+8],7,1770035416),p=g(p,c,l,h,n[f+9],12,-1958414417),h=g(h,p,c,l,n[f+10],17,-42063),l=g(l,h,p,c,n[f+11],22,-1990404162),c=g(c,l,h,p,n[f+12],7,1804603682),p=g(p,c,l,h,n[f+13],12,-40341101),h=g(h,p,c,l,n[f+14],17,-1502002290),c=d(c,l=g(l,h,p,c,n[f+15],22,1236535329),h,p,n[f+1],5,-165796510),p=d(p,c,l,h,n[f+6],9,-1069501632),h=d(h,p,c,l,n[f+11],14,643717713),l=d(l,h,p,c,n[f+0],20,-373897302),c=d(c,l,h,p,n[f+5],5,-701558691),p=d(p,c,l,h,n[f+10],9,38016083),h=d(h,p,c,l,n[f+15],14,-660478335),l=d(l,h,p,c,n[f+4],20,-405537848),c=d(c,l,h,p,n[f+9],5,568446438),p=d(p,c,l,h,n[f+14],9,-1019803690),h=d(h,p,c,l,n[f+3],14,-187363961),l=d(l,h,p,c,n[f+8],20,1163531501),c=d(c,l,h,p,n[f+13],5,-1444681467),p=d(p,c,l,h,n[f+2],9,-51403784),h=d(h,p,c,l,n[f+7],14,1735328473),c=m(c,l=d(l,h,p,c,n[f+12],20,-1926607734),h,p,n[f+5],4,-378558),p=m(p,c,l,h,n[f+8],11,-2022574463),h=m(h,p,c,l,n[f+11],16,1839030562),l=m(l,h,p,c,n[f+14],23,-35309556),c=m(c,l,h,p,n[f+1],4,-1530992060),p=m(p,c,l,h,n[f+4],11,1272893353),h=m(h,p,c,l,n[f+7],16,-155497632),l=m(l,h,p,c,n[f+10],23,-1094730640),c=m(c,l,h,p,n[f+13],4,681279174),p=m(p,c,l,h,n[f+0],11,-358537222),h=m(h,p,c,l,n[f+3],16,-722521979),l=m(l,h,p,c,n[f+6],23,76029189),c=m(c,l,h,p,n[f+9],4,-640364487),p=m(p,c,l,h,n[f+12],11,-421815835),h=m(h,p,c,l,n[f+15],16,530742520),c=y(c,l=m(l,h,p,c,n[f+2],23,-995338651),h,p,n[f+0],6,-198630844),p=y(p,c,l,h,n[f+7],10,1126891415),h=y(h,p,c,l,n[f+14],15,-1416354905),l=y(l,h,p,c,n[f+5],21,-57434055),c=y(c,l,h,p,n[f+12],6,1700485571),p=y(p,c,l,h,n[f+3],10,-1894986606),h=y(h,p,c,l,n[f+10],15,-1051523),l=y(l,h,p,c,n[f+1],21,-2054922799),c=y(c,l,h,p,n[f+8],6,1873313359),p=y(p,c,l,h,n[f+15],10,-30611744),h=y(h,p,c,l,n[f+6],15,-1560198380),l=y(l,h,p,c,n[f+13],21,1309151649),c=y(c,l,h,p,n[f+4],6,-145523070),p=y(p,c,l,h,n[f+11],10,-1120210379),h=y(h,p,c,l,n[f+2],15,718787259),l=y(l,h,p,c,n[f+9],21,-343485551),c=c+v>>>0,l=l+b>>>0,h=h+x>>>0,p=p+A>>>0}return s.endian([c,l,h,p])})._ff=function(t,e,n,s,i,r,o){var a=t+(e&n|~e&s)+(i>>>0)+o;return(a<<r|a>>>32-r)+e},a._gg=function(t,e,n,s,i,r,o){var a=t+(e&s|n&~s)+(i>>>0)+o;return(a<<r|a>>>32-r)+e},a._hh=function(t,e,n,s,i,r,o){var a=t+(e^n^s)+(i>>>0)+o;return(a<<r|a>>>32-r)+e},a._ii=function(t,e,n,s,i,r,o){var a=t+(n^(e|~s))+(i>>>0)+o;return(a<<r|a>>>32-r)+e},a._blocksize=16,a._digestsize=16,t.exports=function(t,e){if(null==t)throw new Error("Illegal argument "+t);var n=s.wordsToBytes(a(t,e));return e&&e.asBytes?n:e&&e.asString?o.bytesToString(n):s.bytesToHex(n)}},function(t,e){var n,s;n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s={rotl:function(t,e){return t<<e|t>>>32-e},rotr:function(t,e){return t<<32-e|t>>>e},endian:function(t){if(t.constructor==Number)return 16711935&s.rotl(t,8)|4278255360&s.rotl(t,24);for(var e=0;e<t.length;e++)t[e]=s.endian(t[e]);return t},randomBytes:function(t){for(var e=[];t>0;t--)e.push(Math.floor(256*Math.random()));return e},bytesToWords:function(t){for(var e=[],n=0,s=0;n<t.length;n++,s+=8)e[s>>>5]|=t[n]<<24-s%32;return e},wordsToBytes:function(t){for(var e=[],n=0;n<32*t.length;n+=8)e.push(t[n>>>5]>>>24-n%32&255);return e},bytesToHex:function(t){for(var e=[],n=0;n<t.length;n++)e.push((t[n]>>>4).toString(16)),e.push((15&t[n]).toString(16));return e.join("")},hexToBytes:function(t){for(var e=[],n=0;n<t.length;n+=2)e.push(parseInt(t.substr(n,2),16));return e},bytesToBase64:function(t){for(var e=[],s=0;s<t.length;s+=3)for(var i=t[s]<<16|t[s+1]<<8|t[s+2],r=0;r<4;r++)8*s+6*r<=8*t.length?e.push(n.charAt(i>>>6*(3-r)&63)):e.push("=");return e.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/gi,"");for(var e=[],s=0,i=0;s<t.length;i=++s%4)0!=i&&e.push((n.indexOf(t.charAt(s-1))&Math.pow(2,-2*i+8)-1)<<2*i|n.indexOf(t.charAt(s))>>>6-2*i);return e}},t.exports=s},function(t,e){function n(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
t.exports=function(t){return null!=t&&(n(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&n(t.slice(0,0))}(t)||!!t._isBuffer)}},function(t,e,n){!function(n){"use strict";var s=function(t,e){var n=new Error(t+" at character "+e);throw n.index=e,n.description=t,n},i={"-":!0,"!":!0,"~":!0,"+":!0},r={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},o=function(t){var e,n=0;for(var s in t)(e=s.length)>n&&t.hasOwnProperty(s)&&(n=e);return n},a=o(i),u=o(r),c={true:!0,false:!1,null:null},l=function(t){return r[t]||0},h=function(t,e,n){return{type:"||"===t||"&&"===t?"LogicalExpression":"BinaryExpression",operator:t,left:e,right:n}},p=function(t){return t>=48&&t<=57},f=function(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=128&&!r[String.fromCharCode(t)]},g=function(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||t>=128&&!r[String.fromCharCode(t)]},d=function(t){for(var e,n,o=0,d=t.charAt,m=t.charCodeAt,y=function(e){return d.call(t,e)},v=function(e){return m.call(t,e)},b=t.length,x=function(){for(var t=v(o);32===t||9===t||10===t||13===t;)t=v(++o)},A=function(){var t,e,n=_();return x(),63!==v(o)?n:(o++,(t=A())||s("Expected expression",o),x(),58===v(o)?(o++,(e=A())||s("Expected expression",o),{type:"ConditionalExpression",test:n,consequent:t,alternate:e}):void s("Expected :",o))},w=function(){x();for(var e=t.substr(o,u),n=e.length;n>0;){if(r.hasOwnProperty(e)&&(!f(v(o))||o+e.length<t.length&&!g(v(o+e.length))))return o+=n,e;e=e.substr(0,--n)}return!1},_=function(){var t,e,n,i,r,a,u,c;if(a=D(),!(e=w()))return a;for(r={value:e,prec:l(e)},(u=D())||s("Expected expression after "+e,o),i=[a,r,u];(e=w())&&0!==(n=l(e));){for(r={value:e,prec:n};i.length>2&&n<=i[i.length-2].prec;)u=i.pop(),e=i.pop().value,a=i.pop(),t=h(e,a,u),i.push(t);(t=D())||s("Expected expression after "+e,o),i.push(r,t)}for(t=i[c=i.length-1];c>1;)t=h(i[c-1].value,i[c-2],t),c-=2;return t},D=function(){var e,n,s;if(x(),e=v(o),p(e)||46===e)return F();if(39===e||34===e)return C();if(91===e)return O();for(s=(n=t.substr(o,a)).length;s>0;){if(i.hasOwnProperty(n)&&(!f(v(o))||o+n.length<t.length&&!g(v(o+n.length))))return o+=s,{type:"UnaryExpression",operator:n,argument:D(),prefix:!0};n=n.substr(0,--s)}return!(!f(e)&&40!==e)&&E()},F=function(){for(var t,e,n="";p(v(o));)n+=y(o++);if(46===v(o))for(n+=y(o++);p(v(o));)n+=y(o++);if("e"===(t=y(o))||"E"===t){for(n+=y(o++),"+"!==(t=y(o))&&"-"!==t||(n+=y(o++));p(v(o));)n+=y(o++);p(v(o-1))||s("Expected exponent ("+n+y(o)+")",o)}return e=v(o),f(e)?s("Variable names cannot start with a number ("+n+y(o)+")",o):46===e&&s("Unexpected period",o),{type:"Literal",value:parseFloat(n),raw:n}},C=function(){for(var t,e="",n=y(o++),i=!1;o<b;){if((t=y(o++))===n){i=!0;break}if("\\"===t)switch(t=y(o++)){case"n":e+="\n";break;case"r":e+="\r";break;case"t":e+="\t";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:e+=t}else e+=t}return i||s('Unclosed quote after "'+e+'"',o),{type:"Literal",value:e,raw:n+e+n}},k=function(){var e,n=v(o),i=o;for(f(n)?o++:s("Unexpected "+y(o),o);o<b&&(n=v(o),g(n));)o++;return e=t.slice(i,o),c.hasOwnProperty(e)?{type:"Literal",value:c[e],raw:e}:"this"===e?{type:"ThisExpression"}:{type:"Identifier",name:e}},S=function(t){for(var e,n,i=[],r=!1;o<b;){if(x(),(e=v(o))===t){r=!0,o++;break}44===e?o++:((n=A())&&"Compound"!==n.type||s("Expected comma",o),i.push(n))}return r||s("Expected "+String.fromCharCode(t),o),i},E=function(){var t,e;for(e=40===(t=v(o))?j():k(),x(),t=v(o);46===t||91===t||40===t;)o++,46===t?(x(),e={type:"MemberExpression",computed:!1,object:e,property:k()}):91===t?(e={type:"MemberExpression",computed:!0,object:e,property:A()},x(),93!==(t=v(o))&&s("Unclosed [",o),o++):40===t&&(e={type:"CallExpression",arguments:S(41),callee:e}),x(),t=v(o);return e},j=function(){o++;var t=A();if(x(),41===v(o))return o++,t;s("Unclosed (",o)},O=function(){return o++,{type:"ArrayExpression",elements:S(93)}},B=[];o<b;)59===(e=v(o))||44===e?o++:(n=A())?B.push(n):o<b&&s('Unexpected "'+y(o)+'"',o);return 1===B.length?B[0]:{type:"Compound",body:B}};d.version="0.3.4",d.toString=function(){return"JavaScript Expression Parser (JSEP) v"+d.version},d.addUnaryOp=function(t){return a=Math.max(t.length,a),i[t]=!0,this},d.addBinaryOp=function(t,e){return u=Math.max(t.length,u),r[t]=e,this},d.addLiteral=function(t,e){return c[t]=e,this},d.removeUnaryOp=function(t){return delete i[t],t.length===a&&(a=o(i)),this},d.removeAllUnaryOps=function(){return i={},a=0,this},d.removeBinaryOp=function(t){return delete r[t],t.length===u&&(u=o(r)),this},d.removeAllBinaryOps=function(){return r={},u=0,this},d.removeLiteral=function(t){return delete c[t],this},d.removeAllLiterals=function(){return c={},this},t.exports?e=t.exports=d:e.parse=d}()},function(t,e){t.exports=new class{async map(t,e){for(let n=0;n<t.length;n++)t[n]=await e(t[n]);return t}}},function(t,e){t.exports=function(t,e,n=function(){}){if(!e.global)return function(t,e,n){const s=t.match(e);return s?n(...s,s.index,s.input).then(n=>t.replace(e,n)):Promise.resolve(t)}(t,e,n);const s=t.match(e);if(!s)return Promise.resolve(t);let i=0,r=0;const o=[],a=new RegExp(e.source,e.flags.replace("g","")),u=[];for(;s.length>0;){const e=s.shift(),c=t.indexOf(e,r);o[i]=t.slice(r,c),i++;let l=i;u.push(n(...e.match(a),c,t).then(t=>{o[l]=t})),r=c+e.length,i++}return o[i]=t.slice(r),Promise.all(u).then(()=>o.join(""))}},function(t,e,n){const s=n(207),i=n(40),r=n(7);t.exports=class{constructor(t){this.decorators={},this.interpreter=t,this.error=new i(this.interpreter.converse.script,this.interpreter.namespace);for(let t in s)this.decorators[t]=[]}add(t){if(!t.decorators)return;const{decorators:e,name:n}=t;let i=[];for(let r of e)this.decorators[r.name]||this.error.throw(t,"decorator.error",new Error(`Decorator "${r.name}" not exists`)),i.push(new s[r.name](r,n));for(let t of i){for(let e of i)t.name!=e.name&&(t.otherDecorators[e.name]||(t.otherDecorators[e.name]=[]),t.otherDecorators[e.name].push(e));this.decorators[t.name].push(t)}}get(t,e){let n=this.decorators[t],s=[];if(0===n.length)return[];r.isArray(e)||(e=[e]);for(let t of n)(r.isUndefined(e[0])||t.findParam(e))&&s.push(t);return s}async _exec(t,e,n,i){let r=!1;const o=async t=>{let n=!1;if(t.otherDecorators.Condition)for(let n of t.otherDecorators.Condition){if(!await n.run(e))return!1}const o=this.interpreter.fn[t.fnName],{_canActivated:a,_skills:u}=e.converse,c=t=>{const i=a[t],r=u.get(i),l=r._interpreter.execution.decorators,h=l.get("Event",s.Event.CAN_ACTIVATE);return 0!=h.length&&(l.exec(h,r._interpreter.execution,null,n=>{if(t++,!0!==n.value)return e.end();a[t]?c(t):e.execFn(o,0,()=>e.end())}),n=!0,!0)};return a.length>0&&(c(0)?(e.user.addAddress(o.id,e.namespace),e.user.lockAddressStack(e.namespace,o.name,{activated:!0})):e.debug("warning",{message:"You call skills in the canActivated property but are never triggered"})),r=!0,n||e.execFn(o,0,t=>{if(!i)return e.end();i(t)}),!0};for(let s of t){let t=null;if(n&&s[n]&&(t=s[n](e)),t instanceof Promise){if(await t&&!r){if(await o(s))break}}else{if(await o(s))break}}return r}async execMethod(t,e,n){const s=this.decorators[t];return await this._exec(s,n,e)}async exec(t,e,n,s){return r.isArray(t)||(t=this.get(t,n)),!!t&&await this._exec(t,e,null,s)}}},function(t,e,n){const s=n(78),i=n(208),r=n(209),o=n(210);t.exports={Event:s,Intent:i,Action:r,Condition:o}},function(t,e,n){const s=n(23),i=n(7);t.exports=class extends s{run(t){return new Promise((e,n)=>{const{intents:s}=t;if(this.instructions&&this.instructions.length>0)return void t.execBlock({instructions:this.instructions},0,"test",()=>{e(!0)});if(!s)return e(!1);const r=this.params[0];let o=s[r];if(r.regexp){if(new RegExp(r.regexp,r.flags.join("")).test(t.input))return e(!0)}if(i.isFunction(o)&&(o=o()),o)return t.setMagicVar("intent",o),e(!0);e(!1)})}}},function(t,e,n){const s=n(23);t.exports=class extends s{}},function(t,e,n){const s=n(23);t.exports=class extends s{run(t){return new Promise(async(e,n)=>{const{converse:s,user:i,options:r}=t;for(let t of this.params){let o=s._conditions[t];if(!o)return void n(new Error(`${t} condition function not exists`));let a=o(r.data,i);if(a instanceof Promise&&(a=await a),!a)return void e(!1)}e(!0)})}}},function(t,e,n){const s=n(212),i=n(213),r=n(214),o=n(215),a=n(216),u=n(217);t.exports={Users:s,Array:i,Lang:r,Utils:o,Eval:a,debugger:u}},function(t,e){const n={$params:["users"],nbUsers:t=>t.size,sum(t,e){let n=0;for(let[,s]of e)n+=+s.getVariable(this.namespace,t);return n},avg(t,e){return this.sum(t,e)/this.nbUsers(e)}};t.exports=n},function(t,e){const n={length:t=>t.length,push:(t,e)=>t.push(e),pushOnlyUniq(t,e){return-1===t.indexOf(e)?this.push(t,e):t},indexOf:(t,e)=>t.indexOf(e)};t.exports=n},function(t,e){const n={fr_FR:["Franais","French"],en_EN:["English","English"]},s={$params:["user"],set(t,e){t&&e.setLang(t)},name(t){const e=t.getLang();return n[e][0]}};t.exports=s},function(t,e){const n={uniqid:()=>(new Date).valueOf().toString(36)+Math.random().toString(36).substr(2)};t.exports=n},function(t,e,n){const s=n(75),i={$params:["users","execution"],json(t,e,n){try{const{converse:i,user:r,_input:o,options:a,propagate:u}=n,c=JSON.parse(t);return new s(c,e,n.converse).exec(r,o,a,u)}catch(t){console.log(t)}}};t.exports=i},function(t,e){const n={$params:["user","execution","level"],$call(t,e,n){const{namespace:s}=e,i=(t,e)=>{console.log(`--- ${e} ---`);for(let e in t)console.log(`\n * ${e} = `,JSON.stringify(t[e],null,2));console.log("\n")};console.log("* Skill : "+s),console.log("* User Id : "+t.id),console.log("* Current Lang : "+t.lang),i(t.variables[s],"global variables"),i(t.magicVar,"magic variables"),i(t.varFn[s][n],`${n}(...) function`)}};t.exports=n},function(t,e){t.exports=class{constructor(t,e){this.script=t,this.history=e}organize(){this.script.split("\n");console.log(this.history[0]._file)}display(){const t=this.organize();console.log("--- %s ---",DEBUG);for(let e of t)console.log(e);console.log("------")}}},function(t,e,n){const s=n(7);t.exports=class{constructor(t,e,n={}){this.name=t,this.converse=e,this.options=n,this.uuid=n.uuid,this.priority=this.options.priority?this.options.priority:void 0,this.intents={}}add(t){s.isFunction(t)?this.intents=t:this.intents=s.merge(this.intents,t)}exec(t,e,n=this.converse){return new Promise((i,r)=>{if(n._mockNlp&&n._mockNlp[this.name]){const n=this.converse._mockNlp[this.name](t,e);i({structured:n})}else s.isFunction(this.intents)?this.intents(t,e,n).then(t=>{i({intents:t})}):i()}).then(({structured:s,intents:i}={})=>{i=i||this.intents;let r={};for(let o in i){let a=i[o],u="string"==typeof e?n._users.get(e):e,c=a(t,s,u);c&&(r[o]=c)}return r})}}},function(t,e,n){const s=n(221),i=n(22);t.exports=new class{readFile(t,e){return i.is()?new Promise((e,n)=>{const s=new XMLHttpRequest;s.onreadystatechange=function(){s.readyState==XMLHttpRequest.DONE&&(200==s.status?e(s.responseText):n(s))},s.open("GET",t,!0),s.send()}):new Promise((n,i)=>{s.readFile(t,e,(t,e)=>{if(t)return i(t);n(e)})})}}},function(t,e){},function(t){t.exports={version:"0.6.0"}},,function(t,e,n){"use strict";n.r(e);var s=n(41);n.d(e,"Converse",(function(){return s.Converse})),n.d(e,"NewBot",(function(){return s.NewBot}));var i=n(239);n.n(i)()()},function(t,e,n){const{defaultContainer:s}=n(6);class i{constructor(t=s){this.container=t.container||t,this.name="arrToObj"}static arrToObj(t){const e={};for(let n=0;n<t.length;n+=1)e[t[n]]=1;return e}run(t){return Array.isArray(t)?i.arrToObj(t):(t.tokens=i.arrToObj(t.tokens),t)}}t.exports=i},function(t,e,n){(function(e){const s=n(225),{Container:i}=n(6),r=n(82),o=n(227),{loadEnvFromJson:a}=n(79),u=n(228),c=n(229),l=n(81),h=n(230),p=n(80),f=n(231),g=n(243);t.exports=function(t={},n,d,m,y,v){const b=d||new i(m);b.parent=v,m||(b.register("fs",g),b.use(s),b.use(r),b.use(o),b.use(u),b.use(c),b.use(l),b.use(h),b.use(p),b.use(f));const x=t;let A;if(t.env&&a(m,t.env),A=x,A=function t(n,s){if("string"==typeof n)return n.startsWith("$")?e.env[`${s}${n.slice(1)}`]||e.env[n.slice(1)]:n;if(Array.isArray(n))return n.map(e=>t(e,s));if("object"==typeof n){const e=Object.keys(n),i={};for(let r=0;r<e.length;r+=1)i[e[r]]=t(n[e[r]],s);return i}return n}(A,m?`${m}_`:""),A.settings){const t=Object.keys(A.settings);for(let e=0;e<t.length;e+=1)b.registerConfiguration(t[e],A.settings[t[e]],!0)}if(A.terraform)for(let t=0;t<A.terraform.length;t+=1){const e=A.terraform[t],n=b.get(e.className);b.register(e.name,n,!0)}if(A.childs&&(b.childs=A.childs),y)for(let t=0;t<y.length;t+=1){const e=y[t];b.registerPipeline(e.tag,e.pipeline,e.overwrite)}return A.pipelines&&function(t,e){t.loadPipelinesFromString(e)}(b,A.pipelines),b}}).call(this,n(43))},function(t,e,n){const{defaultContainer:s}=n(6);class i{constructor(t=s){this.container=t.container||t,this.name="objToArr"}static objToArr(t){return Object.keys(t)}run(t){return t.tokens?(t.tokens=i.objToArr(t.tokens),t):i.objToArr(t)}}t.exports=i},function(t,e,n){const{defaultContainer:s}=n(6);t.exports=class{constructor(t=s){this.container=t.container||t,this.name="stem"}stem(t){return t}getStemmer(t){const e=t,n=(e.locale||e.settings)&&e.settings.locale||"en";return this.container.get(`stemmer-${n}`)||this}async addForTraining(t){const e=this.getStemmer(t);return e.addUtterance&&await e.addUtterance(t.utterance,t.intent),t}async train(t){const e=this.getStemmer(t);return e.innerTrain&&await e.innerTrain(),t}async run(t){const e=t,n=this.getStemmer(e);return e.tokens=await n.stem(e.tokens,e),e}}},function(t,e,n){const{defaultContainer:s}=n(6);t.exports=class{constructor(t=s){this.container=t.container||t,this.name="removeStopwords",this.dictionary={}}build(t){for(let e=0;e<t.length;e+=1)this.dictionary[t[e]]=!0}isNotStopword(t){return!this.dictionary[t]}isStopword(t){return!!this.dictionary[t]}removeStopwords(t){return t.filter(t=>this.isNotStopword(t))}run(t){if(t.settings&&!1===t.settings.keepStopwords){const e=t,n=e.locale||"en",s=this.container.get(`stopwords-${n}`)||this;return e.tokens=s.removeStopwords(e.tokens,e).filter(t=>t),e}return t}}},function(t,e,n){const{defaultContainer:s}=n(6);t.exports=class{constructor(t=s){this.container=t.container||t,this.name="timer"}start(t){return t&&(t.hrstart=new Date),t}stop(t){const e=t;if(e&&e.hrstart){const t=new Date;e.elapsed=t.getTime()-e.hrstart.getTime(),delete e.hrstart}return e}run(t){this.start(t)}}},function(t,e,n){const{defaultContainer:s}=n(6),i=n(83);t.exports=class extends i{constructor(t={},e){super({settings:{},container:t.container||e||s},e),this.applySettings(this.settings,t),this.applySettings(this.settings,{etag:1,memory:{}}),this.settings.tag||(this.settings.tag="storage"),this.applySettings(this.settings,this.container.getConfiguration(this.settings.tag))}read(t){return new Promise(e=>{const n={};Array.isArray(t)||(t=[t]),t.forEach(t=>{const e=this.settings.memory[t];e&&(n[t]=JSON.parse(e))}),e(n)})}saveItem(t,e){const n={...e};return n.eTag=this.settings.etag.toString(),this.settings.etag+=1,this.settings.memory[t]=JSON.stringify(n),n}write(t){return new Promise((e,n)=>{Object.keys(t).forEach(s=>{const i=t[s],r=this.settings.memory[s];if(!r||"*"===i.eTag)return e(this.saveItem(s,i));const o=JSON.parse(r);return i.eTag!==o.eTag?n(new Error(`Error writing "${s}" due to eTag conflict.`)):e(this.saveItem(s,i))})})}delete(t){return new Promise(e=>{t.forEach(t=>delete this.settings.memory[t]),e()})}}},function(t,e,n){const{Clonable:s}=n(5),{SpellCheck:i}=n(233),r=n(251);t.exports=class extends s{constructor(t={},e){super({settings:{},container:t.container||e},e),this.applySettings(this.settings,t),this.applySettings(this.settings,{locale:"en"}),this.settings.tag||(this.settings.tag=`nlu-${this.settings.locale}`),this.registerDefault(),this.applySettings(this.settings,this.container.getConfiguration(this.settings.tag)),this.applySettings(this,{pipelinePrepare:this.getPipeline(`${this.settings.tag}-prepare`),pipelineTrain:this.getPipeline(`${this.settings.tag}-train`),pipelineProcess:this.getPipeline(`${this.settings.tag}-process`)}),this.spellCheck=new i}registerDefault(){this.container.registerConfiguration("nlu-??",{keepStopwords:!0,nonefeatureValue:1,nonedeltaMultiplier:1.2,spellCheck:!1,spellCheckDistance:1,filterZeros:!0,log:!0},!1),this.container.registerPipeline("nlu-??-prepare",["normalize","tokenize","removeStopwords","stem","arrToObj","output.tokens"],!1),this.container.registerPipeline("nlu-??-train",[".prepareCorpus",".addNoneFeature",".innerTrain"],!1),this.container.registerPipeline("nlu-??-process",[".prepare",".doSpellCheck",".textToFeatures",".innerProcess",".convertToArray",".filterNonActivated",".normalizeClassifications","output.classifications"],!1)}async prepare(t,e){const n=e||this.settings;if("string"==typeof t){const e={locale:this.settings.locale,text:t,settings:n};return this.runPipeline(e,this.pipelinePrepare)}if("object"==typeof t){if(Array.isArray(t)){const e=[];for(let s=0;s<t.length;s+=1)e.push(await this.prepare(t[s],n));return e}const e=n.fieldNameSrc?t[n.fieldNameSrc]:t.text||t.utterance||t.texts||t.utterances;if(e){const s=await this.prepare(e,n);return{[n.fieldNameTgt||"tokens"]:s,...t}}}throw new Error(`Error at nlu.prepare: expected a text but received ${t}`)}async doSpellCheck(t,e){const n=this.applySettings(e||{},this.settings);let s=void 0===t.settings.spellCheck?void 0:t.settings.spellCheck,i=void 0===t.settings.spellCheckDistance?void 0:t.settings.spellCheckDistance;if(void 0===s&&(s=void 0===n.spellCheck?void 0:n.spellCheck),void 0===i&&(i=void 0===n.spellCheckDistance?1:n.spellCheckDistance),s){const e=this.spellCheck.check(t.tokens,i);t.tokens=e}return t}async prepareCorpus(t){this.features={},this.intents={},this.intentFeatures={};const e=t,{corpus:n}=e,s=[];for(let t=0;t<n.length;t+=1){const{intent:i}=n[t],r={input:await this.prepare(n[t].utterance,e.settings),output:{[i]:1}},o=Object.keys(r.input);this.intentFeatures[i]||(this.intentFeatures[i]={});for(let t=0;t<o.length;t+=1)this.features[o[t]]=1,this.intentFeatures[i][o[t]]=1;this.intents[i]=1,s.push(r)}const i=Object.keys(this.intentFeatures);for(let t=0;t<i.length;t+=1)this.intentFeatures[i[t]]=Object.keys(this.intentFeatures[i[t]]);return this.spellCheck.setFeatures(this.features),this.numFeatures=Object.keys(this.features).length,this.numIntents=Object.keys(this.intents).length,e.corpus=s,e}addNoneFeature(t){const{corpus:e}=t,n=t.locale||this.settings.locale;return(t.settings&&t.settings.useNoneFeature||(!t.settings||void 0===t.settings.useNoneFeature)&&r[n])&&e.push({input:{nonefeature:1},output:{None:1}}),t}convertToArray(t){const e=t,{classifications:n}=e;if(n){const t=Object.keys(n),s=[];for(let i=0;i<t.length;i+=1){const r=t[i],o=n[r];(o>0||!e.settings.filterZeros)&&s.push({intent:r,score:o})}e.classifications=s.sort((t,e)=>e.score-t.score)}return e}someSimilar(t,e){for(let n=0;n<e.length;n+=1)if(t[e[n]])return!0;return!1}getWhitelist(t){const e={},n=Object.keys(this.intentFeatures);for(let s=0;s<n.length;s+=1)this.someSimilar(t,this.intentFeatures[n[s]])&&(e[n[s]]=1);return e}filterNonActivated(t){if(!this.intentFeatures||!t.classifications)return t;const e=this.getWhitelist(t.tokens);e.None=1;const{classifications:n}=t;for(let t=0;t<n.length;t+=1){const s=n[t];e[s.intent]||(s.score=0)}return t}normalizeClassifications(t){const e=t,{classifications:n}=e;if(n){let t=0;for(let e=0;e<n.length;e+=1)n[e].score**=2,t+=n[e].score;if(t>0)for(let e=0;e<n.length;e+=1)n[e].score/=t}else e.classifications=e.nluAnswer;return e}textToFeatures(t){const e=t.locale||this.settings.locale,n=t,{tokens:s}=n,i=Object.keys(s);let o=0;const a={};for(let t=0;t<i.length;t+=1){const e=i[t];"nonefeature"===e?s[e]=this.nonefeatureValue:this.features&&this.features[e]?a[e]=s[e]:o+=1}let u=void 0===n.settings.nonedeltaValue?this.numIntents/this.numFeatures:this.settings.nonedeltaValue,c=0;for(let t=0;t<o;t+=1)c+=u,u*=this.settings.nonedeltaMultiplier;return(n.settings||n.settings.useNoneFeature||(n.settings||void 0===n.settings.useNoneFeature)&&r[e])&&c&&(a.nonefeature=c),n.tokens=a,n}async innerTrain(){throw new Error("This method should be implemented by child classes")}async train(t,e){const n={corpus:t,settings:this.applySettings(e,this.settings)};return this.runPipeline(n,this.pipelineTrain)}async process(t,e){const n={text:t,settings:this.applySettings(e||{},this.settings)},s=await this.runPipeline(n,this.pipelineProcess);return Array.isArray(s)?{classifications:s,entities:void 0}:(s.intents&&(s.classifications=s.intents,delete s.intents),s)}toJSON(){const t={settings:{...this.settings},features:this.features,intents:this.intents,intentFeatures:this.intentFeatures};return delete t.settings.container,t}fromJSON(t){this.applySettings(this.settings,t.settings),this.features=t.features||{},this.intents=t.intents||{},this.intentFeatures=t.intentFeatures||{},this.spellCheck.setFeatures(this.features),this.numFeatures=Object.keys(this.features).length,this.numIntents=Object.keys(this.intents).length}}},function(t,e,n){const s=n(234),i=n(235),r=n(250);t.exports={leven:s,similarity:i,SpellCheck:r}},function(t,e){const n=[],s=[];t.exports=function(t,e){t.length>e.length&&([t,e]=[e,t]);let i=t.length-1,r=e.length-1;for(;i>0&&t.charCodeAt(i)===e.charCodeAt(r);)i-=1,r-=1;i+=1,r+=1;let o,a,u,c,l=0;for(;l<i&&t.charCodeAt(l)===e.charCodeAt(l);)l+=1;if(i-=l,r-=l,0===i)return r;for(let e=0;e<i;e+=1)s[e]=t.charCodeAt(l+e),n[e]=e+1;let h=0;for(;h<r;){o=e.charCodeAt(l+h),u=h,h+=1,a=h;for(let t=0;t<i;t+=1)c=u+(o!==s[t])|0,u=n[t],n[t]=u>a?c>a?a+1:c:c>u?u+1:c,a=n[t]}return a}},function(t,e,n){const s=n(234);t.exports=function(t,e,n=!1){return n&&(t=t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(),e=e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()),t===e?0:s(t,e)}},function(t,e,n){const{Clonable:s}=n(5),i="master_domain";t.exports=class extends s{constructor(t={},e){super({settings:{},container:t.container||e},e),this.applySettings(this.settings,t),this.applySettings(this.settings,{locale:"en"}),this.settings.tag||(this.settings.tag=`domain-manager-${this.settings.locale}`),this.registerDefault(),this.applySettings(this.settings,this.container.getConfiguration(this.settings.tag)),this.domains={},this.addDomain(i),this.stemDict={},this.intentDict={},this.sentences=[],this.applySettings(this,{pipelineTrain:this.getPipeline(`${this.settings.tag}-train`),pipelineProcess:this.getPipeline(`${this.settings.tag}-process`)})}registerDefault(){this.container.registerConfiguration("domain-manager-??",{nluByDomain:{default:{className:"NeuralNlu",settings:{}}},trainByDomain:!1,useStemDict:!0},!1),this.container.registerPipeline("domain-manager-??-train",[".trainStemmer",".generateCorpus",".fillStemDict",".innerTrain","output.status"],!1),this.container.registerPipeline("domain-manager-??-process",[".innerClassify","output.classification"],!1)}getDomainInstance(t){this.settings.nluByDomain||(this.settings.nluByDomain={});const e=this.settings.nluByDomain[t]||this.settings.nluByDomain.default||{className:"NeuralNlu",settings:{}};return this.container.get(e.className||"NeuralNlu",this.applySettings({locale:this.settings.locale},e.settings||{}))}addDomain(t){return this.domains[t]||(this.domains[t]=this.getDomainInstance(t)),this.domains[t]}removeDomain(t){delete this.domains[t]}async generateStemKey(t){let e;if("string"!=typeof t)e=t;else{const n=await this.prepare({utterance:t});e=await n.stems}return Array.isArray(e)||(e=Object.keys(e)),e.slice().sort().join()}add(t,e,n){n?this.sentences.push({domain:t,utterance:e,intent:n}):this.sentences.push({domain:i,utterance:t,intent:e})}remove(t,e,n){const s=n?t:i,r=n?e:t,o=n||e;for(let t=0;t<this.sentences.length;t+=1){const e=this.sentences[t];if(e.domain===s&&e.utterance===r&&e.intent===o)return this.sentences.splice(t,1),!0}return!1}async trainStemmer(t){const e=t;for(let t=0;t<this.sentences.length;t+=1){const n={...this.sentences[t],...e};await this.runPipeline(n,["stem.addForTraining"])}return await this.runPipeline(e,["stem.train"]),e}innerGenerateCorpus(t){this.intentDict={};const e={};e[i]=[];for(let n=0;n<this.sentences.length;n+=1){const s=this.sentences[n];this.intentDict[s.intent]=s.domain;const r=t||s.domain;e[r]||(e[r]=[]),e[r].push({utterance:s.utterance,intent:s.intent}),t||e[i].push({utterance:s.utterance,intent:s.domain})}return e}async generateCorpus(t){const e=t;return e.corpus=this.innerGenerateCorpus(this.settings.trainByDomain?void 0:i),e}async prepare(t){const e=t,n="string"==typeof e,s=n?e:e.utterance,r=this.addDomain(i).prepare(s);return n?r:(e.stems=r,e)}async fillStemDict(t){this.stemDict={};for(let t=0;t<this.sentences.length;t+=1){const e=await this.generateStemKey(this.sentences[t].utterance);this.stemDict[e]={intent:this.sentences[t].intent,domain:this.sentences[t].domain}}return t}async innerTrain(t){const e=t,{corpus:n}=e,s=Object.keys(n),i={};for(let e=0;e<s.length;e+=1){const r=this.addDomain(s[e]),o={useNoneFeature:this.settings.useNoneFeature};t.settings&&void 0!==t.settings.log&&(o.log=t.settings.log);const a=await r.train(n[s[e]],o);i[s[e]]=a.status}return e.status=i,e}async train(t){const e={domainManager:this,settings:t||this.settings};return this.runPipeline(e,this.pipelineTrain)}async classifyByStemDict(t,e){const n=await this.generateStemKey(t),s=this.stemDict[n];if(s&&(!e||s.domain===e)){const t=[];t.push({intent:s.intent,score:1});const e=Object.keys(this.intentDict);for(let n=0;n<e.length;n+=1)t.push({intent:e[n],score:0});return{domain:s.domain,classifications:t}}}async innerClassify(t,e){const n=t;if(this.applySettings({...n.settings},this.settings).useStemDict){const t=await this.classifyByStemDict(n.utterance,e);if(t)return n.classification=t,n}if(e){const t=this.domains[e];if(!t)return n.classification={domain:"default",classifications:[{intent:"None",score:1}]},n;const s=await t.process(n.utterance,n.settings||this.settings);let r;Array.isArray(s)?r=s:(r=s.classifications,n.nluAnswer=s);const o=e===i?this.intentDict[r[0].intent]:e;return n.classification={domain:o,classifications:r},n}let s=i;if(void 0===n.settings.trainByDomain&&this.settings.trainByDomain||n.settings.trainByDomain){const t=this.domains[i];let e=await t.process(n.utterance);if(e.classifications&&(e=e.classifications),1===Object.keys(this.domains).length)return n.classification={domain:"default",classifications:e},n;if(s=e[0].intent,"None"===s)return n.classification={domain:"default",classifications:[{intent:"None",score:1}]},n}return this.innerClassify(n,s)}async process(t,e){const n="string"==typeof t?{utterance:t,settings:e||this.settings}:t;return this.runPipeline(n,this.pipelineProcess)}toJSON(){const t={settings:this.settings,stemDict:this.stemDict,intentDict:this.intentDict,sentences:this.sentences,domains:{}};delete t.settings.container;const e=Object.keys(this.domains);for(let n=0;n<e.length;n+=1)t.domains[e[n]]=this.domains[e[n]].toJSON();return t}fromJSON(t){this.applySettings(this.settings,t.settings),this.stemDict=t.stemDict,this.intentDict=t.intentDict,this.sentences=t.sentences;const e=Object.keys(t.domains);for(let n=0;n<e.length;n+=1){this.addDomain(e[n]).fromJSON(t.domains[e[n]])}}}},function(t,e,n){const s=n(258);t.exports={Language:s}},function(t,e){const n={Between:"between",After:"after",AfterLast:"afterLast",AfterFirst:"afterFirst",Before:"before",BeforeFirst:"beforeFirst",BeforeLast:"beforeLast"},s=Object.values(n);t.exports={TrimType:n,TrimTypesList:s}},function(t,e,n){const{containerBootstrap:s}=n(5),{Nlp:i}=n(247),r=n(274),o=n(11),a=n(22);t.exports=t=>(o.nlpManager=async function(e,n=[]){const o=await s();o.use(i);for(let t of n)o.use(t);const u=o.get("nlp");if("{"==e[0])u.import(e);else if(a.is()){const t=await fetch(e).then(t=>t.json());u.import(t)}else{const n=t.readFileSync(e,"utf-8");u.import(n)}return r(u)},o)},function(t,e){t.exports=class{constructor(t,e,n,s,i){this.s_size=t.length,this.s=t,this.substring_i=e,this.result=n,this.method=s,this.instance=i}}},function(t,e,n){const{defaultContainer:s}=n(6);t.exports=class{constructor(t=s){this.container=t.container||t,this.name="default"}getTokenFromWord(t){return t.startsWith("//")?{type:"comment",value:t}:["set","delete","get","inc","dec","eq","neq","gt","ge","lt","le","label","goto","jne","je"].includes(t)?{type:t,arguments:[]}:t.startsWith("$")?{type:"call",value:t.slice(1)}:{type:"reference",value:t}}compile(t){const e=[];for(let n=0;n<t.length;n+=1){const s=t[n].split(" "),i=[];let r,o="";for(let t=0;t<s.length;t+=1){const e=s[t];let n=!1;r?(o=`${o} ${e}`,n=!0,e.endsWith(r)&&(r=void 0,i.push(this.getTokenFromWord(o)))):e.startsWith('"')?(o=e,n=!0,r='"',e.endsWith('"')&&(r=void 0,i.push(this.getTokenFromWord(o)))):e.startsWith("'")&&(o=e,n=!0,r="'",e.endsWith("'")&&(r=void 0,i.push(this.getTokenFromWord(o)))),n||i.push(this.getTokenFromWord(e))}e.push(i)}return e}executeCall(t,e,n,s,i){const r=this.container.getPipeline(t.value);if(!r)throw new Error(`Pipeline $${t.value} not found.`);return this.container.runPipeline(r,n,s,i+1)}executeReference(t,e,n,s,i){const r=this.container.resolvePath(e.value,n,s,i),o=[];for(let e=1;e<t.length;e+=1)o.push(this.container.resolvePathWithType(t[e].value,n,s,i));if(!r)throw new Error(`Method not found for step ${JSON.stringify(t)}`);const a=r.run||r;return"function"==typeof a?"function"==typeof r?a(s,...o):a.bind(r)(s,...o):a}doGoto(t,e){const n=e,s=n.labels[t];n.cursor=s}async executeAction(t,e,n,s,i){let r=t[0];if(r&&r.value&&r.value.startsWith("->")){if(i>0)return n;r={...r},r.value=r.value.slice(2)}switch(r.type){case"set":this.container.setValue(t[1].value,t[2]?t[2].value:void 0,e,n,s);break;case"delete":this.container.deleteValue(t[1].value,e,n,s);break;case"get":return this.container.getValue(t[1]?t[1].value:void 0,e,n,s);case"inc":this.container.incValue(t[1]?t[1].value:void 0,t[2]?t[2].value:"1",e,n,s);break;case"dec":this.container.decValue(t[1]?t[1].value:void 0,t[2]?t[2].value:"1",e,n,s);break;case"eq":this.container.eqValue(t[1]?t[1].value:void 0,t[2]?t[2].value:void 0,e,n,s);break;case"neq":this.container.neqValue(t[1]?t[1].value:void 0,t[2]?t[2].value:void 0,e,n,s);break;case"gt":this.container.gtValue(t[1]?t[1].value:void 0,t[2]?t[2].value:void 0,e,n,s);break;case"ge":this.container.geValue(t[1]?t[1].value:void 0,t[2]?t[2].value:void 0,e,n,s);break;case"lt":this.container.ltValue(t[1]?t[1].value:void 0,t[2]?t[2].value:void 0,e,n,s);break;case"le":this.container.leValue(t[1]?t[1].value:void 0,t[2]?t[2].value:void 0,e,n,s);break;case"goto":this.doGoto(t[1].value,e);break;case"jne":e.floating||this.doGoto(t[1].value,e);break;case"je":e.floating&&this.doGoto(t[1].value,e);break;case"call":return this.executeCall(r,e,n,s,i);case"reference":return this.executeReference(t,r,e,n,s)}return n}findLabels(t,e){const n=e;for(let e=0;e<t.length;e+=1){const s=t[e];"label"===s[0].type&&(n[s[1].value]=e)}}async execute(t,e,n,s){let i=e;const r={cursor:0,labels:{}};for(this.findLabels(t,r.labels);r.cursor<t.length;)i=await this.executeAction(t[r.cursor],r,i,n,s),r.cursor+=1;return i}}},function(t,e,n){const{defaultContainer:s}=n(6),i=n(81);t.exports=class{constructor(t=s,e){this.container=t.container||t,this.cache={},this.setCurrent(""),this.dictionary=e||{before:{},after:{}}}setCurrent(t){this.current=t,this.cursor=0,this.limit=this.current.length,this.limit_backward=0,this.bra=this.cursor,this.ket=this.limit}getCurrent(){return this.current}bc(t,e){return 0==(t[e>>>3]&1<<(7&e))}in_grouping(t,e,n){if(this.cursor>=this.limit)return!1;let s=this.current.charCodeAt(this.cursor);return!(s>n||s<e)&&(s-=e,!this.bc(t,s)&&(this.cursor++,!0))}in_grouping_b(t,e,n){if(this.cursor<=this.limit_backward)return!1;let s=this.current.charCodeAt(this.cursor-1);return!(s>n||s<e)&&(s-=e,!this.bc(t,s)&&(this.cursor--,!0))}out_grouping(t,e,n){if(this.cursor>=this.limit)return!1;let s=this.current.charCodeAt(this.cursor);return s>n||s<e?(this.cursor++,!0):(s-=e,!!this.bc(t,s)&&(this.cursor++,!0))}out_grouping_b(t,e,n){if(this.cursor<=this.limit_backward)return!1;let s=this.current.charCodeAt(this.cursor-1);return s>n||s<e?(this.cursor--,!0):(s-=e,!!this.bc(t,s)&&(this.cursor--,!0))}eq_s(t,e){return"string"==typeof t&&(t=(e=t).length),!(this.limit-this.cursor<t||this.current.slice(this.cursor,this.cursor+t)!=e)&&(this.cursor+=t,!0)}eq_s_b(t,e){return"string"==typeof t&&(t=(e=t).length),!(this.cursor-this.limit_backward<t||this.current.slice(this.cursor-t,this.cursor)!=e)&&(this.cursor-=t,!0)}find_among(t,e){let n=0,s=e||t.length;const i=this.cursor,r=this.limit;let o=0,a=0,u=!1;for(;;){const e=n+(s-n>>>1);let h=0,p=o<a?o:a;var c,l=t[e];for(c=p;c<l.s_size;c++){if(i+p==r){h=-1;break}if(h=this.current.charCodeAt(i+p)-l.s.charCodeAt(c),0!=h)break;p++}if(h<0?(s=e,a=p):(n=e,o=p),s-n<=1){if(n>0)break;if(s==n)break;if(u)break;u=!0}}for(;;){if(o>=(l=t[n]).s_size){if(this.cursor=i+l.s_size,null==l.method)return l.result;const t=l.method(l.instance);if(this.cursor=i+l.s_size,t)return l.result}if(n=l.substring_i,n<0)return 0}return-1}find_among_b(t,e){let n=0,s=e||t.length;const i=this.cursor,r=this.limit_backward;let o=0,a=0,u=!1;for(;;){const e=n+(s-n>>1);let h=0,p=o<a?o:a;var c;for(c=(l=t[e]).s_size-1-p;c>=0;c--){if(i-p==r){h=-1;break}if(h=this.current.charCodeAt(i-1-p)-l.s.charCodeAt(c),0!=h)break;p++}if(h<0?(s=e,a=p):(n=e,o=p),s-n<=1){if(n>0)break;if(s==n)break;if(u)break;u=!0}}for(;;){var l;if(o>=(l=t[n]).s_size){if(this.cursor=i-l.s_size,null==l.method)return l.result;const t=l.method(this);if(this.cursor=i-l.s_size,t)return l.result}if(n=l.substring_i,n<0)return 0}return-1}replace_s(t,e,n){const s=n.length-(e-t);return this.current=this.current.slice(0,t)+n+this.current.slice(e),this.limit+=s,this.cursor>=e?this.cursor+=s:this.cursor>t&&(this.cursor=t),s}slice_check(){return!(this.bra<0||this.bra>this.ket||this.ket>this.limit||this.limit>this.current.length)}slice_from(t){return!!this.slice_check()&&(this.replace_s(this.bra,this.ket,t),!0)}slice_del(){return this.slice_from("")}insert(t,e,n){const s=this.replace_s(t,e,n);t<=this.bra&&(this.bra+=s),t<=this.ket&&(this.ket+=s)}slice_to(t){let e="";return this.slice_check()&&(e=this.current.slice(this.bra,this.ket)),e}stemWord(t){let e=this.cache[`.${t}`];return null==e&&(this.dictionary.before[t]?e=this.dictionary.before[t]:(this.setCurrent(t),this.innerStem(),e=this.getCurrent(),this.dictionary.after[e]&&(e=this.dictionary.after[e])),this.cache[`.${t}`]=e),e}stemWords(t){const e=[];for(let n=0;n<t.length;n++)e.push(this.stemWord(t[n]));return e}stem(t){return this.stemWords(t)}getTokenizer(){return this.tokenizer||(this.tokenizer=this.container.get(`tokenizer-${this.name.slice(-2)}`)||new i),this.tokenizer}tokenizeAndStem(t,e=!0){let n=this.getTokenizer().tokenize(t,!0);return!e&&this.stopwords&&(n=this.stopwords.removeStopwords(n)),this.stemWords(n)}}},function(t,e){t.exports={readFile:function(){return new Promise(t=>{t(void 0)})},writeFile:function(){return new Promise((t,e)=>{e(new Error("File cannot be written in web"))})},existsSync:function(){return!1},lstatSync:function(){},readFileSync:function(){}}},function(t,e){t.exports=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return`${t()+t()}-${t()}-${t()}-${t()}-${t()}${t()}${t()}`}},function(t,e,n){const s=n(226);const i=new class{constructor(){this.containers={}}getContainer(t){return this.containers[t||"default"]}async createContainer(t,e,n=!0,i,r,o){if("string"!=typeof t&&(e=t,t=""),e||"default"!==t&&""!==t||(e="conf.json"),!this.containers[t]){const a=s(e,n,void 0,i,o);a.name=t,this.containers[t]=a,a.dock=this,a.parent=r,await a.start(),a.childs&&await this.buildChilds(a)}return this.containers[t]}async buildChilds(t){if(t&&t.childs){const e=Object.keys(t.childs),n={};for(let s=0;s<e.length;s+=1){const i=t.childs[e[s]];i.isChild=!0,i.pathPipeline||(i.pathPipeline=`${e[s]}_pipeline.md`),n[e[s]]=await this.createContainer(e[s],i,!1,e[s],t,t.childPipelines?t.childPipelines[e[s]]:void 0)}t.childs=n}}async terraform(t,e=!0){return await this.createContainer("default",t,e,"")}start(t,e=!0){return this.terraform(t,e)}};t.exports=i},function(t,e,n){const{defaultContainer:s}=n(6),i=n(83);t.exports=class extends i{constructor(t={},e){super({settings:{},container:t.container||e||s},e),this.applySettings(this.settings,t),this.settings.tag||(this.settings.tag="context"),this.applySettings(this.settings,this.container.getConfiguration(this.settings.tag))}getStorage(){const t=this.container.get(this.settings.storageName||"storage");if(!t)throw new Error("Storage not found");return t}getContext(t){return this.getStorage().read(`${this.settings.tag}-${t}`)}setContext(t,e){const n={[t]:e};return this.getStorage().write(n)}async getContextValue(t,e){const n=await this.getContext(t);return n?n[e]:void 0}async setContextValue(t,e,n){let s=await this.getContext(t);return s||(s={}),s[e]=n,this.setContext(t,s)}}},function(t,e,n){const s=n(248);t.exports={Nlp:s}},function(t,e,n){const{Clonable:s,containerBootstrap:i}=n(5),{NluManager:r,NluNeural:o}=n(249),{Ner:a,ExtractorEnum:u,ExtractorRegex:c,ExtractorTrim:l,ExtractorBuiltin:h}=n(261),{ActionManager:p,NlgManager:f}=n(267),{SentimentAnalyzer:g}=n(270),{SlotManager:d}=n(272);t.exports=class extends s{constructor(t={},e){super({settings:{},container:t.container||e||i()},e),this.applySettings(this.settings,t),this.settings.tag||(this.settings.tag="nlp"),this.registerDefault(),this.applySettings(this.settings,this.container.getConfiguration(this.settings.tag)),this.nluManager=this.container.get("nlu-manager",this.settings.nlu),this.ner=this.container.get("ner",this.settings.ner),this.nlgManager=this.container.get("nlg-manager",this.settings.nlg),this.actionManager=this.container.get("action-manager",this.settings.action),this.sentiment=this.container.get("sentiment-analyzer",this.settings.sentiment),this.slotManager=this.container.get("SlotManager",this.settings.slot),this.initialize()}registerDefault(){this.container.registerConfiguration("nlp",{threshold:.5,autoLoad:!0,autoSave:!0,modelFileName:"model.nlp"},!1),this.use(r),this.use(a),this.use(u),this.use(c),this.use(l),this.use(h),this.use(f),this.use(p),this.use(o),this.use(g),this.container.register("SlotManager",d,!1)}initialize(){if(this.settings.nlu){const t=Object.keys(this.settings.nlu);for(let e=0;e<t.length;e+=1){const n=t[e],s=Object.keys(this.settings.nlu[n]);for(let t=0;t<s.length;t+=1){const e=s[t],i=this.settings.nlu[n][e],{className:r}=i;delete i.className,this.useNlu(r,n,e,i)}}}this.settings.languages&&this.addLanguage(this.settings.languages),this.settings.locales&&this.addLanguage(this.settings.locales)}async start(){this.settings.corpora&&await this.addCorpora(this.settings.corpora)}async loadOrTrain(){let t=!1;this.settings.autoLoad&&(t=await this.load(this.settings.modelFileName)),t||await this.train()}useNlu(t,e,n,s){if(e||(e="??"),Array.isArray(e))for(let i=0;i<e.length;i+=1)this.useNlu(t,e[i],n,s);else{const i="string"==typeof t?t:this.container.use(t);let r=this.container.getConfiguration(`domain-manager-${e}`);r||(r={},this.container.registerConfiguration(`domain-manager-${e}`,r)),r.nluByDomain||(r.nluByDomain={});const o=n&&"*"!==n?n:"default";r.nluByDomain[o]||(r.nluByDomain[o]={}),r.nluByDomain[o].className=i,r.nluByDomain[o].settings=s}}guessLanguage(t){return this.nluManager.guessLanguage(t)}addLanguage(t){return this.nluManager.addLanguage(t)}addDocument(t,e,n){const s=this.ner.getEntitiesFromUtterance(e);return this.slotManager.addBatch(n,s),this.nluManager.add(t,e,n)}removeDocument(t,e,n){return this.nluManager.remove(t,e,n)}getRulesByName(t,e){return this.ner.getRulesByName(t,e)}addNerRule(t,e,n,s){return this.ner.addRule(t,e,n,s)}removeNerRule(t,e,n){return this.ner.removeRule(t,e,n)}addNerRuleOptionTexts(t,e,n,s){return this.ner.addRuleOptionTexts(t,e,n,s)}removeNerRuleOptionTexts(t,e,n,s){return this.ner.removeRuleOptionTexts(t,e,n,s)}addNerRegexRule(t,e,n){return this.ner.addRegexRule(t,e,n)}addNerBetweenCondition(t,e,n,s,i){return this.ner.addBetweenCondition(t,e,n,s,i)}addNerPositionCondition(t,e,n,s,i){return this.ner.addPositionCondition(t,e,n,s,i)}addNerAfterCondition(t,e,n,s){return this.ner.addAfterCondition(t,e,n,s)}addNerAfterFirstCondition(t,e,n,s){return this.ner.addAfterFirstCondition(t,e,n,s)}addNerAfterLastCondition(t,e,n,s){return this.ner.addAfterLastCondition(t,e,n,s)}addNerBeforeCondition(t,e,n,s){return this.ner.addBeforeCondition(t,e,n,s)}addNerBeforeFirstCondition(t,e,n,s){return this.ner.addBeforeFirstCondition(t,e,n,s)}addNerBeforeLastCondition(t,e,n,s){return this.ner.addBeforeLastCondition(t,e,n,s)}assignDomain(t,e,n){return this.nluManager.assignDomain(t,e,n)}getIntentDomain(t,e){return this.nluManager.getIntentDomain(t,e)}getDomains(){return this.nluManager.getDomains()}addAction(t,e,n,s){return this.actionManager.addAction(t,e,n,s)}getActions(t){return this.actionManager.findActions(t)}removeAction(t,e,n){return this.actionManager.removeAction(t,e,n)}removeActions(t){return this.actionManager.removeActions(t)}addAnswer(t,e,n,s){return this.nlgManager.add(t,e,n,s)}removeAnswer(t,e,n,s){return this.nlgManager.remove(t,e,n,s)}findAllAnswers(t,e){return this.nlgManager.findAllAnswers({locale:t,intent:e}).answers}async addCorpora(t){for(let e=0;e<t.length;e+=1)await this.addCorpus(t[e])}async addCorpus(t){let e=t;if("string"==typeof t){const n=this.container.get("fs"),s=await n.readFile(t);if(!s)throw new Error(`Corpus not found "${t}"`);e="string"==typeof s?JSON.parse(s):s}const n=e.locale.slice(0,2);this.addLanguage(n);const{data:s,entities:i}=e;if(i){const t=Object.keys(i);for(let e=0;e<t.length;e+=1){const s=t[e],r=i[s];if(r.type||(r.type="text"),"text"===r.type){const t=r.options||{},e=Object.keys(t);for(let i=0;i<e.length;i+=1)this.addNerRuleOptionTexts(n,s,e[i],t[e[i]])}}}for(let t=0;t<s.length;t+=1){const e=s[t],{intent:i,utterances:r,answers:o}=e;for(let t=0;t<r.length;t+=1)this.addDocument(n,r[t],i);if(o)for(let t=0;t<o.length;t+=1){const e=o[t];"string"==typeof e?this.addAnswer(n,i,o[t]):this.addAnswer(n,i,e.answer,e.opts)}}}getSentiment(t,e){return"object"==typeof t?this.sentiment.process(t):(e||(e=t,t=this.guessLanguage(e)),this.sentiment.process({utterance:e,locale:t}))}describeLanguage(t,e){this.nluManager.describeLanguage(t,e)}async train(){this.nluManager.addLanguage(this.settings.languages);const t=await this.nluManager.train();return this.settings.autoSave&&await this.save(this.settings.modelFileName,!0),t}async classify(t,e,n){return this.nluManager.process(t,e,n||this.settings.nlu)}async extractEntities(t,e,n,s){if("object"==typeof t)return this.ner.process(t);return e||(e=t,t=void 0),t||(t=this.guessLanguage(e)),await this.ner.process({locale:t,utterance:e,context:n,settings:this.applySettings(s,this.settings.ner)})}async process(t,e,n={},s){let i;"object"==typeof t&&("object"==typeof e&&e.value?(t=void 0,e=e.value):i=t),i&&(t=i.locale,e=i.utterance||i.message,n.channel=i.channel,n.app=i.app),e||(e=t,t=void 0),t||(t=this.guessLanguage(e));const r={locale:t,utterance:e,context:n,settings:this.applySettings(s,this.settings.nlu)};let o=await this.nluManager.process(r);const a=await this.ner.generateEntityUtterance(t,e);if(a&&a!==e){const i={locale:t,utterance:a,context:n,settings:this.applySettings(s,this.settings.nlu)},r=await this.nluManager.process(i);r&&(r.score>o.score||"None"===o.intent)&&(o=r,o.utterance=e,o.optionalUtterance=a)}o.score<this.settings.threshold&&(o.score=1,o.intent="None"),o.context=n,o=await this.ner.process({...o});const u=await this.nlgManager.run({...o});o.answers=u.answers,o.answer=u.answer,o=await this.actionManager.run({...o});const c=await this.getSentiment(t,e);o.sentiment=c?c.sentiment:void 0,this.slotManager.process(o,n)&&o.entities.forEach(t=>{n[t.entity]=t.option||t.utteranceText}),n.slotFill=o.slotFill,delete o.context,delete o.settings;const l=i?this.applySettings(i,o):o;if(this.onIntent)await this.onIntent(this,l);else{const t=`onIntent(${l.intent})`,e=this.container.getPipeline(t);e&&await this.container.runPipeline(e,l,this)}return l}toJSON(){const t={settings:{...this.settings},nluManager:this.nluManager.toJSON(),ner:this.ner.toJSON(),nlgManager:this.nlgManager.toJSON(),actionManager:this.actionManager.toJSON(),slotManager:this.slotManager.save()};return delete t.settings.container,t}fromJSON(t){this.applySettings(this.settings,t.settings),this.nluManager.fromJSON(t.nluManager),this.ner.fromJSON(t.ner),this.nlgManager.fromJSON(t.nlgManager),this.actionManager.fromJSON(t.actionManager),this.slotManager.load(t.slotManager)}export(t=!1){const e=this.toJSON();return t?JSON.stringify(e):JSON.stringify(e,null,2)}import(t){const e="string"==typeof t?JSON.parse(t):t;this.fromJSON(e)}async save(t,e=!1){const n=this.container.get("fs"),s=t||"model.nlp";await n.writeFile(s,this.export(e))}async load(t){const e=this.container.get("fs"),n=t||"model.nlp",s=await e.readFile(n);return!!s&&(this.import(s),!0)}}},function(t,e,n){const s=n(232),i=n(252),r=n(236),o=n(257);t.exports={Nlu:s,NluNeural:i,DomainManager:r,NluManager:o}},function(t,e,n){const s=n(235);t.exports=class{constructor(t){this.settings=t||{},this.minLength=this.settings.minLength||4,this.settings.features?this.setFeatures(this.settings.features):(this.features={},this.featuresByLength={})}setFeatures(t){this.features=t,this.featuresByLength={},this.featuresList=Object.keys(this.features);for(let t=0;t<this.featuresList.length;t+=1){const e=this.featuresList[t],{length:n}=e;this.featuresByLength[n]||(this.featuresByLength[n]=[]),this.featuresByLength[n].push(e)}}checkToken(t,e){if(this.features[t])return t;if(t.length<this.minLength)return t;let n,i=1/0;for(let r=t.length-e-1;r<t.length+e;r+=1){const o=this.featuresByLength[r+1];if(o)for(let r=0;r<o.length;r+=1){const a=o[r],u=s(t,a);u<=e&&(u<i?(n=a,i=u):u===i&&Math.abs(n.length-t.length)>Math.abs(a.length-t.length)&&(n=a,i=u))}}return n||t}check(t,e){if(!Array.isArray(t)){const n=Object.keys(t),s=this.check(n,e),i={};for(let e=0;e<s.length;e+=1)i[s[e]]=t[n[e]];return i}const n=[];for(let s=0;s<t.length;s+=1)n.push(this.checkToken(t[s],e));return n}}},function(t,e){t.exports={bn:!1,el:!0,en:!0,hi:!1,fa:!1,fr:!0,ru:!0,es:!0,gl:!0,it:!0,nl:!0,no:!0,pt:!0,pl:!0,sv:!0,tl:!0,id:!0,ja:!1,ar:!1,hy:!1,eu:!0,ca:!0,cs:!0,da:!0,fi:!0,de:!0,hu:!0,ga:!0,ro:!0,sl:!0,ta:!1,th:!1,tr:!0,zh:!1}},function(t,e,n){const{NeuralNetwork:s}=n(253),i=n(232);class r extends i{innerTrain(t){const e=t;return this.neuralNetwork=new s(e.settings,this.container),e.status=this.neuralNetwork.train(e.corpus),e}innerProcess(t){const e=t;return this.neuralNetwork?e.classifications=this.neuralNetwork.run(e.tokens):e.classifications={None:1},e}registerDefault(){super.registerDefault(),this.container.register("NeuralNlu",r,!1)}toJSON(){const t=super.toJSON();return t.neuralNetwork=this.neuralNetwork.toJSON(),t}fromJSON(t){super.fromJSON(t),this.neuralNetwork=new s,this.neuralNetwork.fromJSON(t.neuralNetwork)}}t.exports=r},function(t,e,n){const s=n(254);t.exports={NeuralNetwork:s}},function(t,e,n){const{Clonable:s}=n(5),{LookupTable:i,lookupToArray:r,lookupToObject:o,toHash:a,getTypedArrayFn:u}=n(255),c=n(256);t.exports=class extends s{constructor(t={},e){super({},e),this.perceptronSettings={},this.applySettings(this.perceptronSettings,t),this.applySettings(this.perceptronSettings,c),!0===this.perceptronSettings.log?this.logFn=(t,e)=>this.logger.info(`Epoch ${t.iterations} loss ${t.error} time ${e}ms`):"function"==typeof this.perceptronSettings.log&&(this.logFn=this.perceptronSettings.log),this.jsonExport={perceptrons:this.exportPerceptrons},this.jsonImport={perceptrons:this.importPerceptrons}}initialize(){const t=this.sizes[1];this.inputs=[],this.outputs=[],this.perceptrons=[];for(let e=0;e<t;e+=1)this.perceptrons.push({weights:new Float32Array(this.sizes[0]),changes:new Float32Array(this.sizes[0]),bias:0})}get isRunnable(){return!!this.sizes}run(t){if(this.isRunnable){const e=r(this.inputLookup,t);return o(this.outputLookup,this.runInput(e).slice(0))}}runInput(t){this.inputs=t;const{alpha:e}=this.perceptronSettings,n=Object.keys(t);for(let s=0;s<this.sizes[1];s+=1){const i=this.perceptrons[s],{weights:r,bias:o}=i;let a=o;for(let e=0;e<n.length;e+=1){const s=n[e];r[s]&&(1===t[s]?a+=r[s]:a+=t[s]*r[s])}this.outputs[s]=a<0?0:e*a}return this.outputs}verifyIsInitialized(t){this.sizes||(this.sizes=[t[0].input.length,t[0].output.length],this.initialize())}train(t){if(!t||!t.length)return{};if(void 0!==t[t.length-1].input.nonefeature){const e={};for(let n=0;n<t.length-1;n+=1){const s=Object.keys(t[n].output);for(let t=0;t<s.length;t+=1)e[s[t]]||(e[s[t]]=1)}const n=t[t.length-1],s=Object.keys(e);for(let t=0;t<s.length;t+=1)n.output[s[t]]=1e-7}const e=this.formatData(t),n=[];for(let t=0;t<e.length;t+=1){const s=e[t].input,i={};for(let t=0;t<s.length;t+=1)s[t]&&(i[t]=s[t]);n.push(i)}let s,i;for(this.status||(this.status={error:1/0,deltaError:1/0,iterations:0}),this.verifyIsInitialized(e),this.perceptronSettings.fixedError?(s=this.perceptronSettings.errorThresh,i=this.perceptronSettings.deltaErrorThresh):(s=this.sizes[1]>50?50*this.perceptronSettings.errorThresh/this.sizes[1]:this.perceptronSettings.errorThresh,i=this.sizes[1]>50?50*this.perceptronSettings.deltaErrorThresh/this.sizes[1]:this.perceptronSettings.deltaErrorThresh);this.status.iterations<this.perceptronSettings.iterations&&this.status.error>s&&this.status.deltaError>i;){const t=new Date;this.status.iterations+=1;const s=this.status.error;this.status.error=0;for(let t=0;t<e.length;t+=1){const s=e[t];this.status.error+=this.calculateDeltas(s.input,s.output,this.runInput(n[t]))}this.status.error/=e.length,this.status.deltaError=Math.abs(this.status.error-s);const i=new Date;this.logFn&&this.logFn(this.status,i.getTime()-t.getTime())}return this.status}calculateDeltas(t,e,n,s){const{learningRate:i,alpha:r,momentum:o}=this.perceptronSettings,a=this.sizes[1];let u=0;const c=i/(1+.001*this.status.iterations),l=void 0===s?a:s+1;for(let i=void 0===s?0:s;i<l;i+=1){const s=this.perceptrons[i],{changes:a,weights:l}=s,h=n[i],p=e[i]-h;if(p){u+=p**2;const e=(h>0?1:r)*p*c;for(let n=0;n<t.length;n+=1){const s=e*t[n]+o*a[n];a[n]=s,l[n]+=s}s.bias+=e}else for(let e;e<t.length;e+=1){const t=o*a[e];a[e]=t,l[e]+=t}}return u/a}formatData(t){this.inputLookup||(this.inputLookup=new i(t,"input").table,this.outputLookup=new i(t,"output").table);const e=u(this.inputLookup),n=u(this.outputLookup),s=[];for(let i=0;i<t.length;i+=1)s.push({input:e(t[i].input),output:n(t[i].output)});return s}adjust(t){return this.perceptronSettings.maxDecimals&&this.perceptronSettings.maxDecimals<17?parseFloat(t.toFixed(this.perceptronSettings.maxDecimals)):t}toJSON(){const t={},e=Object.keys(this.perceptronSettings);for(let n=0;n<e.length;n+=1){const s=e[n];this.perceptronSettings[s]!==c[s]&&(t[s]=this.perceptronSettings[s])}if(!this.inputLookup)return{perceptronSettings:t};const n=Object.keys(this.inputLookup),s=Object.keys(this.outputLookup),i=[];for(let t=0;t<s.length;t+=1){const e=this.perceptrons[t],n=[...e.weights,e.bias];i.push(n)}return{features:n,intents:s,perceptrons:i,perceptronSettings:t}}fromJSON(t){if(this.perceptronSettings=this.applySettings({...c,...t.perceptronSettings}),t.features){this.sizes=[t.features.length,t.intents.length];const e={};for(let n=0;n<t.features.length;n+=1)e[t.features[n]]={};this.inputLookup=a(e);const n={};for(let e=0;e<t.intents.length;e+=1){n[t.intents[e]]={}}this.outputLookup=a(n),this.initialize();for(let e=0;e<t.intents.length;e+=1){const n=this.perceptrons[e],s=t.perceptrons[e];n.bias=s[s.length-1];for(let e=0;e<t.features.length;e+=1)n.weights[e]=s[e]}}}}},function(t,e){t.exports={LookupTable:class{constructor(t,e){this.length=0,this.prop=e,this.table={},this.build(t)}buildDatum(t){Object.keys(t[this.prop]).forEach(t=>{void 0===this.table[t]&&(this.table[t]=this.length,this.length+=1)})}build(t){t.forEach(t=>this.buildDatum(t))}},toArray:t=>Object.keys(t).map(e=>t[e]),toHash:function(t){const e={};let n=0;const s=Object.keys(t);for(let t=0;t<s.length;t+=1)e[s[t]]=n,n+=1;return e},lookupToArray:function(t,e){const n={},s=Object.keys(t);for(let i=0;i<s.length;i+=1){const r=s[i];e[r]&&(n[t[r]]=e[r])}return n},lookupToObject:function(t,e){const n={},s=Object.keys(t);for(let i=0;i<s.length;i+=1)n[s[i]]=e[t[s[i]]];return n},getTypedArrayFn:function(t){const{length:e}=Object.keys(t);return n=>{const s=new Float32Array(e);return Object.keys(n).forEach(e=>{const i=t[e];void 0!==i&&(s[i]=n[e]||0)}),s}}}},function(t){t.exports={iterations:2e4,errorThresh:5e-5,fixedError:!1,deltaErrorThresh:1e-6,learningRate:.7,momentum:.5,alpha:.08,log:!1}},function(t,e,n){const{Clonable:s}=n(5),{Language:i}=n(237),r=n(236);t.exports=class extends s{constructor(t={},e){super({settings:{},container:t.container||e},e),this.applySettings(this.settings,t),this.settings.tag||(this.settings.tag="nlu-manager"),this.registerDefault(),this.applySettings(this.settings,this.container.getConfiguration(this.settings.tag)),this.container.get("Language")||this.container.register("Language",i,!1),this.guesser=this.container.get("Language"),this.locales=[],this.languageNames={},this.domainManagers={},this.intentDomains={},this.settings.locales&&this.addLanguage(this.settings.locales),this.applySettings(this,{pipelineTrain:this.getPipeline(`${this.settings.tag}-train`),pipelineProcess:this.getPipeline(`${this.settings.tag}-process`)})}registerDefault(){this.container.registerConfiguration("nlu-manager",{},!1),this.container.registerPipeline("nlu-manager-train",[".innerTrain"],!1),this.container.registerPipeline("nlu-manager-process",[".fillLanguage",".innerClassify",".checkIfIsNone","delete output.settings","delete output.classification"],!1)}describeLanguage(t,e){this.languageNames[t]={locale:t,name:e}}addLanguage(t){if(t){const e=Array.isArray(t)?t:[t];for(let t=0;t<e.length;t+=1){const n=e[t].substr(0,2).toLowerCase();this.locales.includes(n)||this.locales.push(n),this.domainManagers[n]||(this.domainManagers[n]=new r({locale:n,...this.settings.domain,useNoneFeature:this.settings.useNoneFeature},this.container))}}}guessLanguage(t){const e=t,n="string"==typeof e;if(1===this.locales.length)return n?this.locales[0]:([e.locale]=this.locales,e);if(!e)return n?void 0:e;if(!n&&e.locale)return e;const s=n?e:e.utterance;if(1===this.locales.length){if(n)return this.locales[0];[e.locale]=this.locales}const i=this.guesser.guess(s,this.locales,1),r=i&&i.length>0?i[0].alpha2:void 0;return n?r:(e.locale=r,e)}assignDomain(t,e,n){const s=n?t.substr(0,2).toLowerCase():void 0,i=n?e:t,r=n||e;if(s)this.intentDomains[s]||(this.intentDomains[s]={}),this.intentDomains[s][i]=r;else for(let t=0;t<this.locales.length;t+=1)this.assignDomain(this.locales[t],i,r)}getIntentDomain(t,e){const n=t.substr(0,2).toLowerCase();return this.intentDomains[n]&&this.intentDomains[n][e]||"default"}getDomains(){const t={},e=Object.keys(this.intentDomains);for(let n=0;n<e.length;n+=1){const s=e[n];t[s]={};const i=Object.keys(this.intentDomains[s]);for(let e=0;e<i.length;e+=1){const n=i[e],r=this.intentDomains[s][n];t[s][r]||(t[s][r]=[]),t[s][r].push(n)}}return t}consolidateLocale(t,e){const n=t?t.substr(0,2).toLowerCase():this.guessLanguage(e);if(!n)throw new Error("Locale must be defined");return n}consolidateManager(t){const e=this.domainManagers[t];if(!e)throw new Error(`Domain Manager not found for locale ${t}`);return e}add(t,e,n){const s=this.consolidateLocale(t,e),i=this.consolidateManager(s),r=this.getIntentDomain(s,n);this.guesser.addExtraSentence(s,e),i.add(r,e,n)}remove(t,e,n){const s=this.consolidateLocale(t,e),i=this.consolidateManager(s),r=this.getIntentDomain(s,n);i.remove(r,e,n)}async innerTrain(t){let e=t.locales||this.locales;Array.isArray(e)||(e=[e]);const n=e.filter(t=>this.domainManagers[t]).map(e=>this.domainManagers[e].train(t.settings));return Promise.all(n)}async train(t){const e={nluManager:this,settings:this.applySettings(t,this.settings)};return delete e.settings.tag,this.runPipeline(e,this.pipelineTrain)}fillLanguage(t){const e=t;return e.languageGuessed=!1,e.locale||(e.locale=this.guessLanguage(e.utterance),e.languageGuessed=!0),e.locale&&(e.localeIso2=e.locale.substr(0,2).toLowerCase(),e.language=(this.languageNames[e.localeIso2]||this.guesser.languagesAlpha2[e.localeIso2]||{}).name),e}classificationsIsNone(t){return 1!==t.length&&(0===t.length||0===t[0].score||t[0].score===t[1].score)}checkIfIsNone(t){const e=t;return this.classificationsIsNone(e.classifications)&&(e.intent="None",e.score=1),e}async innerClassify(t){const e=t,n=this.domainManagers[e.localeIso2];if(!n)return e.classifications=[],e.domain=void 0,e.intent=void 0,e.score=void 0,e;const s=await n.process(t);return e.classifications=s.classifications.sort((t,e)=>e.score-t.score),0===e.classifications.length&&e.classifications.push({intent:"None",score:1}),e.intent=e.classifications[0].intent,e.score=e.classifications[0].score,"None"===e.intent?s.domain="default":"default"===s.domain?e.domain=this.getIntentDomain(e.locale,e.intent):e.domain=s.domain,e}process(t,e,n,s){const i="object"==typeof t?t:{locale:void 0===e?void 0:t,utterance:void 0===e?t:e,domain:n,settings:s||this.settings};return this.runPipeline(i,this.pipelineProcess)}toJSON(){const t={settings:this.settings,locales:this.locales,languageNames:this.languageNames,domainManagers:{},intentDomains:this.intentDomains,extraSentences:this.guesser.extraSentences.slice(0)};delete t.settings.container;const e=Object.keys(this.domainManagers);for(let n=0;n<e.length;n+=1){const s=e[n];t.domainManagers[s]=this.domainManagers[s].toJSON()}return t}fromJSON(t){this.applySettings(this.settings,t.settings);for(let e=0;e<t.locales.length;e+=1)this.addLanguage(t.locales[e]);this.languageNames=t.languageNames,this.intentDomains=t.intentDomains;const e=Object.keys(t.domainManagers);for(let n=0;n<e.length;n+=1){const s=e[n];this.domainManagers[s].fromJSON(t.domainManagers[s])}for(let e=0;e<t.extraSentences.length;e+=1){const n=t.extraSentences[e];this.guesser.addExtraSentence(n[0],n[1])}}}},function(t,e,n){const s=n(259),i=n(260),r={cmn:/[\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u3005\u3007\u3021-\u3029\u3038-\u303B\u3400-\u4DB5\u4E00-\u9FCC\uF900-\uFA6D\uFA70-\uFAD9]|[\uD840-\uD868\uD86A-\uD86C][\uDC00-\uDFFF]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D]|\uD87E[\uDC00-\uDE1D]/g,Latin:/[A-Za-z\xAA\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02B8\u02E0-\u02E4\u1D00-\u1D25\u1D2C-\u1D5C\u1D62-\u1D65\u1D6B-\u1D77\u1D79-\u1DBE\u1E00-\u1EFF\u2071\u207F\u2090-\u209C\u212A\u212B\u2132\u214E\u2160-\u2188\u2C60-\u2C7F\uA722-\uA787\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA7FF\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uFB00-\uFB06\uFF21-\uFF3A\uFF41-\uFF5A]/g,Cyrillic:/[\u0400-\u0484\u0487-\u052F\u1D2B\u1D78\u2DE0-\u2DFF\uA640-\uA69D\uA69F]/g,Arabic:/[\u0600-\u0604\u0606-\u060B\u060D-\u061A\u061E\u0620-\u063F\u0641-\u064A\u0656-\u065F\u066A-\u066F\u0671-\u06DC\u06DE-\u06FF\u0750-\u077F\u08A0-\u08B2\u08E4-\u08FF\uFB50-\uFBC1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFD\uFE70-\uFE74\uFE76-\uFEFC]|\uD803[\uDE60-\uDE7E]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB\uDEF0\uDEF1]/g,ben:/[\u0980-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09FB]/g,Devanagari:/[\u0900-\u0950\u0953-\u0963\u0966-\u097F\uA8E0-\uA8FB]/g,jpn:/[\u3041-\u3096\u309D-\u309F]|\uD82C\uDC01|\uD83C\uDE00|[\u30A1-\u30FA\u30FD-\u30FF\u31F0-\u31FF\u32D0-\u32FE\u3300-\u3357\uFF66-\uFF6F\uFF71-\uFF9D]|\uD82C\uDC00/g,kor:/[\u1100-\u11FF\u302E\u302F\u3131-\u318E\u3200-\u321E\u3260-\u327E\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uFFA0-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/g,tel:/[\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58\u0C59\u0C60-\u0C63\u0C66-\u0C6F\u0C78-\u0C7F]/g,tam:/[\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BFA]/g,guj:/[\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AF1]/g,kan:/[\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2]/g,mal:/[\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D60-\u0D63\u0D66-\u0D75\u0D79-\u0D7F]/g,Myanmar:/[\u1000-\u109F\uA9E0-\uA9FE\uAA60-\uAA7F]/g,ori:/[\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B77]/g,pan:/[\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75]/g,Ethiopic:/[\u1200-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u137C\u1380-\u1399\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E]/g,tha:/[\u0E01-\u0E3A\u0E40-\u0E5B]/g,sin:/[\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2-\u0DF4]|\uD804[\uDDE1-\uDDF4]/g,ell:/[\u0370-\u0373\u0375-\u0377\u037A-\u037D\u037F\u0384\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03E1\u03F0-\u03FF\u1D26-\u1D2A\u1D5D-\u1D61\u1D66-\u1D6A\u1DBF\u1F00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FC4\u1FC6-\u1FD3\u1FD6-\u1FDB\u1FDD-\u1FEF\u1FF2-\u1FF4\u1FF6-\u1FFE\u2126\uAB65]|\uD800[\uDD40-\uDD8C\uDDA0]|\uD834[\uDE00-\uDE45]/g,khm:/[\u1780-\u17DD\u17E0-\u17E9\u17F0-\u17F9\u19E0-\u19FF]/g,hye:/[\u0531-\u0556\u0559-\u055F\u0561-\u0587\u058A\u058D-\u058F\uFB13-\uFB17]/g,sat:/[\u1C50-\u1C7F]/g,bod:/[\u0F00-\u0F47\u0F49-\u0F6C\u0F71-\u0F97\u0F99-\u0FBC\u0FBE-\u0FCC\u0FCE-\u0FD4\u0FD9\u0FDA]/g,Hebrew:/[\u0591-\u05C7\u05D0-\u05EA\u05F0-\u05F4\uFB1D-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFB4F]/g,kat:/[\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u10FF\u2D00-\u2D25\u2D27\u2D2D]/g,lao:/[\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF]/g,zgh:/[\u2D30-\u2D67\u2D6F\u2D70\u2D7F]/g,iii:/[\uA000-\uA48C\uA490-\uA4C6]/g,aii:/[\u0700-\u070D\u070F-\u074A\u074D-\u074F]/g},o=()=>[["und",1]];class a{constructor(){this.languagesAlpha3={},this.languagesAlpha2={},this.extraSentences=[],this.buildData()}static getTrigrams(t){const e=[],n=t?` ${String(t).replace(/[\u0021-\u0040]+/g," ").replace(/\s+/g," ").trim().toLowerCase()} `:"";if(!n||n.length<3)return e;for(let t=0,s=n.length-2;t<s;t+=1)e[t]=n.substr(t,3);return e}static asTuples(t){const e=a.getTrigrams(t).reduce((t,e)=>{const n=t;return n[e]=(n[e]||0)+1,n},{}),n=[];return Object.keys(e).forEach(t=>{n.push([t,e[t]])}),n.sort((t,e)=>t[1]-e[1]),n}static getDistance(t,e){let n=0;return t.forEach(t=>{n+=t[0]in e?Math.abs(t[1]-e[t[0]]-1):300}),n}static getOccurrence(t,e){const n=t.match(e);return(n?n.length:0)/t.length||0}static getTopScript(t){let e,n=-1;return Object.keys(r).forEach(s=>{const i=a.getOccurrence(t,r[s]);i>n&&(n=i,e=s)}),[e,n]}static filterLanguages(t,e,n){if(0===e.length&&0===n.length)return t;const s={};return Object.keys(t).forEach(i=>{(0===e.length||e.indexOf(i)>-1)&&-1===n.indexOf(i)&&(s[i]=t[i])}),s}static getDistances(t,e,n){const s=[],i=n.whitelist||[],r=n.blacklist||[],u=a.filterLanguages(e,i,r);return u?(Object.keys(u).forEach(e=>{s.push([e,a.getDistance(t,u[e])])}),s.sort((t,e)=>t[1]-e[1])):o()}static detectAll(t,e={}){const n=e.minLength||10;if(!t||t.length<n)return o();const s=t.substr(0,2048),r=a.getTopScript(s);if(!(r[0]in i)&&r[1]>.5){if(!e.whitelist)return[[r[0],1]];if(e.whitelist.includes(r[0]))return[[r[0],1]];if("cmn"===r[0]&&e.whitelist.includes("jpn"))return[["jpn",1]]}if(i[r[0]]){const t=a.getDistances(a.asTuples(s),i[r[0]],e);if("und"===t[0][0])return[[r[0],1]];const n=t[0][1],o=300*s.length-n;return t.map(t=>[t[0],1-(t[1]-n)/o||0])}return[[r[0],1]]}buildData(){for(let t=0;t<s.length;t+=1){const e={alpha2:s[t][0],alpha3:s[t][1],name:s[t][2]};this.languagesAlpha3[e.alpha3]=e,this.languagesAlpha2[e.alpha2]=e}}transformWhitelist(t){const e=[];for(let n=0;n<t.length;n+=1)if(3===t[n].length)e.push(t[n]);else{const s=this.languagesAlpha2[t[n]];s&&e.push(s.alpha3)}return e}guess(t,e,n){const s={};t.length<10&&(s.minLength=t.length),e&&e.length&&e.length>0&&(s.whitelist=this.transformWhitelist(e));const i=a.detectAll(t,s),r=[];for(let t=0;t<i.length;t+=1){const e=this.languagesAlpha3[i[t][0]];if(e&&(r.push({alpha3:e.alpha3,alpha2:e.alpha2,language:e.name,score:i[t][1]}),n&&r.length>=n))break}return r}guessBest(t,e){return this.guess(t,e,1)[0]}addTrigrams(t,e){const n=this.languagesAlpha2[t],s=n?n.alpha3:t,r=a.getTopScript(e)[0],o=a.getTrigrams(e);i[r]&&(i[r][s]||(i[r][s]={}),o.forEach(t=>{i[r][s][t]=1}))}addExtraSentence(t,e){this.extraSentences.push([t,e]),this.addTrigrams(t,e)}processExtraSentences(){this.extraSentences.forEach(t=>{this.addTrigrams(t[0],t[1])})}static lansplit(t){if(t.includes("|"))return t.split("|");const e=[];for(let n=0;n<t.length;n+=3)e.push(t.substr(n,3));return e}static addModel(t,e,n){const s=i[t],r=a.lansplit(n);let o=r.length;const u={};for(;o>0;)o-=1,u[r[o]]=o;s[e]=u}addModel(t,e,n){a.addModel(t,e,n)}static buildModel(){Object.keys(i).forEach(t=>{const e=i[t];Object.keys(e).forEach(n=>{a.addModel(t,n,e[n])})})}}a.buildModel(),t.exports=a},function(t){t.exports=[["ar","arb","Arabic"],["bn","ben","Bengali"],["ca","cat","Catalan"],["cs","ces","Czech"],["da","dan","Danish"],["de","deu","German"],["el","ell","Greek"],["en","eng","English"],["eu","eus","Basque"],["fa","fas","Persian"],["fi","fin","Finnish"],["fr","fra","French"],["ga","gle","Irish"],["gl","glg","Galician"],["hi","hin","Hindi"],["hu","hun","Hungarian"],["hy","hye","Armenian"],["id","ind","Indonesian"],["it","ita","Italian"],["ja","jpn","Japanese"],["nl","nld","Dutch"],["no","nor","Norwegian"],["pt","por","Portuguese"],["ro","ron","Romanian"],["ru","rus","Russian"],["sl","slv","Slovenian"],["es","spa","Spanish"],["sv","swe","Swedish"],["ta","tam","Tamil"],["tl","tgl","Tagalog"],["th","tha","Thai"],["tr","tur","Turkish"],["uk","ukr","Ukrainian"],["zh","cmn","Chinese"]]},function(t){t.exports={Latin:{spa:"",eng:"",por:"",ind:"",fra:"",deu:"",ita:"",tur:"",nld:"",tgl:"",hun:"",ces:"",swe:"",fin:"",dan:"",cat:"",glg:"",slv:""},Cyrillic:{rus:"",ukr:""},Arabic:{arb:"",fas:""},Devanagari:{hin:""},Ethiopic:{},Hebrew:{}}},function(t,e,n){const s=n(262),i=n(263),r=n(264),o=n(265),a=n(266);t.exports={Ner:s,ExtractorEnum:i,ExtractorRegex:r,ExtractorTrim:o,ExtractorBuiltin:a}},function(t,e,n){const{Clonable:s}=n(5),{TrimType:i}=n(238);class r extends s{constructor(t={},e){super({settings:{},container:t.container||e},e),this.applySettings(this.settings,t),this.applySettings(this.settings),this.settings.tag||(this.settings.tag="ner"),this.registerDefault(),this.applySettings(this.settings,this.container.getConfiguration(this.settings.tag)),this.rules={},this.applySettings(this,{pipelineProcess:this.getPipeline(`${this.settings.tag}-process`)})}registerDefault(){this.container.registerPipeline("ner-process",[".decideRules","extract-enum","extract-regex","extract-trim","extract-builtin"],!1),this.container.registerPipeline("ner-??-process",[".decideRules","extract-enum","extract-regex","extract-trim","extract-builtin",".reduceEdges"],!1)}getRulesByName(t="*",e,n=!1){if(!this.rules[t]){if(!n)return;this.rules[t]={}}if(!this.rules[t][e]){if(!n)return;this.rules[t][e]={name:e,type:"enum",rules:[]}}return this.rules[t][e]}addRule(t="*",e,n,s){this.rules[t]||(this.rules[t]={}),this.rules[t][e]||(this.rules[t][e]={name:e,type:n,rules:[]}),this.rules[t][e].rules.push(s)}asString(t){return t&&t.toString?t.toString():JSON.stringify(t)}findRule(t,e){const n=this.asString(e);for(let e=0;e<t.length;e+=1)if(this.asString(t[e])===n)return e;return-1}removeRule(t="*",e,n){if(this.rules[t]&&this.rules[t][e])if(n){const s=this.findRule(this.rules[t][e].rules,n);s>-1&&this.rules[t][e].rules.splice(s,1)}else delete this.rules[t][e]}getRules(t="*"){const e=[];if(this.rules[t]){const n=Object.keys(this.rules[t]);for(let s=0;s<n.length;s+=1)e.push(this.rules[t][n[s]])}if("*"!==t&&this.rules["*"]){const t=Object.keys(this.rules["*"]);for(let n=0;n<t.length;n+=1)e.push(this.rules["*"][t[n]])}return e}decideRules(t){const e=t;return e.nerRules=this.getRules(e.locale||"en"),e}getRuleOption(t,e){for(let n=0;n<t.length;n+=1)if(t[n].option===e)return t[n]}addRuleOptionTexts(t,e,n,s){if(Array.isArray(t))for(let i=0;i<t.length;i+=1)this.addRuleOptionTexts(t[i],e,n,s);else{let i=s||n;Array.isArray(i)||(i=[i]);const r=this.getRulesByName(t,e,!0);let o=this.getRuleOption(r.rules,n);if(o){const t={};for(let e=0;e<o.texts.length;e+=1)t[o.texts[e]]=1;for(let e=0;e<i.length;e+=1)t[i[e]]=1;o.texts=Object.keys(t)}else o={option:n,texts:i},r.rules.push(o)}}removeRuleOptionTexts(t,e,n,s){if(Array.isArray(t))for(let i=0;i<t.length;i+=1)this.removeRuleOptionTexts(t[i],e,n,s);else{let i=s||n;Array.isArray(i)||(i=[i]);const r=this.getRulesByName(t,e,!1);if(r){const t=this.getRuleOption(r.rules,n);if(t){const e={};for(let n=0;n<t.texts.length;n+=1)e[t.texts[n]]=1;for(let t=0;t<i.length;t+=1)delete e[i[t]];t.texts=Object.keys(e)}}}}static str2regex(t){const e=t.lastIndexOf("/");return new RegExp(t.slice(1,e),t.slice(e+1))}static regex2str(t){return t.toString()}addRegexRule(t,e,n){const s="string"==typeof n?r.str2regex(n):n,i=s.flags.includes("g")?s:new RegExp(s.source,`${s.flags}g`);this.addRule(t,e,"regex",i)}addBetweenCondition(t,e,n,s,i){const o=i||{},a=Array.isArray(n)?n:[n],u=Array.isArray(s)?s:[s],c=[];for(let t=0;t<a.length;t+=1)for(let e=0;e<u.length;e+=1){const n=!0===o.noSpaces?a[t]:` ${a[t]} `,s=!0===o.noSpaces?u[e]:` ${u[e]} `;c.push(`(?<=${n})(.*)(?=${s})`)}let l=`/${c.join("|")}/g`;!0!==o.caseSensitive&&(l+="i");const h={type:"between",leftWords:a,rightWords:u,regex:r.str2regex(l),options:o};this.addRule(t,e,"trim",h)}addPositionCondition(t,e,n,s,i){const r=i||{},o={type:n,words:Array.isArray(s)?s:[s],options:r};this.addRule(t,e,"trim",o)}addAfterCondition(t,e,n,s){this.addPositionCondition(t,e,i.After,n,s)}addAfterFirstCondition(t,e,n,s){this.addPositionCondition(t,e,i.AfterFirst,n,s)}addAfterLastCondition(t,e,n,s){this.addPositionCondition(t,e,i.AfterLast,n,s)}addBeforeCondition(t,e,n,s){this.addPositionCondition(t,e,i.Before,n,s)}addBeforeFirstCondition(t,e,n,s){this.addPositionCondition(t,e,i.BeforeFirst,n,s)}addBeforeLastCondition(t,e,n,s){this.addPositionCondition(t,e,i.BeforeLast,n,s)}reduceEdges(t){return t.entities=t.edges,delete t.edges,delete t.nerRules,t}async process(t){const e={threshold:this.settings.threshold||.8,...t},n=await this.runPipeline(e,e.locale?`${this.settings.tag}-${e.locale}-process`:this.pipelineProcess);return delete n.threshold,n}nameToEntity(t){return`${void 0===this.settings.entityPreffix?"@":this.settings.entityPreffix}${t}${void 0===this.settings.entitySuffix?"":this.settings.entitySuffix}`}entityToName(t){if(!t)return t;let e=t;const n=void 0===this.settings.entityPreffix?"@":this.settings.entityPreffix,s=void 0===this.settings.entitySuffix?"":this.settings.entitySuffix;if(n){if(!e.startsWith(n))return t;e=e.slice(n.length)}if(s){if(!e.endsWith(s))return t;e=e.slice(0,-s.length)}return e}isEntity(t){return this.entityToName(t)!==t}getEntitiesFromUtterance(t,e){e||(e=t,t="es");const n=e.split(/[\s,.!?;:([\]'")/]+/).filter(t=>t),s=[];for(let t=0;t<n.length;t+=1){const e=n[t];this.isEntity(e)&&s.push(this.entityToName(e))}return s}async generateEntityUtterance(t,e){let n={locale:t,utterance:e};n=await this.process(n);const{entities:s}=n;if(!s||!s.length)return e;s.sort((t,e)=>t.start-e.start);let i=0,r="";for(let t=0;t<s.length;t+=1){const n=s[t],o=e.slice(i,n.start);i=n.end+1,r+=o,r+=this.nameToEntity(n.entity)}return r+=e.slice(s[s.length-1].end+1),r}toJSON(){const t={settings:{...this.settings},rules:this.rules};return delete t.settings.container,t}fromJSON(t){this.applySettings(this.settings,t.settings),this.rules=t.rules}}t.exports=r},function(t,e,n){const{defaultContainer:s}=n(5),{Language:i}=n(237),{similarity:r}=n(233),o=n(46);t.exports=class{constructor(t=s){this.container=t.container||t,this.name="extract-enum"}getScripts(t){const e=[],n=t.split("");for(let t=0;t<n.length;t+=1)e.push(i.getTopScript(n[t]));return e}isAlphanumeric(t){return/[\u00C0-\u1FFF\u2C00-\uD7FF\w]/.test(t)&&"_"!==t}getWordPositions(t){const e=this.getScripts(t);let n=!0,s=0,i=0;const r=t.length,o=[];for(;i<r;)this.isAlphanumeric(t.charAt(i))?n&&("cmn"===e[i][0]?(o.push({start:i,end:i,len:1}),s=i,n=!0):(s=i,n=!1)):n||(o.push({start:s,end:i-1,len:i-s}),n=!0),i+=1;return n||o.push({start:s,end:i-1,len:i-s}),o}getBestSubstring(t,e,n){const s=t.length,i=e.length;if(s<=i){const n={start:0,end:s-1,len:s,levenshtein:r(t,e,!0)};return n.accuracy=(i-n.levenshtein)/i,n}const o=n||this.getWordPositions(t),a=o.length,u={start:0,end:0,len:0,levenshtein:void 0,accuracy:0};for(let n=0;n<a;n+=1)for(let s=n;s<a;s+=1){const i=t.substring(o[n].start,o[s].end+1),a=r(i,e,!0);(void 0===u.levenshtein||a<u.levenshtein)&&(u.levenshtein=a,u.start=o[n].start,u.end=o[s].end,u.len=u.end-u.start+1)}return u.accuracy=(i-u.levenshtein)/i,u}getBestSubstringList(t,e,n,s=1){const i=t.length,o=e.length,a=[];if(i<=o){const n=r(t,e,!0),u=(o-n)/o;return u>=s&&a.push({start:0,end:i-1,len:i,levenshtein:n,accuracy:u}),a}const u=o*(1-s),c=n||this.getWordPositions(t),l=c.length;for(let n=0;n<l;n+=1)for(let i=n;i<l;i+=1){const l=t.substring(c[n].start,c[i].end+1),h=r(l,e,!0),p=(o-h)/o;if(p>=s&&a.push({start:c[n].start,end:c[i].end,len:c[i].end-c[n].start+1,levenshtein:h,accuracy:p}),l.length-c[0].len>=e.length+u)break}return a}getRules(t){const e=t.nerRules;return e?e.filter(t=>"enum"===t.type):[]}normalize(t){return t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}buildRuleDict(t){const e={};for(let n=0;n<t.rules.length;n+=1){const s=t.rules[n];for(let t=0;t<s.texts.length;t+=1){const n=this.normalize(s.texts[t]);e[n]||(e[n]=[]),e[n].push(s)}}t.dict=e}getBestExact(t,e,n){const s=this.normalize(t),i=e||this.getWordPositions(s),r=i.length,o=[];for(let e=0;e<r;e+=1)for(let a=e;a<r;a+=1){const r=s.substring(i[e].start,i[a].end+1);if(n.dict[r]){const s=n.dict[r];for(let u=0;u<s.length;u+=1)o.push({accuracy:1,start:i[e].start,end:i[a].end,len:i[a].end-i[e].start+1,levenshtein:0,entity:n.name,type:n.type,option:s[u].option,sourceText:r,utteranceText:t.substring(i[e].start,i[a].end+1)})}}return o}extractFromRule(t,e,n,s){const i=[];if(s>=1){e.dict||this.buildRuleDict(e);const s=this.getBestExact(t,n,e);for(let t=0;t<s.length;t+=1)i.push(s[t])}else for(let r=0;r<e.rules.length;r+=1){const o=e.rules[r];for(let a=0;a<o.texts.length;a+=1){const u=this.getBestSubstringList(t,o.texts[a],n,o.threshold||s);for(let n=0;n<u.length;n+=1)i.push({...u[n],entity:e.name,type:e.type,option:e.rules[r].option,sourceText:o.texts[a],utteranceText:t.substring(u[n].start,u[n].end+1)})}}return i}extract(t){const e=t,n=this.getWordPositions(e.text||e.utterance),s=this.getRules(e),i=e.edges||[];for(let t=0;t<s.length;t+=1){const r=this.extractFromRule(e.text||e.utterance,s[t],n,e.threshold||.8);for(let t=0;t<r.length;t+=1)i.push(r[t])}return i.sort((t,e)=>t.start-e.start),e.edges=o(i,!1),e}run(t){const e=t,n=e.locale||"en";return(this.container.get(`extract-enum-${n}`)||this).extract(e)}}},function(t,e,n){const{defaultContainer:s}=n(5),i=n(46);t.exports=class{constructor(t=s){this.container=t.container||t,this.name="extract-regex"}getRules(t){const e=t.nerRules;return e?e.filter(t=>"regex"===t.type):[]}getMatchs(t,e){const n=[];let s;do{const i=e.exec(t);i?(n.push({start:i.index,end:e.lastIndex-1,accuracy:1,sourceText:i[0]}),s=!0):s=!1}while(s);return n}extractFromRule(t,e){const n=[];for(let s=0;s<e.rules.length;s+=1){const i=this.getMatchs(t,e.rules[s]);for(let s=0;s<i.length;s+=1){const r=i[s];r.entity=e.name,r.type=e.type,r.utteranceText=t.substring(r.start,r.end+1),r.len=r.utteranceText.length,n.push(r)}}return n}extract(t){const e=t,n=this.getRules(e),s=e.edges||[];for(let t=0;t<n.length;t+=1){const i=this.extractFromRule(e.text||e.utterance,n[t]);for(let t=0;t<i.length;t+=1)s.push(i[t])}return s.sort((t,e)=>t.start-e.start),e.edges=i(s,!1),e}run(t){const e=t,n=e.locale||"en";return(this.container.get(`extract-regex-${n}`)||this).extract(e)}}},function(t,e,n){const{defaultContainer:s}=n(5),i=n(46),{TrimType:r}=n(238);t.exports=class{constructor(t=s){this.container=t.container||t,this.name="extract-trim"}mustSkip(t,e){if(e.options&&e.options.skip&&e.options.skip.length>0)for(let n=0;n<e.options.skip.length;n+=1){const s=e.options.skip[n];if(e.options.caseSensitive){if(s===t)return!0}else if(s.toLowerCase()===t.toLowerCase())return!0}return!1}matchBetween(t,e,n){const s=[];let i;do{const o=e.regex.exec(` ${t} `);o?(s.push({type:"trim",subtype:r.Between,start:o.index-1,end:e.regex.lastIndex-2,len:o[0].length,accuracy:1,sourceText:o[0],utteranceText:o[0],entity:n}),i=!0):i=!1}while(i);const o=[];for(let t=0;t<s.length;t+=1)this.mustSkip(s[t].utteranceText,e)||o.push(s[t]);return o}findWord(t,e,n=!1,s=!1){const i=[];let r;const o=new RegExp(s?e:` ${e} | ${e}|${e} `,n?"g":"ig");do{const e=o.exec(t);e?(i.push({start:e.index,end:o.lastIndex}),r=!0):r=!1}while(r);return i}getBeforeResults(t,e,n){const s=[];let i=0,o=0;for(let a=0;a<e.length;a+=1){o=e[a].start;const u=t.substring(i,o);s.push({type:"trim",subtype:r.Before,start:i,end:o-1,len:u.length,accuracy:.99,sourceText:u,utteranceText:u,entity:n}),i=e[a].end}return s}getBeforeFirstResults(t,e,n){const s=[],i=e[0].start,o=t.substring(0,i);return s.push({type:"trim",subtype:r.BeforeFirst,start:0,end:i-1,len:o.length,accuracy:.99,sourceText:o,utteranceText:o,entity:n}),s}getBeforeLastResults(t,e,n){const s=[],i=e[e.length-1].start,o=t.substring(0,i);return s.push({type:"trim",subtype:r.BeforeLast,start:0,end:i-1,len:o.length,accuracy:.99,sourceText:o,utteranceText:o,entity:n}),s}getAfterResults(t,e,n){const s=[];let i=0,o=t.length;for(let a=e.length-1;a>=0;a-=1){i=e[a].end;const u=t.substring(i,o);s.unshift({type:"trim",subtype:r.After,start:i,end:o-1,len:u.length,accuracy:.99,sourceText:u,utteranceText:u,entity:n}),o=e[a].start}return s}getAfterFirstResults(t,e,n){const s=[],i=e[0].end,o=t.length,a=t.substring(i,o);return s.push({type:"trim",subtype:r.AfterFirst,start:i,end:o-1,len:a.length,accuracy:.99,sourceText:a,utteranceText:a,entity:n}),s}getAfterLastResults(t,e,n){const s=[],i=e[e.length-1].end,o=t.length,a=t.substring(i,o);return s.push({type:"trim",subtype:r.AfterLast,start:i,end:o-1,len:a.length,accuracy:.99,sourceText:a,utteranceText:a,entity:n}),s}getResults(t,e,n,s){switch(n){case r.Before:return this.getBeforeResults(t,e,s);case r.BeforeFirst:return this.getBeforeFirstResults(t,e,s);case r.BeforeLast:return this.getBeforeLastResults(t,e,s);case r.After:return this.getAfterResults(t,e,s);case r.AfterFirst:return this.getAfterFirstResults(t,e,s);case r.AfterLast:return this.getAfterLastResults(t,e,s);default:return[]}}match(t,e,n,s){const i=[];for(let r=0;r<e.words.length;r+=1){const o=e.options.noSpaces?e.words[r]:` ${e.words[r]}`,a=this.findWord(t,o);a.length>0&&i.push(...this.getResults(t,a,n,s))}const r=[];for(let t=0;t<i.length;t+=1)this.mustSkip(i[t].utteranceText,e)||r.push(i[t]);return r}getRules(t){const e=t.nerRules;return e?e.filter(t=>"trim"===t.type):[]}extractFromRule(t,e){const n=[];for(let s=0;s<e.rules.length;s+=1){const i=e.rules[s];i.type===r.Between?n.push(...this.matchBetween(t,i,e.name)):n.push(...this.match(t,i,i.type,e.name))}return n}extract(t){const e=t,n=this.getRules(e),s=e.edges||[];for(let t=0;t<n.length;t+=1){const i=this.extractFromRule(e.text||e.utterance,n[t]);for(let t=0;t<i.length;t+=1)s.push(i[t])}return s.sort((t,e)=>t.start-e.start),e.edges=i(s,!1),e}run(t){const e=t,n=e.locale||"en";return(this.container.get(`extract-trim-${n}`)||this).extract(e)}}},function(t,e,n){const{defaultContainer:s}=n(5),i=n(46);t.exports=class{constructor(t=s){this.container=t.container||t,this.name="extract-builtin"}extract(t){return t}async run(t){const e=t,n=e.locale||"en",s=this.container.get(`extract-builtin-${n}`)||this,r=await s.extract({text:e.text||e.utterance,locale:e.locale});if(e.edges=e.edges||[],r.edges)for(let t=0;t<r.edges.length;t+=1)e.edges.push(r.edges[t]);if(e.edges=i(e.edges,!1),e.sourceEntities=e.sourceEntities||[],r.sourceEntities)for(let t=0;t<r.sourceEntities.length;t+=1)e.sourceEntities.push(r.sourceEntities[t]);return e}}},function(t,e,n){const s=n(268),i=n(269);t.exports={NlgManager:s,ActionManager:i}},function(t,e,n){const{Clonable:s}=n(5);t.exports=class extends s{constructor(t={},e){super({settings:{},container:t.container||e},e),this.applySettings(this.settings,t),this.settings.tag||(this.settings.tag="nlg-manager"),this.registerDefault(),this.applySettings(this.settings,this.container.getConfiguration(this.settings.tag)),this.responses={},this.applySettings(this,{pipelineFind:this.getPipeline(`${this.settings.tag}-find`)})}registerDefault(){this.container.registerConfiguration("nlg-manager",{},!1),this.container.registerPipeline("nlg-manager-find",[".findAllAnswers",".filterAnswers",".renderRandom",".chooseRandom"],!1)}findAllAnswers(t){const e=t;return this.responses[e.locale]?e.answers=this.responses[e.locale][e.intent]||[]:e.answers=[],e}filterAnswers(t){const e=t,{answers:n}=e;if(n&&n.length){const t=this.container.get("Evaluator");if(t){const s=e.context||{},i=[];for(let e=0;e<n.length;e+=1){const r=n[e];if(r.opts){const e="string"==typeof r.opts?r.opts:r.opts.condition;e?!0===t.evaluate(e,s)&&i.push(r):i.push(r)}else i.push(r)}e.answers=i}}return e}chooseRandom(t){const e=t,{answers:n}=e;return n&&n.length&&(e.answer=n[Math.floor(Math.random()*n.length)].answer),e}renderText(t,e){if(!t)return t;let n,s=t;do{const t=/\((?:[^()]+)\|(?:[^()]+)\)/g.exec(s);if(t){for(let e=0;e<t.length;e+=1){const n=t[e],i=n.substring(1,n.length-1).split("|");s=s.replace(n,i[Math.floor(Math.random()*i.length)])}n=!0}else n=!1}while(n);const i=this.container.get("Template");return i&&e?i.compile(t,e):s}renderRandom(t){const e=t,{answers:n,context:s}=e;for(let t=0;t<n.length;t+=1)n[t]=this.renderText(n[t],s);return e}indexOfAnswer(t,e,n,s){if(!this.responses[t])return-1;if(!this.responses[t][e])return-1;const i=this.responses[t][e];for(let t=0;t<i.length;t+=1){const e=i[t];if(e.answer===n&&JSON.stringify(e.opts)===JSON.stringify(s))return t}return-1}add(t,e,n,s){const i=this.indexOfAnswer(t,e,n,s);if(-1!==i)return this.responses[t][e][i];this.responses[t]||(this.responses[t]={}),this.responses[t][e]||(this.responses[t][e]=[]);const r={answer:n,opts:s};return this.responses[t][e].push(r),r}remove(t,e,n,s){const i=this.indexOfAnswer(t,e,n,s);-1!==i&&this.responses[t][e].splice(i,1)}find(t,e,n,s){const i={locale:t,intent:e,context:n,settings:s||this.settings};return this.runPipeline(i,this.pipelineFind)}run(t,e){return this.find(t.locale,t.intent,t.context,e)}toJSON(){const t={settings:{...this.settings},responses:this.responses};return delete t.settings.container,t}fromJSON(t){this.applySettings(this.settings,t.settings),this.responses=t.responses}}},function(t,e,n){const{Clonable:s}=n(5);t.exports=class extends s{constructor(t={},e){super({settings:{},container:t.container||e},e),this.applySettings(this.settings,t),this.settings.tag||(this.settings.tag="action-manager"),this.registerDefault(),this.applySettings(this.settings,this.container.getConfiguration(this.settings.tag)),this.actions={},this.actionsMap={},this.applySettings(this,{pipelineFind:this.getPipeline(`${this.settings.tag}-find`)})}registerDefault(){}posAction(t,e,n){if(!this.actions[t])return-1;const s=this.actions[t];for(let t=0;t<s.length;t+=1)if(s[t].action===e&&s[t].parameters.toString()===n.toString())return t;return-1}findActions(t){return(this.actions[t]||[]).map(t=>({...t,fn:this.actionsMap[t.action]}))}async processActions(t,e){const n=this.findActions(t);"object"==typeof e&&(e.actions=n.map(t=>({action:t.action,parameters:t.parameters})));let s=e;for(const{fn:t,parameters:e}of n)if(t){const n=await t(s,...e||[]);n&&("object"==typeof s?"object"==typeof n?s=n:s.answer=n:s=n)}return s}addAction(t,e,n,s){-1===this.posAction(t,e,n)&&(this.actions[t]||(this.actions[t]=[]),this.actions[t].push({action:e,parameters:n}),s&&(this.actionsMap[e]=s))}removeAction(t,e,n){const s=this.posAction(t,e,n);s>-1&&this.actions[t].splice(s,1)}removeActions(t){delete this.actions[t]}removeActionFromMap(t){delete this.actionsMap[t]}run(t,e){const n=t;return n.settings=n.settings||e||this.settings,this.processActions(t.intent,n)}toJSON(){const t={settings:{...this.settings},actions:this.actions};return delete t.settings.container,t}fromJSON(t){this.applySettings(this.settings,t.settings),this.actions=t.actions}}},function(t,e,n){const s=n(271);t.exports={SentimentAnalyzer:s}},function(t,e,n){const{Clonable:s}=n(5);t.exports=class extends s{constructor(t={},e){super({settings:{},container:t.container||e},e),this.applySettings(this.settings,t),this.settings.tag||(this.settings.tag="sentiment-analyzer"),this.registerDefault(),this.applySettings(this.settings,this.container.getConfiguration(this.settings.tag)),this.applySettings(this,{pipelinePrepare:this.getPipeline(`${this.settings.tag}-prepare`),pipelineProcess:this.getPipeline(`${this.settings.tag}-process`)})}registerDefault(){this.container.registerConfiguration("sentiment-analyzer",{},!1),this.container.registerPipeline("sentiment-analyzer-process",[".getDictionary",".getTokens",".calculate","delete output.sentimentDictionary"],!1)}prepare(t,e,n){const s=this.getPipeline(`${this.settings.tag}-prepare`)||this.getPipeline(`nlu-${t||"en"}-prepare`),i={text:e,locale:t,settings:n||this.settings};return this.runPipeline(i,s)}async getDictionary(t){const e=t,n=this.container.get(`sentiment-${e.locale}`);let s;return n&&(n.senticon&&Object.keys(n.senticon).length?s="senticon":n.pattern&&Object.keys(n.pattern).length?s="pattern":n.afinn&&Object.keys(n.afinn).length&&(s="afinn")),s?(e.sentimentDictionary={type:s,dictionary:n[s],negations:n.negations.words},e):(e.sentimentDictionary={type:s,dictionary:{},negations:[]},e)}async getTokens(t){const e=t;return!e.tokens&&e.sentimentDictionary.type&&(e.tokens=await this.prepare(e.locale,e.utterance||e.text,e.settings)),e}calculate(t){const e=t;if(e.sentimentDictionary.type){const t=Array.isArray(e.tokens)?e.tokens:Object.keys(e.tokens);if(0===Object.keys(e.sentimentDictionary.dictionary).length)e.sentiment={score:0,numWords:t.length,numHits:0,average:0,type:e.sentimentDictionary.type,locale:e.locale};else{const{dictionary:n}=e.sentimentDictionary,{negations:s}=e.sentimentDictionary;let i=0,r=1,o=0;for(let e=0;e<t.length;e+=1){const a=t[e].toLowerCase();-1!==s.indexOf(a)?(r=-1,o+=1):void 0!==n[a]&&(i+=r*n[a],o+=1)}e.sentiment={score:i,numWords:t.length,numHits:o,average:i/t.length,type:e.sentimentDictionary.type,locale:e.locale}}}else e.sentiment={score:0,numWords:0,numHits:0,average:0,type:e.sentimentDictionary.type,locale:e.locale};return e.sentiment.score>0?e.sentiment.vote="positive":e.sentiment.score<0?e.sentiment.vote="negative":e.sentiment.vote="neutral",e}process(t,e){const n=t;return n.settings=n.settings||e||this.settings,this.runPipeline(n,this.pipelineProcess)}}},function(t,e,n){const s=n(273);t.exports={SlotManager:s}},function(t,e){t.exports=class{constructor(){this.intents={}}getSlot(t,e){if(this.intents[t])return this.intents[t][e]}existsSlot(t,e){return void 0!==this.getSlot(t,e)}addSlot(t,e,n=!1,s){return this.intents[t]||(this.intents[t]={}),this.intents[t][e]={intent:t,entity:e,mandatory:n,locales:s||{}},this.intents[t][e]}removeSlot(t,e){this.intents[t]&&delete this.intents[t][e]}addBatch(t,e){const n=[];return e&&e.length>0&&e.forEach(e=>{let s=this.getSlot(t,e);s||(s=this.addSlot(t,e)),n.push(s)}),n}getIntentEntityNames(t){if(this.intents[t])return Object.keys(this.intents[t])}clear(){this.intents={}}load(t){this.intents=t||{}}save(){return this.intents}getMandatorySlots(t){const e={},n=this.intents[t];if(n){const t=Object.keys(n);for(let s=0,i=t.length;s<i;s+=1){const i=n[t[s]];i.mandatory&&(e[i.entity]=i)}}return e}cleanContextEntities(t,e){const n=e;if(n.slotFill)return;const s=this.getMandatorySlots(t),i=Object.keys(s);0!==i.length&&i.forEach(t=>{delete n[t]})}process(t,e){const n=t,s=e;if(this.cleanContextEntities(n.intent,s),s.slotFill&&(n.intent=s.slotFill.intent,n.answer=s.slotFill.answer,n.srcAnswer=s.slotFill.srcAnswer),!n.intent||"None"===n.intent)return!1;s.slotFill&&s.slotFill.intent===n.intent&&(n.entities=[...s.slotFill.entities,...n.entities]);const i=this.getMandatorySlots(n.intent);let r=Object.keys(i);if(0===r.length)return!1;s.slotFill&&n.entities.push({entity:s.slotFill.currentSlot,utteranceText:n.utterance,sourceText:n.utterance,accuracy:.95,start:0,end:n.utterance.length-1,len:n.utterance.length});for(let t=0,e=n.entities.length;t<e;t+=1)delete i[n.entities[t].entity];if(r=Object.keys(i),!r||0===r.length)return!0;s.slotFill&&s.slotFill.intent===n.intent&&(n.localeIso2=s.slotFill.localeIso2),n.slotFill={localeIso2:n.localeIso2,intent:n.intent,entities:n.entities,answer:n.answer,srcAnswer:n.srcAnswer};const o=i[r[0]];return n.slotFill.currentSlot=o.entity,n.srcAnswer=o.locales[n.localeIso2],s.slotFill=n.slotFill,!0}}},function(t,e){t.exports=function(t){return async(e,n,s)=>{const i=await t.process(e),r={};for(let t of i.entities){let e;t.resolution?e=t.resolution:t.utteranceText&&(e={value:t.utteranceText}),r[t.entity]=e}return r.date&&(r.date.value=r.date.date,delete r.date.date),r.dimension&&(r.distance=Object.assign({},r.dimension),delete r.dimension),r.sentiment=i.sentiment.vote,{[i.intent]:()=>r}}}}]);